"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[908],{178:function(e,a,n){e.exports=n.p+"img/1-1.eaa93a9a.png"},403:function(e,a,n){e.exports=n.p+"img/2-3.e7e6ea17.png"},529:function(e,a,n){e.exports=n.p+"img/2-1.eaa93a9a.png"},902:function(e,a,n){e.exports=n.p+"img/5-1.eaa93a9a.png"},908:function(e,a,n){n.r(a),n.d(a,{default:function(){return ue}});n(4114),n(8111),n(2489);var t=n(6768),l=n(144),s=n(4232),r=n(5130),u=n(3271),i=n(14),c=n(5796),o=n(2933),v=n(1219),p=n(7477),g=n(178),d=n(1145),m=n(3024),k=n(529),f=n(1546),h=n(403),y=n(2292),w=n(9151),L=n(2214),b=n(7243),_=n(3107),P=n(7593),C=n(902),x=n(2669),R=n(9428);const K={class:"plant-chat-page"},E={class:"container"},X={class:"plant-chat-header card"},F={class:"plant-avatar"},I=["src"],D={class:"plant-info"},T={class:"plant-status"},z={class:"status-value"},B={class:"mood-emoji"},V={class:"plant-level"},W={class:"level-badge"},H={class:"clear-chat"},M={class:"message-container card"},Q={key:0,class:"empty-conversation"},j={class:"message-avatar"},S={key:0,class:"user-avatar"},U={key:1,class:"plant-message-avatar"},Y=["src"],A={class:"message-bubble"},G={class:"message-content"},q={class:"typing-segment"},J={key:0,class:"more-segments-indicator"},N={class:"message-time"},O={key:2,class:"typing-indicator"},Z={class:"input-container"},$={key:0,class:"suggestion-chips"},ee=["onClick"],ae={class:"input-wrapper"},ne=50,te=1e3;var le={__name:"PlantChat",setup(e){const a=(0,u.g)(),n=(0,i.n)(),le=(0,l.KR)(null),se=(0,l.KR)(""),re=(0,l.KR)(!1),ue=(0,l.KR)(!0),ie=(0,l.KR)(null),ce=(0,l.KR)(""),oe=(0,l.KR)([]),ve=(0,l.KR)(0),pe=(0,l.KR)(null),ge=(0,l.KR)(null),de=(0,l.KR)([]),me=(0,l.KR)(0),ke=(0,t.EW)((()=>n.userInfo.avatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png")),fe=["ËÆæÁΩÆ‰∏Ä‰∏™‰ªªÂä°ÔºåÊèêÈÜíÊàëÊòéÂ§©Êó©‰∏ä8ÁÇπÂéªË∑ëÊ≠•","ÊàëÊúÄËøëÂøÉÊÉÖ‰∏çÂ•ΩÔºå‰Ω†ËÉΩÈô™ÊàëËÅäËÅäÂêóÔºü","ÊÄªËÆ°‰∏Ä‰∏ãÊúÄËøëÁöÑÂ≠¶‰π†ÊÉÖÂÜµÔºåÁªôÊàë‰∏Ä‰∫õËßÑÂàíÂª∫ËÆÆ"],he={id:"welcome",sender:"plant",content:"‰Ω†Â•ΩÂëÄœÜ(*Ôø£0Ôø£)ÔºÅÊàëÊòØ‰Ω†ÁöÑÊ§çÁâ©‰ºô‰º¥ÔºåÂæàÈ´òÂÖ¥ËÉΩÂíå‰Ω†ËÅäÂ§©„ÄÇ‰Ω†ÂèØ‰ª•ÈóÆÊàë‰ªª‰ΩïÈóÆÈ¢òÔºåÊàñËÄÖÂàÜ‰∫´‰Ω†ÁöÑÊÉ≥Ê≥ï„ÄÇ",timestamp:new Date},ye=(0,t.EW)((()=>a.conversations&&0!==a.conversations.length?a.conversations:[he])),we={"Áé´Áë∞":{1:g,2:d,3:m},"‰ªô‰∫∫Êéå":{1:k,2:f,3:h},"ÈÉÅÈáëÈ¶ô":{1:y,2:w,3:L},"ÁôΩÁôæ‰Ωï":{1:b,2:_,3:P},"ÂêëÊó•Ëëµ":{1:C,2:x,3:R}},Le=e=>{if(!e||!e.type)return g;const a=e.type.trim(),n=e.level||1,t=Math.min(Math.max(n,1),3),l=we[a];return l&&l[t]||g},be=()=>{if(!a.currentPlant)return"Êú™ÁßçÊ§ç";const e={seedling:"ÂπºËãóÊúü",growing:"ÊàêÈïøÊúü",mature:"ÊàêÁÜüÊúü"};return e[a.currentPlant.state]||"ÊàêÈïø‰∏≠"},_e=()=>{if(!a.currentPlant)return"üòê";const e={happy:"üòä",neutral:"üòê",sad:"üò¢"};return e[a.currentPlant.mood]||"üòê"},Pe=e=>e?(0,c.GP)(new Date(e),"HH:mm"):"",Ce=e=>{!e.shiftKey&&se.value.trim()&&(e.preventDefault(),Ie())},xe=()=>{o.s.confirm("Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂØπËØùËÆ∞ÂΩïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ","ÊèêÁ§∫",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{if(!a.currentPlant)return;const e=a.currentPlant._id||a.currentPlant.id;try{Fe(),await a.clearConversations(e),a.conversations=[he],v.nk.success("ÂØπËØùÂ∑≤Ê∏ÖÁ©∫ÔºåÂ∞ÜÂºÄÂßãÊñ∞ÁöÑÂØπËØù")}catch(n){console.error("Ê∏ÖÁ©∫ÂØπËØùÂ§±Ë¥•:",n),v.nk.error("Ê∏ÖÁ©∫ÂØπËØùÂ§±Ë¥•")}})).catch((()=>{}))},Re=e=>e?e.split(/\n\n|\n/).filter((e=>""!==e.trim())):[],Ke=e=>{Fe(),ie.value=e.id,de.value=Re(e.content),oe.value=[],me.value=0,ce.value="",ve.value=de.value.length,Ee()},Ee=()=>{if(me.value>=de.value.length)return void Xe();const e=de.value[me.value];let a=0;pe.value&&clearInterval(pe.value),pe.value=setInterval((()=>{a<=e.length?(ce.value=e.substring(0,a),a++,Te()):(clearInterval(pe.value),oe.value.push(e),ce.value="",ve.value--,me.value++,me.value<de.value.length?ge.value=setTimeout(Ee,te):Xe())}),ne)},Xe=()=>{pe.value&&(clearInterval(pe.value),pe.value=null),ge.value&&(clearTimeout(ge.value),ge.value=null),ie.value=null},Fe=()=>{pe.value&&(clearInterval(pe.value),pe.value=null),ge.value&&(clearTimeout(ge.value),ge.value=null),ie.value=null},Ie=async()=>{if(!se.value.trim()||re.value)return;if(!a.currentPlant)return void v.nk.warning("ËØ∑ÂÖàÂú®Ëä±Âõ≠‰∏≠ÈÄâÊã©‰∏Ä‰∏™Ê§çÁâ©");if(!localStorage.getItem("token"))return void v.nk.warning("ËØ∑ÂÖàÁôªÂΩïÂÜç‰∏éÊ§çÁâ©ÂØπËØù");if(!a.currentPlant._id&&!a.currentPlant.id)return console.error("Ê§çÁâ©IDÊó†Êïà"),void v.nk.warning("Ê§çÁâ©‰ø°ÊÅØ‰∏çÂÆåÊï¥ÔºåËØ∑ÈáçÊñ∞ÈÄâÊã©Ê§çÁâ©");const e=a.currentPlant._id||a.currentPlant.id,n=se.value,l={id:Date.now().toString(),sender:"user",content:n,timestamp:new Date};a.conversations||(a.conversations=[]),a.conversations.push(l),se.value="",re.value=!0,ue.value=!1;try{await Te();const l=await a.sendMessage(e,n,!0);if(!l)throw new Error("ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•");await Te(),await(0,t.dY)(),Ke(l)}catch(s){console.error("ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•:",s),v.nk.error("ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï")}finally{re.value=!1}},De=e=>{se.value=e,Ie()},Te=async()=>{await(0,t.dY)(),le.value&&(le.value.scrollTop=le.value.scrollHeight)};return(0,t.wB)((()=>a.conversations.length),(async()=>{await Te()})),(0,t.wB)((()=>a.mainPlant),(async e=>{if(e){Fe(),a.currentPlant=e;try{const n=e._id||e.id;n&&(re.value=!0,await a.fetchConversations(n),await Te())}catch(n){console.error("Ëé∑ÂèñÂØπËØùÂéÜÂè≤Â§±Ë¥•:",n),v.nk.info("Ëé∑ÂèñÂØπËØùÂéÜÂè≤Â§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï")}finally{re.value=!1}}}),{immediate:!0}),(0,t.sV)((async()=>{if(n.user||await n.fetchUserInfo(),a.currentPlant||await a.fetchPlants(),a.currentPlant){if(!a.currentPlant._id&&!a.currentPlant.id)return console.error("Ê§çÁâ©IDÊó†Êïà"),void v.nk.warning("Ê§çÁâ©‰ø°ÊÅØ‰∏çÂÆåÊï¥ÔºåËØ∑ÈáçÊñ∞ÈÄâÊã©Ê§çÁâ©");const n=a.currentPlant._id||a.currentPlant.id;re.value=!0;try{await a.fetchConversations(n),a.conversations&&0!==a.conversations.length||(a.conversations=[he])}catch(e){console.error("Ëé∑ÂèñÂØπËØùÂéÜÂè≤Â§±Ë¥•:",e),v.nk.info("Ëé∑ÂèñÂØπËØùÂéÜÂè≤Â§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï")}finally{re.value=!1,await Te()}}return()=>{Fe()}})),(e,n)=>{const u=(0,t.g2)("el-icon"),i=(0,t.g2)("el-button"),c=(0,t.g2)("el-empty"),o=(0,t.g2)("el-avatar"),v=(0,t.g2)("el-input");return(0,t.uX)(),(0,t.CE)("div",K,[(0,t.Lk)("div",E,[(0,t.Lk)("div",X,[(0,t.Lk)("div",F,[(0,t.Lk)("img",{src:Le((0,l.R1)(a).currentPlant),class:"plant-image",alt:"Ê§çÁâ©ÂõæÁâá"},null,8,I)]),(0,t.Lk)("div",D,[(0,t.Lk)("h2",null,"‰∏é"+(0,s.v_)((0,l.R1)(a).currentPlant?(0,l.R1)(a).currentPlant.name:"Ê§çÁâ©")+"ÂØπËØù",1),(0,t.Lk)("p",T,[n[1]||(n[1]=(0,t.Lk)("span",{class:"status-label"},"Áä∂ÊÄÅ:",-1)),(0,t.Lk)("span",z,(0,s.v_)(be()),1),(0,t.Lk)("span",B,(0,s.v_)(_e()),1)])]),(0,t.Lk)("div",V,[(0,t.Lk)("div",W,"Lv."+(0,s.v_)((0,l.R1)(a).currentPlant?.level||1),1)]),(0,t.Lk)("div",H,[(0,t.bF)(i,{type:"text",onClick:xe,disabled:!ye.value||ye.value.length<=1},{default:(0,t.k6)((()=>[(0,t.bF)(u,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,l.R1)(p.Delete))])),_:1}),n[2]||(n[2]=(0,t.eW)(" Ê∏ÖÁ©∫ÂØπËØù "))])),_:1,__:[2]},8,["disabled"])])]),(0,t.Lk)("div",M,[(0,t.Lk)("div",{class:"messages-list",ref_key:"messagesList",ref:le},[ye.value&&0!==ye.value.length?((0,t.uX)(!0),(0,t.CE)(t.FK,{key:1},(0,t.pI)(ye.value,(e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:(0,s.C4)(["message","user"===e.sender?"user-message":"plant-message"])},[(0,t.Lk)("div",j,["user"===e.sender?((0,t.uX)(),(0,t.CE)("span",S,[(0,t.bF)(o,{size:40,src:ke.value},null,8,["src"])])):((0,t.uX)(),(0,t.CE)("span",U,[(0,t.Lk)("img",{src:Le((0,l.R1)(a).currentPlant),class:"plant-chat-image",alt:"Ê§çÁâ©ÂõæÁâá"},null,8,Y)]))]),(0,t.Lk)("div",A,[(0,t.Lk)("div",G,["user"===e.sender?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.eW)((0,s.v_)(e.content),1)],64)):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[ie.value===e.id?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(oe.value,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"message-segment"},(0,s.v_)(e),1)))),128)),(0,t.Lk)("div",q,(0,s.v_)(ce.value),1),ve.value>0?((0,t.uX)(),(0,t.CE)("div",J,n[4]||(n[4]=[(0,t.Lk)("div",{class:"dot-flashing"},null,-1)]))):(0,t.Q3)("",!0)],64)):((0,t.uX)(!0),(0,t.CE)(t.FK,{key:1},(0,t.pI)(Re(e.content),((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"message-segment"},(0,s.v_)(e),1)))),128))],64))]),(0,t.Lk)("div",N,(0,s.v_)(Pe(e.timestamp)),1)])],2)))),128)):((0,t.uX)(),(0,t.CE)("div",Q,[(0,t.bF)(c,{description:"ÊöÇÊó†ÂØπËØùÔºåÂèëÈÄÅÊ∂àÊÅØÂºÄÂßã‰∏éÊ§çÁâ©ËÅäÂ§©Âêß~"},{image:(0,t.k6)((()=>n[3]||(n[3]=[(0,t.Lk)("img",{src:"/images/plant_chat_empty.png",alt:"Á©∫ÂØπËØù",class:"empty-img"},null,-1)]))),_:1})])),re.value?((0,t.uX)(),(0,t.CE)("div",O,n[5]||(n[5]=[(0,t.Lk)("span",null,null,-1),(0,t.Lk)("span",null,null,-1),(0,t.Lk)("span",null,null,-1)]))):(0,t.Q3)("",!0)],512),(0,t.Lk)("div",Z,[ue.value?((0,t.uX)(),(0,t.CE)("div",$,[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(fe,((e,a)=>(0,t.Lk)("div",{key:a,class:"suggestion-chip",onClick:a=>De(e)},(0,s.v_)(e),9,ee))),64))])):(0,t.Q3)("",!0),(0,t.Lk)("div",ae,[(0,t.bF)(v,{modelValue:se.value,"onUpdate:modelValue":n[0]||(n[0]=e=>se.value=e),type:"textarea",rows:1,autosize:{minRows:1,maxRows:4},placeholder:"ËæìÂÖ•Ê∂àÊÅØ‰∏éÊ§çÁâ©ËÅäÂ§©...",onKeyup:(0,r.jR)(Ce,["enter","native"])},null,8,["modelValue"]),(0,t.bF)(i,{type:"primary",class:"send-btn",disabled:!se.value.trim()||re.value,onClick:Ie},{default:(0,t.k6)((()=>[(0,t.bF)(u,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,l.R1)(p.Position))])),_:1})])),_:1},8,["disabled"])])])])])])}}},se=n(1241);const re=(0,se.A)(le,[["__scopeId","data-v-4ee657a6"]]);var ue=re},1145:function(e,a,n){e.exports=n.p+"img/1-2.e301c84e.png"},1546:function(e,a,n){e.exports=n.p+"img/2-2.ff769eac.png"},2214:function(e,a,n){e.exports=n.p+"img/3-3.a4c025b0.png"},2292:function(e,a,n){e.exports=n.p+"img/3-1.eaa93a9a.png"},2669:function(e,a,n){e.exports=n.p+"img/5-2.e26c060e.png"},3024:function(e,a,n){e.exports=n.p+"img/1-3.74393638.png"},3107:function(e,a,n){e.exports=n.p+"img/4-2.b7d3c88c.png"},7243:function(e,a,n){e.exports=n.p+"img/4-1.eaa93a9a.png"},7593:function(e,a,n){e.exports=n.p+"img/4-3.2b85cb4d.png"},9151:function(e,a,n){e.exports=n.p+"img/3-2.57f7796f.png"},9428:function(e,a,n){e.exports=n.p+"img/5-3.d4662e32.png"}}]);
//# sourceMappingURL=908.8f03c0a1.js.map