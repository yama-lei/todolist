"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[111],{2333:function(e,t,a){a.d(t,{O:function(){return c}});a(4114),a(8111),a(2489),a(116),a(1701);var s=a(2261),n=a(144),l=a(6768),i=a(3271),o=a(4300),r=a(1219);const c=(0,s.nY)("task",(()=>{const e=(0,n.KR)([]),t=(0,n.KR)([]),a=(0,n.KR)([]),s=(0,n.KR)(!1),c=(0,l.EW)((()=>e.value.filter((e=>!e.completed)))),d=async()=>{try{s.value=!0;const t=await o.WY.getTasks();e.value=t.tasks.filter((e=>!e.completed)),a.value=t.tasks.filter((e=>e.completed))}catch(t){r.nk.error("获取任务列表失败")}finally{s.value=!1}},k=async()=>{try{s.value=!0;const e=await o.WY.getSystemTasks();t.value=e.tasks}catch(e){r.nk.error("获取系统任务失败")}finally{s.value=!1}},u=async t=>{try{const a=!0===t.important||"true"===t.important,s=await o.WY.createTask({title:t.title,description:t.description||"",deadline:t.deadline||"",important:a});e.value.push(s.task),r.nk.success("任务创建成功")}catch(a){r.nk.error("创建任务失败")}},m=async t=>{try{await o.WY.completeTask(t);const s=e.value.find((e=>e._id===t));s&&(a.value.unshift({...s,completed:!0,completedAt:(new Date).toISOString()}),e.value=e.value.filter((e=>e._id!==t)));const n=(0,i.g)();if(n.plants&&n.plants.length>0){const e=n.plants.find((e=>e.isMainPlant));if(e){const t=e._id||e.id;if(t){const e=s&&s.important?50:25;await n.gainExperience(t,e),r.nk.success(`任务已完成，获得 ${e} 点经验值！`)}}}else r.nk.success("任务已完成")}catch(s){r.nk.error("完成任务失败")}},p=async e=>{try{const a=(0,i.g)();if(!a.currentPlant)return r.nk.warning("请先添加一个植物"),!1;const s=await o.WY.completeSystemTask(e),n=t.value.findIndex((t=>t._id===e));if(-1!==n&&(t.value[n].completed=!0),s.rewards)r.nk.success(`完成任务获得 ${s.rewards.experience} 点经验`);else{const e=a.currentPlant._id||a.currentPlant.id;if(e){const t=35;await a.gainExperience(e,t),r.nk.success(`完成系统任务获得 ${t} 点经验值`)}}return!0}catch(a){return 400===a.response?.status?r.nk.warning("今天已经完成过此任务"):r.nk.error("完成系统任务失败"),!1}},f=async t=>{try{if(!t)return void r.nk.error("任务ID无效，无法删除");await o.WY.deleteTask(t),e.value=e.value.filter((e=>e._id!==t)),r.nk.success("任务已删除")}catch(a){console.error("删除任务失败:",a),r.nk.error("删除任务失败")}},v=async e=>{try{if(!e)return void r.nk.error("任务ID无效，无法删除");await o.WY.deleteTask(e),a.value=a.value.filter((t=>t._id!==e)),r.nk.success("任务已删除")}catch(t){console.error("删除任务失败:",t),r.nk.error("删除任务失败")}},g=async t=>{try{const{_id:a,title:s,description:n,deadline:l,important:i}=t,c=!0===i||"true"===i,d=e.value.findIndex((e=>e._id===a));-1!==d&&e.value[d];-1!==d&&(e.value[d]={...e.value[d],title:s,description:n,deadline:l,important:c});const k=await o.WY.updateTask(a,{title:s,description:n,deadline:l,important:c});if(k&&k.task){const t=e.value.findIndex((e=>e._id===a));-1!==t&&(e.value[t]=k.task)}r.nk.success("任务已更新")}catch(a){console.error("更新任务失败:",a);const s=e.value.findIndex((e=>e._id===t._id));-1!==s&&originalTask&&(e.value[s]=originalTask),r.nk.error("更新任务失败")}},y=async t=>{const a=e.value.find((e=>e._id===t));if(a)try{console.log("切换任务重要性 - 当前状态:",a.important,"类型:",typeof a.important);const s=!0===a.important||"true"===a.important,n=!s;console.log("切换任务重要性 - 新状态:",n);const l=e.value.findIndex((e=>e._id===t));if(-1!==l){const t={...e.value[l],important:n};e.value[l]=t}const i=await o.WY.updateTask(t,{title:a.title,description:a.description,deadline:a.deadline,important:n});if(i&&i.task){const a=e.value.findIndex((e=>e._id===t));-1!==a&&(e.value[a]=i.task)}r.nk.success("任务已"+(n?"标记为重要":"取消重要标记"))}catch(s){console.error("更新任务重要性失败:",s);const n=e.value.findIndex((e=>e._id===t));-1!==n&&(e.value[n]={...e.value[n],important:a.important}),r.nk.error("更新任务重要性失败")}},T=t=>{if(!t||!Array.isArray(t))return;const a=t.map((e=>{const t=!0===e.important||"true"===e.important;return{...e,important:t}}));e.value=a};return{tasks:e,systemTasks:t,completedTasks:a,pendingTasks:c,loading:s,fetchTasks:d,fetchSystemTasks:k,addTask:u,completeTask:m,completeSystemTask:p,removeTask:f,removeCompletedTask:v,updateTask:g,toggleTaskImportance:y,reorderTasks:T}}))},3349:function(e,t,a){a.r(t),a.d(t,{default:function(){return xe}});var s=a(6768),n=a(4232);const l={class:"task-page"},i={class:"container"},o={class:"task-header"},r={class:"task-actions"},c={class:"system-tasks-card card"},d={class:"card-header"},k={class:"task-info"},u={class:"tasks-list system-tasks"},m={class:"task-left"},p={class:"task-icon"},f={class:"task-content"},v={class:"task-title"},g={class:"task-description"},y={key:0,class:"task-meta"},T={class:"completed-at"},h={class:"task-actions"},_={class:"user-tasks-card card"},F={class:"card-header"},b={class:"task-status"},C={key:0,class:"empty-tasks"},L={key:1,class:"tasks-list user-tasks"},w={class:"task-left"},D={class:"task-checkbox"},x={class:"task-content"},S={class:"task-title-row"},N={class:"task-title"},E={key:0,class:"star-icon"},Y={class:"task-description"},W={class:"task-meta"},I={key:0,class:"task-deadline"},U={class:"task-actions"},V={key:0,class:"completed-tasks-card card"},z={class:"card-header"},X={class:"completed-count"},P={class:"tasks-list completed-tasks"},M={class:"task-left"},A={class:"task-checkbox"},K={class:"task-content"},H={class:"task-title"},$={key:0,class:"task-description"},R={class:"task-meta"},B={class:"completed-at"},Z={class:"importance-toggle-container"},Q={class:"dialog-footer"};function O(e,t,a,O,q,G){const j=(0,s.g2)("Plus"),J=(0,s.g2)("el-icon"),ee=(0,s.g2)("Trophy"),te=(0,s.g2)("el-tag"),ae=(0,s.g2)("Check"),se=(0,s.g2)("el-button"),ne=(0,s.g2)("el-empty"),le=(0,s.g2)("el-checkbox"),ie=(0,s.g2)("Star"),oe=(0,s.g2)("Clock"),re=(0,s.g2)("Edit"),ce=(0,s.g2)("Delete"),de=(0,s.g2)("el-input"),ke=(0,s.g2)("el-form-item"),ue=(0,s.g2)("el-date-picker"),me=(0,s.g2)("el-switch"),pe=(0,s.g2)("el-form"),fe=(0,s.g2)("el-dialog");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",i,[(0,s.Lk)("div",o,[t[9]||(t[9]=(0,s.Lk)("h1",{class:"section-title"},"任务管理",-1)),(0,s.Lk)("div",r,[(0,s.Lk)("button",{class:"add-task-button",onClick:t[0]||(t[0]=(...e)=>O.openTaskForm&&O.openTaskForm(...e))},[(0,s.bF)(J,null,{default:(0,s.k6)((()=>[(0,s.bF)(j)])),_:1}),t[8]||(t[8]=(0,s.Lk)("span",null,"新建任务",-1))])])]),(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[t[11]||(t[11]=(0,s.Lk)("h2",{class:"section-title"},"每日任务",-1)),(0,s.Lk)("div",k,[(0,s.bF)(te,{type:"success",size:"small",effect:"plain"},{default:(0,s.k6)((()=>[(0,s.bF)(J,null,{default:(0,s.k6)((()=>[(0,s.bF)(ee)])),_:1}),t[10]||(t[10]=(0,s.eW)(" 完成任务可获得经验值，帮助植物成长 "))])),_:1,__:[10]})])]),(0,s.Lk)("div",u,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(O.taskStore.systemTasks,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e._id,class:(0,n.C4)(["task-item",{completed:e.completed}])},[(0,s.Lk)("div",m,[(0,s.Lk)("div",p,(0,n.v_)(e.icon||"🎯"),1),(0,s.Lk)("div",f,[(0,s.Lk)("div",v,(0,n.v_)(e.title),1),(0,s.Lk)("div",g,(0,n.v_)(e.description),1),e.completed?((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("span",T,[(0,s.bF)(J,null,{default:(0,s.k6)((()=>[(0,s.bF)(ae)])),_:1}),(0,s.eW)(" 完成于 "+(0,n.v_)(O.formatDate(e.completedAt)),1)])])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",h,[(0,s.bF)(se,{type:e.completed?"success":"primary",icon:e.completed?"Check":"",disabled:e.completed,class:"complete-button",onClick:t=>O.completeSystemTask(e._id)},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(e.completed?"已完成":"完成任务"),1)])),_:2},1032,["type","icon","disabled","onClick"])])],2)))),128))])]),(0,s.Lk)("div",_,[(0,s.Lk)("div",F,[t[12]||(t[12]=(0,s.Lk)("h2",{class:"section-title"},"我的任务",-1)),(0,s.Lk)("div",b,[(0,s.bF)(te,{type:"primary",size:"small",effect:"dark",class:"task-count-tag"},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(O.taskStore.pendingTasks.length)+" 个待完成 ",1)])),_:1})])]),0===O.taskStore.pendingTasks.length?((0,s.uX)(),(0,s.CE)("div",C,[(0,s.bF)(ne,{description:"暂无任务，点击右上角添加新任务吧！"})])):((0,s.uX)(),(0,s.CE)("div",L,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(O.taskStore.pendingTasks,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e._id,class:(0,n.C4)(["task-item",{important:e.important}])},[(0,s.Lk)("div",w,[(0,s.Lk)("div",D,[(0,s.bF)(le,{onChange:()=>O.completeUserTask(e._id)},null,8,["onChange"])]),(0,s.Lk)("div",x,[(0,s.Lk)("div",S,[(0,s.Lk)("div",N,(0,n.v_)(e.title),1),e.important?((0,s.uX)(),(0,s.CE)("div",E,[(0,s.bF)(J,{color:"#F7BA2A",size:20},{default:(0,s.k6)((()=>[(0,s.bF)(ie,{filled:""})])),_:1})])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Y,(0,n.v_)(e.description),1),(0,s.Lk)("div",W,[e.deadline?((0,s.uX)(),(0,s.CE)("span",I,[(0,s.bF)(te,{type:"info",size:"small"},{default:(0,s.k6)((()=>[(0,s.bF)(J,null,{default:(0,s.k6)((()=>[(0,s.bF)(oe)])),_:1}),(0,s.eW)(" "+(0,n.v_)(O.formatDate(e.deadline)),1)])),_:2},1024)])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",U,[(0,s.bF)(se,{type:"primary",text:"",size:"small",onClick:t=>O.editTask(e)},{default:(0,s.k6)((()=>[(0,s.bF)(J,null,{default:(0,s.k6)((()=>[(0,s.bF)(re)])),_:1}),t[13]||(t[13]=(0,s.eW)(" 编辑 "))])),_:2,__:[13]},1032,["onClick"]),(0,s.bF)(se,{type:"danger",text:"",size:"small",onClick:t=>O.deleteTask(e._id)},{default:(0,s.k6)((()=>[(0,s.bF)(J,null,{default:(0,s.k6)((()=>[(0,s.bF)(ce)])),_:1}),t[14]||(t[14]=(0,s.eW)(" 删除 "))])),_:2,__:[14]},1032,["onClick"])])],2)))),128))]))]),O.taskStore.completedTasks.length>0?((0,s.uX)(),(0,s.CE)("div",V,[(0,s.Lk)("div",z,[t[15]||(t[15]=(0,s.Lk)("h2",{class:"section-title"},"已完成任务",-1)),(0,s.Lk)("div",X,[(0,s.bF)(te,{type:"success",size:"small",effect:"dark",class:"task-count-tag"},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(O.taskStore.completedTasks.length)+" 个任务 ",1)])),_:1})])]),(0,s.Lk)("div",P,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(O.taskStore.completedTasks,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e._id,class:"task-item completed"},[(0,s.Lk)("div",M,[(0,s.Lk)("div",A,[(0,s.bF)(le,{modelValue:!0,disabled:""})]),(0,s.Lk)("div",K,[(0,s.Lk)("div",H,(0,n.v_)(e.title),1),e.description?((0,s.uX)(),(0,s.CE)("div",$,(0,n.v_)(e.description),1)):(0,s.Q3)("",!0),(0,s.Lk)("div",R,[(0,s.Lk)("span",B," 完成于 "+(0,n.v_)(O.formatDate(e.completedAt)),1)])])])])))),128))])])):(0,s.Q3)("",!0)]),(0,s.bF)(fe,{modelValue:O.showTaskForm,"onUpdate:modelValue":t[7]||(t[7]=e=>O.showTaskForm=e),title:O.editingTask?"编辑任务":"新建任务",width:"500px","custom-class":"modern-dialog task-edit-dialog"},{footer:(0,s.k6)((()=>[(0,s.Lk)("div",Q,[(0,s.bF)(se,{onClick:t[6]||(t[6]=e=>O.showTaskForm=!1),class:"cancel-button"},{default:(0,s.k6)((()=>t[16]||(t[16]=[(0,s.eW)("取消")]))),_:1,__:[16]}),(0,s.bF)(se,{type:"primary",onClick:O.saveTask,class:"save-button"},{default:(0,s.k6)((()=>t[17]||(t[17]=[(0,s.eW)(" 保存 ")]))),_:1,__:[17]},8,["onClick"])])])),default:(0,s.k6)((()=>[(0,s.bF)(pe,{model:O.taskForm,"label-position":"top",class:"modern-form"},{default:(0,s.k6)((()=>[(0,s.bF)(ke,{label:"任务标题",required:"",class:"form-item-animated"},{default:(0,s.k6)((()=>[(0,s.bF)(de,{modelValue:O.taskForm.title,"onUpdate:modelValue":t[1]||(t[1]=e=>O.taskForm.title=e),placeholder:"输入任务标题",class:"modern-input"},null,8,["modelValue"])])),_:1}),(0,s.bF)(ke,{label:"任务描述",class:"form-item-animated"},{default:(0,s.k6)((()=>[(0,s.bF)(de,{modelValue:O.taskForm.description,"onUpdate:modelValue":t[2]||(t[2]=e=>O.taskForm.description=e),type:"textarea",rows:4,placeholder:"输入任务描述",class:"modern-textarea"},null,8,["modelValue"])])),_:1}),(0,s.bF)(ke,{label:"截止日期",class:"form-item-animated"},{default:(0,s.k6)((()=>[(0,s.bF)(ue,{modelValue:O.taskForm.deadline,"onUpdate:modelValue":t[3]||(t[3]=e=>O.taskForm.deadline=e),type:"datetime",placeholder:"选择截止日期","value-format":"YYYY-MM-DDTHH:mm:ss",format:"YYYY-MM-DD HH:mm",style:{width:"100%"},class:"modern-date-picker"},null,8,["modelValue"])])),_:1}),(0,s.bF)(ke,{class:"form-item-animated importance-item"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",Z,[(0,s.bF)(me,{modelValue:O.taskForm.important,"onUpdate:modelValue":t[4]||(t[4]=e=>O.taskForm.important=e),"active-color":"#F7BA2A","inactive-color":"#DCDFE6",class:"modern-switch"},null,8,["modelValue"]),(0,s.Lk)("div",{class:(0,n.C4)(["importance-label",{active:O.taskForm.important}]),onClick:t[5]||(t[5]=e=>O.taskForm.important=!O.taskForm.important)},[(0,s.bF)(J,null,{default:(0,s.k6)((()=>[(0,s.bF)(ie)])),_:1}),(0,s.Lk)("span",null,(0,n.v_)(O.taskForm.important?"重要任务":"普通任务"),1)],2)])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}var q=a(144),G=a(2333),j=a(3271),J=a(2933),ee=a(5796),te=a(2436),ae=a(5808),se=a(4068);function ne(e,t){const a=()=>(0,ae.w)(t?.in,NaN),s=t?.additionalDigits??2,n=ce(e);let l;if(n.date){const e=de(n.date,s);l=ke(e.restDateString,e.year)}if(!l||isNaN(+l))return a();const i=+l;let o,r=0;if(n.time&&(r=me(n.time),isNaN(r)))return a();if(!n.timezone){const e=new Date(i+r),a=(0,se.a)(0,t?.in);return a.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),a.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),a}return o=fe(n.timezone),isNaN(o)?a():(0,se.a)(i+r+o,t?.in)}const le={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ie=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,oe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,re=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ce(e){const t={},a=e.split(le.dateTimeDelimiter);let s;if(a.length>2)return t;if(/:/.test(a[0])?s=a[0]:(t.date=a[0],s=a[1],le.timeZoneDelimiter.test(t.date)&&(t.date=e.split(le.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){const e=le.timezone.exec(s);e?(t.time=s.replace(e[1],""),t.timezone=e[1]):t.time=s}return t}function de(e,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(a);if(!s)return{year:NaN,restDateString:""};const n=s[1]?parseInt(s[1]):null,l=s[2]?parseInt(s[2]):null;return{year:null===l?n:100*l,restDateString:e.slice((s[1]||s[2]).length)}}function ke(e,t){if(null===t)return new Date(NaN);const a=e.match(ie);if(!a)return new Date(NaN);const s=!!a[4],n=ue(a[1]),l=ue(a[2])-1,i=ue(a[3]),o=ue(a[4]),r=ue(a[5])-1;if(s)return _e(t,o,r)?ve(t,o,r):new Date(NaN);{const e=new Date(0);return Te(t,l,i)&&he(t,n)?(e.setUTCFullYear(t,l,Math.max(n,i)),e):new Date(NaN)}}function ue(e){return e?parseInt(e):1}function me(e){const t=e.match(oe);if(!t)return NaN;const a=pe(t[1]),s=pe(t[2]),n=pe(t[3]);return Fe(a,s,n)?a*te.s0+s*te.Cg+1e3*n:NaN}function pe(e){return e&&parseFloat(e.replace(",","."))||0}function fe(e){if("Z"===e)return 0;const t=e.match(re);if(!t)return 0;const a="+"===t[1]?-1:1,s=parseInt(t[2]),n=t[3]&&parseInt(t[3])||0;return be(s,n)?a*(s*te.s0+n*te.Cg):NaN}function ve(e,t,a){const s=new Date(0);s.setUTCFullYear(e,0,4);const n=s.getUTCDay()||7,l=7*(t-1)+a+1-n;return s.setUTCDate(s.getUTCDate()+l),s}const ge=[31,null,31,30,31,30,31,31,30,31,30,31];function ye(e){return e%400===0||e%4===0&&e%100!==0}function Te(e,t,a){return t>=0&&t<=11&&a>=1&&a<=(ge[t]||(ye(e)?29:28))}function he(e,t){return t>=1&&t<=(ye(e)?366:365)}function _e(e,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function Fe(e,t,a){return 24===e?0===t&&0===a:a>=0&&a<60&&t>=0&&t<60&&e>=0&&e<25}function be(e,t){return t>=0&&t<=59}var Ce=a(7477),Le={name:"TaskPage",components:{Plus:Ce.Plus,Clock:Ce.Clock,Check:Ce.Check,Trophy:Ce.Trophy,Edit:Ce.Edit,Delete:Ce.Delete,Star:Ce.Star},setup(){const e=(0,G.O)(),t=(0,j.g)(),a=(0,q.KR)(!1),n=(0,q.KR)(null),l=(0,q.Kh)({id:null,title:"",description:"",deadline:"",important:!1});(0,s.sV)((async()=>{console.log("任务页面加载"),t.currentPlant||await t.fetchPlants();try{await Promise.all([e.fetchTasks(),e.fetchSystemTasks()]),console.log("任务数据加载成功")}catch(a){console.error("加载任务数据失败:",a)}}));const i=()=>{o(),a.value=!0},o=()=>{l.id=null,l.title="",l.description="",l.deadline="",l.important=!1,n.value=null},r=async a=>{t.currentPlant?await e.completeSystemTask(a):J.s.alert("请先在花园中添加一个植物","提示",{confirmButtonText:"确定"})},c=async t=>{await e.completeTask(t)},d=e=>{n.value=e,l.id=e._id,l.title=e.title,l.description=e.description||"",l.deadline=e.deadline||"",l.important=e.important||!1,a.value=!0},k=t=>{J.s.confirm("确定要删除这个任务吗？","删除任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e.removeTask(t)})).catch((()=>{}))},u=()=>{l.title.trim()?(n.value?e.updateTask({_id:l.id,title:l.title,description:l.description,deadline:l.deadline,important:l.important}):e.addTask({title:l.title,description:l.description,deadline:l.deadline,important:l.important}),a.value=!1,o()):J.s.alert("请输入任务标题","提示",{confirmButtonText:"确定"})},m=e=>{if(!e)return"";try{return(0,ee.GP)(ne(e),"yyyy-MM-dd HH:mm")}catch(t){return e}};return{taskStore:e,plantStore:t,showTaskForm:a,taskForm:l,editingTask:n,openTaskForm:i,completeSystemTask:r,completeUserTask:c,editTask:d,deleteTask:k,saveTask:u,formatDate:m}}},we=a(1241);const De=(0,we.A)(Le,[["render",O],["__scopeId","data-v-23bf72f9"]]);var xe=De}}]);
//# sourceMappingURL=111.4fa38688.js.map