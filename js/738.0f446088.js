"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[738],{503:function(t,e,n){n.d(e,{c:function(){return s}});var a=n(2261);n(4300);const s=(0,a.nY)("currency",{state:()=>({coins:parseInt(localStorage.getItem("coins")||"100"),loading:!1}),actions:{addCoins(t){this.coins+=t,this.saveCoins()},deductCoins(t){return this.coins>=t&&(this.coins-=t,this.saveCoins(),!0)},saveCoins(){localStorage.setItem("coins",this.coins.toString())},resetCoins(){this.coins=100,this.saveCoins()}}})},5794:function(t,e,n){n.r(e),n.d(e,{default:function(){return dt}});var a=n(6768),s=n(4232);const l={class:"garden-page"},i={class:"container"},r={class:"garden-content"},o={class:"my-garden-section card"},c={key:0,class:"plant-companionship"},u={key:1,class:"empty-garden"},d={key:2,class:"garden-plants-row"},h={class:"plant-avatar"},p=["src"],v={class:"plant-details"},g={class:"plant-header"},k={class:"plant-name"},m={key:0,class:"main-plant-badge"},y={class:"plant-level-container"},f={class:"plant-level"},P={class:"level-value"},w={class:"plant-weather-selector"},C={class:"weather-options"},L=["onClick"],T=["onClick"],b=["onClick"],I={key:0,class:"plant-thought-bubble"},D={class:"thought-content"},_={class:"typing-segment"},M={key:0,class:"typing-cursor"},E={class:"thought-time"},x={class:"plant-introduction"},F={class:"intro-text"},W={class:"plant-actions"},K=["onClick"],X=["onClick","disabled"];function S(t,e,n,S,A,R){const $=(0,a.g2)("el-empty"),Q=(0,a.g2)("WeatherCanvas"),z=(0,a.g2)("el-tag"),B=(0,a.g2)("el-progress"),G=(0,a.g2)("PlantDialog");return(0,a.uX)(),(0,a.CE)("div",l,[e[11]||(e[11]=(0,a.Lk)("div",{class:"garden-background"},null,-1)),(0,a.Lk)("div",i,[e[10]||(e[10]=(0,a.Lk)("div",{class:"garden-header card"},[(0,a.Lk)("h2",{class:"card-title"},"èŠ±è¯­åŠ"),(0,a.Lk)("p",{class:"garden-description"}," åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†ä½ çš„æ¤ç‰©ï¼Œæ‰“é€ å±žäºŽè‡ªå·±çš„èŠ±å›­ã€‚ ")],-1)),(0,a.Lk)("div",r,[(0,a.Lk)("div",o,[e[9]||(e[9]=(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("h3",{class:"section-title"},"æœªå®Œæˆçš„æ˜¥å¤©")],-1)),S.myPlants.length>0?((0,a.uX)(),(0,a.CE)("div",c," ä¸çŸ¥ä¸è§‰ä¸­ï¼Œæ¤ç‰©å·²ç»é™ªä¼´ä½ "+(0,s.v_)(S.plantDays)+"å¤©äº†,é™ªä½ å®Œæˆäº†"+(0,s.v_)(S.completedTasksCount)+"ä¸ªä»»åŠ¡ ",1)):(0,a.Q3)("",!0),0===S.myPlants.length?((0,a.uX)(),(0,a.CE)("div",u,[(0,a.bF)($,{description:"ä½ çš„èŠ±å›­è¿˜ç©ºç©ºå¦‚ä¹Ÿ~"},{image:(0,a.k6)((()=>e[1]||(e[1]=[(0,a.Lk)("div",{class:"empty-image"},"ðŸ¡",-1)]))),_:1})])):((0,a.uX)(),(0,a.CE)("div",d,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(S.filteredPlants,(t=>((0,a.uX)(),(0,a.CE)("div",{key:t.id,class:(0,s.C4)(["garden-plant-item",{"is-main-plant":t.isMainPlant}])},[(0,a.Lk)("div",h,[(0,a.bF)(Q,{weather:t.weather||"sunny",width:200,height:200},null,8,["weather"]),(0,a.Lk)("img",{src:S.getPlantImage(t),class:"plant-image",alt:"æ¤ç‰©å›¾ç‰‡"},null,8,p)]),(0,a.Lk)("div",v,[(0,a.Lk)("div",g,[(0,a.Lk)("div",k,(0,s.v_)(t.name),1),t.isMainPlant?((0,a.uX)(),(0,a.CE)("div",m,[(0,a.bF)(z,{size:"small",type:"success",effect:"dark"},{default:(0,a.k6)((()=>e[2]||(e[2]=[(0,a.eW)("å±•ç¤ºæ¤ç‰©")]))),_:1,__:[2]})])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",y,[(0,a.Lk)("div",f,[e[3]||(e[3]=(0,a.eW)("ç­‰çº§: ")),(0,a.Lk)("span",P,(0,s.v_)(t.level),1)]),(0,a.bF)(B,{percentage:S.calculatePlantExp(t),format:S.expFormat,"stroke-width":10,class:"plant-exp-progress"},null,8,["percentage","format"])]),(0,a.Lk)("div",w,[e[4]||(e[4]=(0,a.Lk)("span",{class:"weather-label"},"çŽ¯å¢ƒ:",-1)),(0,a.Lk)("div",C,[(0,a.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"sunny"===t.weather||!t.weather}]),title:"æ™´å¤©",onClick:e=>S.updatePlantWeather(t,"sunny")},"â˜€ï¸",10,L),(0,a.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"rainy"===t.weather}]),title:"ä¸‹é›¨",onClick:e=>S.updatePlantWeather(t,"rainy")},"ðŸŒ§ï¸",10,T),(0,a.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"cloudy"===t.weather}]),title:"å¤šäº‘",onClick:e=>S.updatePlantWeather(t,"cloudy")},"â˜ï¸",10,b)])]),t.id!==S.showingThoughtForPlantId&&t._id!==S.showingThoughtForPlantId||!S.currentThought?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",I,[e[5]||(e[5]=(0,a.Lk)("div",{class:"thought-bubble-pointer"},null,-1)),(0,a.Lk)("div",D,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(S.displayedSegments,((t,e)=>((0,a.uX)(),(0,a.CE)("span",{key:e,class:"message-segment"},(0,s.v_)(t),1)))),128)),(0,a.Lk)("span",_,(0,s.v_)(S.currentTypingText),1),S.isTyping?((0,a.uX)(),(0,a.CE)("span",M,"|")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",E,(0,s.v_)(S.formatThoughtTime(S.currentThought.timestamp)),1)])),(0,a.Lk)("div",x,[e[6]||(e[6]=(0,a.Lk)("div",{class:"intro-title"},"æ¤ç‰©ä»‹ç»",-1)),(0,a.Lk)("div",F,(0,s.v_)(S.getPlantIntroduction(t.type)),1)])]),(0,a.Lk)("div",W,[(0,a.Lk)("button",{class:"custom-btn listen-btn",onClick:e=>S.listenToPlantThought(t)},e[7]||(e[7]=[(0,a.Lk)("span",{class:"btn-icon"},"ðŸ’¬",-1),(0,a.Lk)("span",{class:"btn-text"},"è†å¬å¿ƒå£°",-1)]),8,K),(0,a.Lk)("button",{class:(0,s.C4)(["custom-btn main-btn",{disabled:t.isMainPlant}]),onClick:e=>S.setAsMainPlant(t),disabled:t.isMainPlant},e[8]||(e[8]=[(0,a.Lk)("span",{class:"btn-icon"},"â­",-1),(0,a.Lk)("span",{class:"btn-text"},"è®¾ä¸ºå±•ç¤ºæ¤ç‰©",-1)]),10,X)])],2)))),128))]))])])]),(0,a.bF)(G,{messages:S.plantStore.thoughts,"is-visible":S.showPlantThoughtDialog,"show-buttons":!1,onPrimaryAction:e[0]||(e[0]=t=>S.showPlantThoughtDialog=!1)},null,8,["messages","is-visible"])])}n(4114),n(8111),n(2489),n(116),n(1701);var A=n(144),R=n(503),$=n(3271),Q=n(2333),z=n(1219),B=n(4871),G=n(9104),H=n(3066),O=n(5796),V=n(8665),Y=n(178),j=n(1145),q=n(3024),J=n(529),N=n(1546),U=n(403),Z=n(2292),tt=n(9151),et=n(2214),nt=n(7243),at=n(3107),st=n(7593),lt=n(902),it=n(2669),rt=n(9428),ot={name:"GardenPage",components:{WeatherCanvas:B.A,PlantDialog:G.A},setup(){const t=(0,R.c)(),e=(0,$.g)(),n=(0,Q.O)(),s=(0,A.KR)(null),l=(0,A.KR)(!1),i=(0,A.KR)(""),r=(0,A.KR)(null),o=(0,A.KR)(null),c=(0,A.KR)([]),u=(0,A.KR)(""),d=(0,A.KR)(!1),h=(0,A.KR)(null),p=50,v=1e3,g=t=>t?t.split(/\n\n|\n/).filter((t=>""!==t.trim())):[],k=t=>{if(y(),t)try{c.value=[],u.value="",d.value=!0;const e=g(t);if(0===e.length)return c.value=[t],void(d.value=!1);let n=0;const a=()=>{if(n>=e.length)return void m();const t=e[n];let s=0;h.value&&clearInterval(h.value),h.value=setInterval((()=>{s<=t.length?(u.value=t.substring(0,s),s++):(clearInterval(h.value),c.value.push(t),u.value="",n++,n<e.length?setTimeout(a,v):m())}),p)};a()}catch(e){console.error("æ‰“å­—æ•ˆæžœå‡ºé”™:",e),c.value=[t],d.value=!1}},m=()=>{d.value=!1,h.value&&(clearInterval(h.value),h.value=null)},y=()=>{d.value=!1,h.value&&(clearInterval(h.value),h.value=null),c.value=[],u.value=""},f=()=>{const t=(new Date).getHours();return t>=5&&t<12?"morning":t>=12&&t<18?"afternoon":"evening"},P=t=>{if(!t)return"";const e={"å‘æ—¥è‘µ":"å‘æ—¥è‘µå¹¶ä¸å…³å¿ƒä¸–ç•Œæ˜¯å¦åœ¨å´©æºƒï¼Œå¥¹åªå…³å¿ƒé˜³å…‰å¤Ÿä¸å¤Ÿæ™’åˆ°å¥¹çš„è„¸ã€‚å¥¹æ—©æ™¨èµ·å¾—æ¯”é—¹é’Ÿè¿˜æ—©ï¼Œæ™šä¸Šç¡å¾—æ¯”æœˆäº®è¿˜è¿Ÿã€‚å¥¹çš„æ¢¦æƒ³å¾ˆç®€å•â€”â€”å¼€ä¸€åœºé˜³å…‰å‘å¸ƒä¼šï¼Œæœ€å¥½è¿˜èƒ½æœ‰æ—©é¤æä¾›ã€‚","ä»™äººæŽŒ":'æ²¡æœ‰äººçœŸæ­£äº†è§£ä»™äººæŽŒã€‚ç”šè‡³è¿žä»™äººæŽŒè‡ªå·±ä¹Ÿä¸æ˜¯å¾ˆç¡®å®šï¼Œä»–åˆ°åº•æ˜¯æ¤ç‰©ï¼Œè¿˜æ˜¯æŸç§ç¡¬æ ¸çš„æƒ…ç»ªé›†åˆä½“ã€‚ä»–å–œæ¬¢ç‹¬å¤„ï¼Œä¸æ˜¯å› ä¸ºå­¤ç‹¬ï¼Œè€Œæ˜¯å› ä¸ºç¤¾äº¤æ—¶è¦è¯´"ä½ å¥½"å¤ªéº»çƒ¦ã€‚',"éƒé‡‘é¦™":'"ä¼˜é›…"ä¸¤ä¸ªå­—ï¼Œå¦‚æžœæœ‰å…·è±¡åŒ–ï¼Œé‚£ä¸€å®šæ˜¯éƒé‡‘é¦™â€”â€”å½“ç„¶ï¼Œæ˜¯ä»–è‡ªå·±è¯´çš„ã€‚ä»–ä¸å±‘äºŽå‚åŠ æ™®é€šæ¤ç‰©çš„èˆžä¼šï¼Œåªåœ¨ä¸¥å¯’çš„åˆå¤œå‡ºåœºï¼Œç„¶åŽä¸€è¨€ä¸å‘åœ°â€¦â€¦é¦™äº†ä¸€ä¸‹ã€‚',"ç™½ç™¾åˆ":'å¥¹ä¸æ˜¯å®‰é™ï¼Œå¥¹æ˜¯å¸¦ç€å›žå£°çš„æ²‰é»˜ã€‚ç™½ç™¾åˆæ€»æ˜¯åœ¨åˆ«äººå´©æºƒè¾¹ç¼˜æ—¶ï¼Œé€’ä¸Šä¸€å¥"è¦ä¸è¦å–ç‚¹çƒ­æ°´ï¼Ÿ"å¥¹å–œæ¬¢ç«™åœ¨é£Žé‡Œå‘å‘†ï¼Œè¯´é‚£æ ·èƒ½å¬è§é¥è¿œæ˜Ÿç³»çš„å¿ƒè·³â€”â€”è™½ç„¶å…¶ä»–æ¤ç‰©è§‰å¾—é‚£æ˜¯ç©ºæ°”æµé€šçš„å£°éŸ³ã€‚',"ç™½ç™¾ä½•":'å¥¹ä¸æ˜¯å®‰é™ï¼Œå¥¹æ˜¯å¸¦ç€å›žå£°çš„æ²‰é»˜ã€‚ç™½ç™¾åˆæ€»æ˜¯åœ¨åˆ«äººå´©æºƒè¾¹ç¼˜æ—¶ï¼Œé€’ä¸Šä¸€å¥"è¦ä¸è¦å–ç‚¹çƒ­æ°´ï¼Ÿ"å¥¹å–œæ¬¢ç«™åœ¨é£Žé‡Œå‘å‘†ï¼Œè¯´é‚£æ ·èƒ½å¬è§é¥è¿œæ˜Ÿç³»çš„å¿ƒè·³â€”â€”è™½ç„¶å…¶ä»–æ¤ç‰©è§‰å¾—é‚£æ˜¯ç©ºæ°”æµé€šçš„å£°éŸ³ã€‚',"çŽ«ç‘°":"å¥¹æ€»æ˜¯è‡ªå¸¦BGMç™»åœºï¼Œå“ªæ€•èƒŒæ™¯æ˜¯ä¸€ç‰‡è’èŠœè‰åœ°ï¼Œå¥¹ä¹Ÿèƒ½èµ°å‡ºçº¢æ¯¯æ—¢è§†æ„Ÿã€‚çŽ«ç‘°æ²¡å…´è¶£å½“å¢™è§’é‡Œçš„ç›†æ ½ï¼Œå¥¹è¦åšèŠ±å›­çš„å¥³ä¸»è§’ï¼Œè¿˜æ˜¯è‡ªç¼–è‡ªå¯¼è‡ªæ¼”çš„é‚£ç§ã€‚"};return e[t.trim()]||""};(0,a.hi)((()=>{y()}));const w={"çŽ«ç‘°":{1:Y,2:j,3:q},"ä»™äººæŽŒ":{1:J,2:N,3:U},"éƒé‡‘é¦™":{1:Z,2:tt,3:et},"ç™½ç™¾ä½•":{1:nt,2:at,3:st},"å‘æ—¥è‘µ":{1:lt,2:it,3:rt}},C=t=>{if(!t||!t.type)return Y;const e=t.type.trim(),n=t.level||1,a=Math.min(Math.max(n,1),3),s=w[e];return s&&s[a]||Y};(0,a.sV)((async()=>{0===e.plants.length&&await e.fetchPlants();const t=e.plants.find((t=>t.isMainPlant));if(!t&&e.plants.length>0){const t=e.plants[0],n=t._id||t.id;if(n)try{await e.updatePlant(n,{isMainPlant:!0}),console.log("è®¾ç½®ä¸»æ¤ç‰©æˆåŠŸ:",t.name)}catch(a){console.error("è®¾ç½®ä¸»æ¤ç‰©å¤±è´¥:",a),z.nk.error("è®¾ç½®ä¸»æ¤ç‰©å¤±è´¥")}}0===n.completedTasks.length&&await n.fetchTasks()}));const L=t=>{const e=t.experience||0,n=t.level||1;return Math.min(100,e/(100*n)*100)},T=t=>{const n=e.plants.find((e=>L(e)===t));if(!n){if(s.value){const t=e.plants.find((t=>t._id===s.value._id||t.id===s.value.id));if(t){const e=t.experience||0,n=t.level||1,a=100*n;return`${e}/${a}`}}return`${Math.round(t)}%`}const a=n.experience||0,l=n.level||1,i=100*l;return`${a}/${i}`},b=async(t,n)=>{if(t.weather===n)return;const a=t._id||t.id;if(!a)return console.error("æ— æ³•æ›´æ–°æ¤ç‰©å¤©æ°”: æ¤ç‰©IDæ— æ•ˆ",t),void z.nk.error("æ›´æ–°å¤±è´¥ï¼šæ— æ³•èŽ·å–æ¤ç‰©ID");console.log("æ›´æ–°æ¤ç‰©å¤©æ°”ï¼Œæ¤ç‰©ID:",a,"å¤©æ°”:",n);try{await e.updatePlant(a,{weather:n}),z.nk.success("æ¤ç‰©çŽ¯å¢ƒå·²æ›´æ–°")}catch(s){console.error("æ›´æ–°æ¤ç‰©å¤©æ°”å¤±è´¥:",s),z.nk.error(`æ›´æ–°å¤±è´¥: ${s.message||"æœªçŸ¥é”™è¯¯"}`)}},I=t=>{if(!t)return"";try{return(0,H.B)(new Date(t),new Date,{addSuffix:!0,locale:V.A})}catch(e){return console.error("æ ¼å¼åŒ–æ—¥æœŸå¤±è´¥:",e),(0,O.GP)(new Date(t),"yyyy-MM-dd HH:mm")}},D=async t=>{const n=t._id||t.id;if(!n)return console.error("æ— æ³•æ˜¾ç¤ºæ¤ç‰©å¿ƒå£°: æ¤ç‰©IDæ— æ•ˆ",t),void z.nk.error("æ— æ³•æ˜¾ç¤ºæ¤ç‰©å¿ƒå£°ï¼šæ¤ç‰©IDæ— æ•ˆ");try{s.value=t,l.value=!0;const a=await e.fetchPlantThoughts(n);e.thoughts=a.map((t=>({type:"plant",content:t.content,timestamp:t.timestamp})))}catch(a){console.error("èŽ·å–æ¤ç‰©å¿ƒå£°å¤±è´¥:",a),z.nk.error("èŽ·å–æ¤ç‰©å¿ƒå£°å¤±è´¥")}},_=async t=>{const a=t._id||t.id;if(!a)return console.error("æ— æ³•èŽ·å–æ¤ç‰©å¿ƒå£°: æ¤ç‰©IDæ— æ•ˆ",t),void z.nk.error("æ— æ³•èŽ·å–æ¤ç‰©å¿ƒå£°ï¼šæ¤ç‰©IDæ— æ•ˆ");try{r.value=a;const s={weather:t.weather||"sunny",timeOfDay:f(),recentTasks:n.completedTasks.slice(0,3).map((t=>({id:t._id||t.id,title:t.title,completed:!0})))},l=await e.generatePlantThought(a,s);l?(o.value=l,k(l.content),(0,z.nk)({message:"æ¤ç‰©æƒ³å’Œä½ è¯´è¯äº†ï¼",type:"success"}),setTimeout((()=>{r.value===a&&(r.value=null,y())}),15e3)):z.nk.warning("æ¤ç‰©ä¼¼ä¹Žä¸æƒ³è¯´è¯...")}catch(s){console.error("èŽ·å–æ¤ç‰©å¿ƒå£°å¤±è´¥",s),z.nk.error("èŽ·å–æ¤ç‰©å¿ƒå£°å¤±è´¥")}},M=async t=>{if(t.isMainPlant)return;const n=t._id||t.id;if(!n)return console.error("æ— æ³•è®¾ç½®ä¸»æ¤ç‰©: æ¤ç‰©IDæ— æ•ˆ",t),void z.nk.error("è®¾ç½®å¤±è´¥ï¼šæ— æ³•èŽ·å–æ¤ç‰©ID");console.log("è®¾ç½®ä¸»æ¤ç‰©ï¼Œæ¤ç‰©ID:",n);try{for(const t of e.plants)if(t.isMainPlant){const n=t._id||t.id;await e.updatePlant(n,{isMainPlant:!1})}await e.updatePlant(n,{isMainPlant:!0}),await e.fetchPlantThoughts(n),l.value&&(s.value=t),z.nk.success("å·²è®¾ç½®ä¸ºä¸»æ¤ç‰©")}catch(a){console.error("è®¾ç½®ä¸»æ¤ç‰©å¤±è´¥:",a),z.nk.error(`è®¾ç½®å¤±è´¥: ${a.message||"æœªçŸ¥é”™è¯¯"}`)}},E=(0,a.EW)((()=>{if(!i.value)return e.plants;const t=i.value.toLowerCase();return e.plants.filter((e=>e.name.toLowerCase().includes(t)))})),x=(0,a.EW)((()=>{if(0===e.plants.length)return 0;const t=e.plants[0];if(!t||!t.createdAt)return 0;const n=new Date(t.createdAt),a=new Date,s=Math.abs(a-n),l=Math.ceil(s/864e5);return l})),F=(0,a.EW)((()=>n.completedTasks.length));return(0,a.wB)((()=>e.plants.find((t=>t.isMainPlant))),(async t=>{if(t){s.value=t;const a=t._id||t.id;if(a)try{const t=await e.fetchPlantThoughts(a);t&&t.length>0&&(o.value=t[0]),l.value&&(e.thoughts=t.map((t=>({type:"plant",content:t.content,timestamp:t.timestamp}))))}catch(n){console.error("æ›´æ–°æ¤ç‰©å¿ƒå£°å¤±è´¥:",n),z.nk.error("æ›´æ–°æ¤ç‰©å¿ƒå£°å¤±è´¥")}}else o.value=null}),{immediate:!0}),{currencyStore:t,plantStore:e,taskStore:n,selectedPlantForDialog:s,showPlantThoughtDialog:l,searchPlant:i,myPlants:(0,a.EW)((()=>e.plants)),filteredPlants:E,plantDays:x,completedTasksCount:F,showingThoughtForPlantId:r,currentThought:o,displayedSegments:c,currentTypingText:u,isTyping:d,calculatePlantExp:L,expFormat:T,updatePlantWeather:b,showDialog:D,listenToPlantThought:_,setAsMainPlant:M,getPlantImage:C,formatThoughtTime:I,getPlantIntroduction:P,startTypingEffect:k,stopTypingEffect:y}}},ct=n(1241);const ut=(0,ct.A)(ot,[["render",S],["__scopeId","data-v-01885cbe"]]);var dt=ut}}]);
//# sourceMappingURL=738.0f446088.js.map