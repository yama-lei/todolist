"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[738],{503:function(t,e,n){n.d(e,{c:function(){return s}});var a=n(2261);n(4300);const s=(0,a.nY)("currency",{state:()=>({coins:parseInt(localStorage.getItem("coins")||"100"),loading:!1}),actions:{addCoins(t){this.coins+=t,this.saveCoins()},deductCoins(t){return this.coins>=t&&(this.coins-=t,this.saveCoins(),!0)},saveCoins(){localStorage.setItem("coins",this.coins.toString())},resetCoins(){this.coins=100,this.saveCoins()}}})},5794:function(t,e,n){n.r(e),n.d(e,{default:function(){return dt}});var a=n(6768),s=n(4232);const l={class:"garden-page"},i={class:"container"},r={class:"garden-content"},o={class:"my-garden-section card"},c={key:0,class:"plant-companionship"},u={key:1,class:"empty-garden"},d={key:2,class:"garden-plants-row"},h={class:"plant-avatar"},p=["src"],v={class:"plant-details"},g={class:"plant-header"},k={class:"plant-name"},m={key:0,class:"main-plant-badge"},y={class:"plant-level-container"},f={class:"plant-level"},P={class:"level-value"},w={class:"plant-weather-selector"},C={class:"weather-options"},L=["onClick"],T=["onClick"],b=["onClick"],I={key:0,class:"plant-thought-bubble"},D={class:"thought-content"},_={class:"typing-segment"},M={key:0,class:"typing-cursor"},E={class:"thought-time"},x={class:"plant-introduction"},F={class:"intro-text"},W={class:"plant-actions"},K=["onClick"],X=["onClick","disabled"];function S(t,e,n,S,A,R){const $=(0,a.g2)("el-empty"),Q=(0,a.g2)("WeatherCanvas"),z=(0,a.g2)("el-tag"),B=(0,a.g2)("el-progress"),G=(0,a.g2)("PlantDialog");return(0,a.uX)(),(0,a.CE)("div",l,[e[11]||(e[11]=(0,a.Lk)("div",{class:"garden-background"},null,-1)),(0,a.Lk)("div",i,[e[10]||(e[10]=(0,a.Lk)("div",{class:"garden-header card"},[(0,a.Lk)("h2",{class:"card-title"},"花语坊"),(0,a.Lk)("p",{class:"garden-description"}," 在这里，你可以查看和管理你的植物，打造属于自己的花园。 ")],-1)),(0,a.Lk)("div",r,[(0,a.Lk)("div",o,[e[9]||(e[9]=(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("h3",{class:"section-title"},"未完成的春天")],-1)),S.myPlants.length>0?((0,a.uX)(),(0,a.CE)("div",c," 不知不觉中，植物已经陪伴你"+(0,s.v_)(S.plantDays)+"天了,陪你完成了"+(0,s.v_)(S.completedTasksCount)+"个任务 ",1)):(0,a.Q3)("",!0),0===S.myPlants.length?((0,a.uX)(),(0,a.CE)("div",u,[(0,a.bF)($,{description:"你的花园还空空如也~"},{image:(0,a.k6)((()=>e[1]||(e[1]=[(0,a.Lk)("div",{class:"empty-image"},"🏡",-1)]))),_:1})])):((0,a.uX)(),(0,a.CE)("div",d,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(S.filteredPlants,(t=>((0,a.uX)(),(0,a.CE)("div",{key:t.id,class:(0,s.C4)(["garden-plant-item",{"is-main-plant":t.isMainPlant}])},[(0,a.Lk)("div",h,[(0,a.bF)(Q,{weather:t.weather||"sunny",width:200,height:200},null,8,["weather"]),(0,a.Lk)("img",{src:S.getPlantImage(t),class:"plant-image",alt:"植物图片"},null,8,p)]),(0,a.Lk)("div",v,[(0,a.Lk)("div",g,[(0,a.Lk)("div",k,(0,s.v_)(t.name),1),t.isMainPlant?((0,a.uX)(),(0,a.CE)("div",m,[(0,a.bF)(z,{size:"small",type:"success",effect:"dark"},{default:(0,a.k6)((()=>e[2]||(e[2]=[(0,a.eW)("展示植物")]))),_:1,__:[2]})])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",y,[(0,a.Lk)("div",f,[e[3]||(e[3]=(0,a.eW)("等级: ")),(0,a.Lk)("span",P,(0,s.v_)(t.level),1)]),(0,a.bF)(B,{percentage:S.calculatePlantExp(t),format:S.expFormat,"stroke-width":10,class:"plant-exp-progress"},null,8,["percentage","format"])]),(0,a.Lk)("div",w,[e[4]||(e[4]=(0,a.Lk)("span",{class:"weather-label"},"环境:",-1)),(0,a.Lk)("div",C,[(0,a.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"sunny"===t.weather||!t.weather}]),title:"晴天",onClick:e=>S.updatePlantWeather(t,"sunny")},"☀️",10,L),(0,a.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"rainy"===t.weather}]),title:"下雨",onClick:e=>S.updatePlantWeather(t,"rainy")},"🌧️",10,T),(0,a.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"cloudy"===t.weather}]),title:"多云",onClick:e=>S.updatePlantWeather(t,"cloudy")},"☁️",10,b)])]),t.id!==S.showingThoughtForPlantId&&t._id!==S.showingThoughtForPlantId||!S.currentThought?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",I,[e[5]||(e[5]=(0,a.Lk)("div",{class:"thought-bubble-pointer"},null,-1)),(0,a.Lk)("div",D,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(S.displayedSegments,((t,e)=>((0,a.uX)(),(0,a.CE)("span",{key:e,class:"message-segment"},(0,s.v_)(t),1)))),128)),(0,a.Lk)("span",_,(0,s.v_)(S.currentTypingText),1),S.isTyping?((0,a.uX)(),(0,a.CE)("span",M,"|")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",E,(0,s.v_)(S.formatThoughtTime(S.currentThought.timestamp)),1)])),(0,a.Lk)("div",x,[e[6]||(e[6]=(0,a.Lk)("div",{class:"intro-title"},"植物介绍",-1)),(0,a.Lk)("div",F,(0,s.v_)(S.getPlantIntroduction(t.type)),1)])]),(0,a.Lk)("div",W,[(0,a.Lk)("button",{class:"custom-btn listen-btn",onClick:e=>S.listenToPlantThought(t)},e[7]||(e[7]=[(0,a.Lk)("span",{class:"btn-icon"},"💬",-1),(0,a.Lk)("span",{class:"btn-text"},"聆听心声",-1)]),8,K),(0,a.Lk)("button",{class:(0,s.C4)(["custom-btn main-btn",{disabled:t.isMainPlant}]),onClick:e=>S.setAsMainPlant(t),disabled:t.isMainPlant},e[8]||(e[8]=[(0,a.Lk)("span",{class:"btn-icon"},"⭐",-1),(0,a.Lk)("span",{class:"btn-text"},"设为展示植物",-1)]),10,X)])],2)))),128))]))])])]),(0,a.bF)(G,{messages:S.plantStore.thoughts,"is-visible":S.showPlantThoughtDialog,"show-buttons":!1,onPrimaryAction:e[0]||(e[0]=t=>S.showPlantThoughtDialog=!1)},null,8,["messages","is-visible"])])}n(4114),n(8111),n(2489),n(116),n(1701);var A=n(144),R=n(503),$=n(3271),Q=n(2333),z=n(1219),B=n(4871),G=n(9104),H=n(3066),O=n(5796),V=n(8665),Y=n(178),j=n(1145),q=n(3024),J=n(529),N=n(1546),U=n(403),Z=n(2292),tt=n(9151),et=n(2214),nt=n(7243),at=n(3107),st=n(7593),lt=n(902),it=n(2669),rt=n(9428),ot={name:"GardenPage",components:{WeatherCanvas:B.A,PlantDialog:G.A},setup(){const t=(0,R.c)(),e=(0,$.g)(),n=(0,Q.O)(),s=(0,A.KR)(null),l=(0,A.KR)(!1),i=(0,A.KR)(""),r=(0,A.KR)(null),o=(0,A.KR)(null),c=(0,A.KR)([]),u=(0,A.KR)(""),d=(0,A.KR)(!1),h=(0,A.KR)(null),p=50,v=1e3,g=t=>t?t.split(/\n\n|\n/).filter((t=>""!==t.trim())):[],k=t=>{if(y(),t)try{c.value=[],u.value="",d.value=!0;const e=g(t);if(0===e.length)return c.value=[t],void(d.value=!1);let n=0;const a=()=>{if(n>=e.length)return void m();const t=e[n];let s=0;h.value&&clearInterval(h.value),h.value=setInterval((()=>{s<=t.length?(u.value=t.substring(0,s),s++):(clearInterval(h.value),c.value.push(t),u.value="",n++,n<e.length?setTimeout(a,v):m())}),p)};a()}catch(e){console.error("打字效果出错:",e),c.value=[t],d.value=!1}},m=()=>{d.value=!1,h.value&&(clearInterval(h.value),h.value=null)},y=()=>{d.value=!1,h.value&&(clearInterval(h.value),h.value=null),c.value=[],u.value=""},f=()=>{const t=(new Date).getHours();return t>=5&&t<12?"morning":t>=12&&t<18?"afternoon":"evening"},P=t=>{if(!t)return"";const e={"向日葵":"向日葵并不关心世界是否在崩溃，她只关心阳光够不够晒到她的脸。她早晨起得比闹钟还早，晚上睡得比月亮还迟。她的梦想很简单——开一场阳光发布会，最好还能有早餐提供。","仙人掌":'没有人真正了解仙人掌。甚至连仙人掌自己也不是很确定，他到底是植物，还是某种硬核的情绪集合体。他喜欢独处，不是因为孤独，而是因为社交时要说"你好"太麻烦。',"郁金香":'"优雅"两个字，如果有具象化，那一定是郁金香——当然，是他自己说的。他不屑于参加普通植物的舞会，只在严寒的午夜出场，然后一言不发地……香了一下。',"白百合":'她不是安静，她是带着回声的沉默。白百合总是在别人崩溃边缘时，递上一句"要不要喝点热水？"她喜欢站在风里发呆，说那样能听见遥远星系的心跳——虽然其他植物觉得那是空气流通的声音。',"白百何":'她不是安静，她是带着回声的沉默。白百合总是在别人崩溃边缘时，递上一句"要不要喝点热水？"她喜欢站在风里发呆，说那样能听见遥远星系的心跳——虽然其他植物觉得那是空气流通的声音。',"玫瑰":"她总是自带BGM登场，哪怕背景是一片荒芜草地，她也能走出红毯既视感。玫瑰没兴趣当墙角里的盆栽，她要做花园的女主角，还是自编自导自演的那种。"};return e[t.trim()]||""};(0,a.hi)((()=>{y()}));const w={"玫瑰":{1:Y,2:j,3:q},"仙人掌":{1:J,2:N,3:U},"郁金香":{1:Z,2:tt,3:et},"白百何":{1:nt,2:at,3:st},"向日葵":{1:lt,2:it,3:rt}},C=t=>{if(!t||!t.type)return Y;const e=t.type.trim(),n=t.level||1,a=Math.min(Math.max(n,1),3),s=w[e];return s&&s[a]||Y};(0,a.sV)((async()=>{0===e.plants.length&&await e.fetchPlants();const t=e.plants.find((t=>t.isMainPlant));if(!t&&e.plants.length>0){const t=e.plants[0],n=t._id||t.id;if(n)try{await e.updatePlant(n,{isMainPlant:!0}),console.log("设置主植物成功:",t.name)}catch(a){console.error("设置主植物失败:",a),z.nk.error("设置主植物失败")}}0===n.completedTasks.length&&await n.fetchTasks()}));const L=t=>{const e=t.experience||0,n=t.level||1;return Math.min(100,e/(100*n)*100)},T=t=>{const n=e.plants.find((e=>L(e)===t));if(!n){if(s.value){const t=e.plants.find((t=>t._id===s.value._id||t.id===s.value.id));if(t){const e=t.experience||0,n=t.level||1,a=100*n;return`${e}/${a}`}}return`${Math.round(t)}%`}const a=n.experience||0,l=n.level||1,i=100*l;return`${a}/${i}`},b=async(t,n)=>{if(t.weather===n)return;const a=t._id||t.id;if(!a)return console.error("无法更新植物天气: 植物ID无效",t),void z.nk.error("更新失败：无法获取植物ID");console.log("更新植物天气，植物ID:",a,"天气:",n);try{await e.updatePlant(a,{weather:n}),z.nk.success("植物环境已更新")}catch(s){console.error("更新植物天气失败:",s),z.nk.error(`更新失败: ${s.message||"未知错误"}`)}},I=t=>{if(!t)return"";try{return(0,H.B)(new Date(t),new Date,{addSuffix:!0,locale:V.A})}catch(e){return console.error("格式化日期失败:",e),(0,O.GP)(new Date(t),"yyyy-MM-dd HH:mm")}},D=async t=>{const n=t._id||t.id;if(!n)return console.error("无法显示植物心声: 植物ID无效",t),void z.nk.error("无法显示植物心声：植物ID无效");try{s.value=t,l.value=!0;const a=await e.fetchPlantThoughts(n);e.thoughts=a.map((t=>({type:"plant",content:t.content,timestamp:t.timestamp})))}catch(a){console.error("获取植物心声失败:",a),z.nk.error("获取植物心声失败")}},_=async t=>{const a=t._id||t.id;if(!a)return console.error("无法获取植物心声: 植物ID无效",t),void z.nk.error("无法获取植物心声：植物ID无效");try{r.value=a;const s={weather:t.weather||"sunny",timeOfDay:f(),recentTasks:n.completedTasks.slice(0,3).map((t=>({id:t._id||t.id,title:t.title,completed:!0})))},l=await e.generatePlantThought(a,s);l?(o.value=l,k(l.content),(0,z.nk)({message:"植物想和你说话了！",type:"success"}),setTimeout((()=>{r.value===a&&(r.value=null,y())}),15e3)):z.nk.warning("植物似乎不想说话...")}catch(s){console.error("获取植物心声失败",s),z.nk.error("获取植物心声失败")}},M=async t=>{if(t.isMainPlant)return;const n=t._id||t.id;if(!n)return console.error("无法设置主植物: 植物ID无效",t),void z.nk.error("设置失败：无法获取植物ID");console.log("设置主植物，植物ID:",n);try{for(const t of e.plants)if(t.isMainPlant){const n=t._id||t.id;await e.updatePlant(n,{isMainPlant:!1})}await e.updatePlant(n,{isMainPlant:!0}),await e.fetchPlantThoughts(n),l.value&&(s.value=t),z.nk.success("已设置为主植物")}catch(a){console.error("设置主植物失败:",a),z.nk.error(`设置失败: ${a.message||"未知错误"}`)}},E=(0,a.EW)((()=>{if(!i.value)return e.plants;const t=i.value.toLowerCase();return e.plants.filter((e=>e.name.toLowerCase().includes(t)))})),x=(0,a.EW)((()=>{if(0===e.plants.length)return 0;const t=e.plants[0];if(!t||!t.createdAt)return 0;const n=new Date(t.createdAt),a=new Date,s=Math.abs(a-n),l=Math.ceil(s/864e5);return l})),F=(0,a.EW)((()=>n.completedTasks.length));return(0,a.wB)((()=>e.plants.find((t=>t.isMainPlant))),(async t=>{if(t){s.value=t;const a=t._id||t.id;if(a)try{const t=await e.fetchPlantThoughts(a);t&&t.length>0&&(o.value=t[0]),l.value&&(e.thoughts=t.map((t=>({type:"plant",content:t.content,timestamp:t.timestamp}))))}catch(n){console.error("更新植物心声失败:",n),z.nk.error("更新植物心声失败")}}else o.value=null}),{immediate:!0}),{currencyStore:t,plantStore:e,taskStore:n,selectedPlantForDialog:s,showPlantThoughtDialog:l,searchPlant:i,myPlants:(0,a.EW)((()=>e.plants)),filteredPlants:E,plantDays:x,completedTasksCount:F,showingThoughtForPlantId:r,currentThought:o,displayedSegments:c,currentTypingText:u,isTyping:d,calculatePlantExp:L,expFormat:T,updatePlantWeather:b,showDialog:D,listenToPlantThought:_,setAsMainPlant:M,getPlantImage:C,formatThoughtTime:I,getPlantIntroduction:P,startTypingEffect:k,stopTypingEffect:y}}},ct=n(1241);const ut=(0,ct.A)(ot,[["render",S],["__scopeId","data-v-01885cbe"]]);var dt=ut}}]);
//# sourceMappingURL=738.0f446088.js.map