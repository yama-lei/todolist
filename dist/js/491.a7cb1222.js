"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[491],{3446:function(e,t,a){a.d(t,{D:function(){return n}});a(8111),a(2489);var l=a(2261),o=a(144),s=(a(3271),a(4300)),i=a(1219);const n=(0,l.nY)("post",(()=>{const e=(0,o.KR)([]),t=(0,o.KR)(!1),a=async(a="all")=>{t.value=!0;try{const t=await s.d_.getPosts(a);return e.value=t.posts,t.posts}catch(l){return console.error("获取帖子失败:",l),i.nk.error("获取帖子列表失败"),[]}finally{t.value=!1}},l=async e=>{try{const t={...e,createdAt:e.createdAt||(new Date).toISOString()};console.log("准备提交到后端的帖子数据:",t);await s.d_.createPost(t);return await a(),!0}catch(t){return console.error("发布失败:",t),i.nk.error("发布失败，请稍后再试"),!1}},n=async(e,t=[],a="")=>await l({content:e,images:t,location:a,type:"thought"}),u=async a=>{t.value=!0;try{return await s.d_.deletePost(a),e.value=e.value.filter((e=>e._id!==a)),i.nk.success("删除成功"),!0}catch(l){return console.error("删除帖子失败:",l),i.nk.error("删除失败，请稍后再试"),!1}finally{t.value=!1}},r=async(e,t)=>{try{const l={...t,createdAt:t.createdAt||(new Date).toISOString()};console.log("更新帖子数据:",l);await s.d_.updatePost(e,l);return await a(),i.nk.success("更新成功"),!0}catch(l){return console.error("更新失败:",l),i.nk.error("更新失败，请稍后再试"),!1}},c=()=>{a()};return c(),{posts:e,loading:t,fetchPosts:a,addPost:n,addCustomPost:l,removePost:u,updatePost:r}}))},3491:function(e,t,a){a.r(t),a.d(t,{default:function(){return ie}});a(4114),a(8111),a(2489),a(1701);var l=a(6768),o=a(144),s=a(4232),i=a(3446),n=(a(5796),a(7477)),u=a(1219),r=a(5320);const c={class:"timeline-container"},d={class:"timeline"},v={class:"timeline-date"},p={class:"date-bubble"},y={class:"time-text"},m={key:0,class:"content-header"},k={class:"content-title"},g={class:"content-body"},h={class:"content-text"},f={key:0,class:"content-images"},w={key:0,class:"image-count"},L={class:"content-footer"},b={class:"post-actions"},_={key:0,class:"empty-timeline"},F={class:"dialog-footer"};var C={__name:"TimeLinePage",props:{stories:{type:Array,default:()=>[]}},emits:["delete-post","edit-post"],setup(e,{emit:t}){const a=e,n=(0,l.EW)((()=>[...a.stories].sort(((e,t)=>{const a=new Date(e.time).getTime(),l=new Date(t.time).getTime();return l-a})))),u=((0,i.D)(),(0,o.KR)(!1)),r=(0,o.KR)(null),C=t,R=e=>{if(!e)return"未知时间";try{const t=new Date(e);return isNaN(t.getTime())?(console.warn("无效的日期格式:",e),"无效时间"):t.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}catch(t){return console.error("日期格式化错误:",t),"无效时间"}},S=e=>{if(!e)return"";try{const t=new Date(e);return isNaN(t.getTime())?(console.warn("无效的时间格式:",e),""):t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("时间格式化错误:",t),""}},$=e=>{r.value=e,u.value=!0},x=async()=>{r.value&&(C("delete-post",r.value),u.value=!1,r.value=null)},A=e=>{C("edit-post",e)};return(t,a)=>{const o=(0,l.g2)("el-image"),i=(0,l.g2)("el-button"),r=(0,l.g2)("el-empty"),C=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",c,[(0,l.Lk)("div",d,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.value,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"timeline-item"},[(0,l.Lk)("div",v,[(0,l.Lk)("div",p,(0,s.v_)(R(e.time)),1),(0,l.Lk)("div",y,(0,s.v_)(S(e.time)),1)]),(0,l.Lk)("div",{class:(0,s.C4)(["timeline-content",{"is-diary":"diary"===e.postType}])},[(0,l.Lk)("div",{class:(0,s.C4)(["post-type-tag",{diary:"diary"===e.postType}])},(0,s.v_)("diary"===e.postType?"日记":"说说"),3),!e.title||"diary"!==e.postType&&""===e.title.trim()?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",m,[(0,l.Lk)("h3",k,(0,s.v_)(e.title),1)])),(0,l.Lk)("div",g,[(0,l.Lk)("p",h,(0,s.v_)(e.description),1),e.imageSrc?((0,l.uX)(),(0,l.CE)("div",f,[(0,l.bF)(o,{src:e.imageSrc,"preview-src-list":e.galleryImages||[e.imageSrc],fit:"cover",class:"content-image"},null,8,["src","preview-src-list"]),(e.galleryImages?.length||0)>1?((0,l.uX)(),(0,l.CE)("div",w," +"+(0,s.v_)(e.galleryImages.length-1),1)):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",L,[(0,l.Lk)("div",b,[(0,l.bF)(i,{size:"small",type:"primary",text:"",onClick:t=>A(e)},{default:(0,l.k6)((()=>a[2]||(a[2]=[(0,l.eW)(" 编辑 ")]))),_:2},1032,["onClick"]),(0,l.bF)(i,{size:"small",type:"danger",text:"",onClick:t=>$(e.id)},{default:(0,l.k6)((()=>a[3]||(a[3]=[(0,l.eW)(" 删除 ")]))),_:2},1032,["onClick"])])])],2)])))),128)),0===e.stories.length?((0,l.uX)(),(0,l.CE)("div",_,[(0,l.bF)(r,{description:"还没有内容，快来发布一条吧！"})])):(0,l.Q3)("",!0)]),(0,l.bF)(C,{modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=e=>u.value=e),title:"确认删除",width:"300px"},{footer:(0,l.k6)((()=>[(0,l.Lk)("span",F,[(0,l.bF)(i,{onClick:a[0]||(a[0]=e=>u.value=!1)},{default:(0,l.k6)((()=>a[4]||(a[4]=[(0,l.eW)("取消")]))),_:1}),(0,l.bF)(i,{type:"danger",onClick:x},{default:(0,l.k6)((()=>a[5]||(a[5]=[(0,l.eW)("确定")]))),_:1})])])),default:(0,l.k6)((()=>[a[6]||(a[6]=(0,l.Lk)("span",null,"确定要删除这条记录吗？",-1))])),_:1},8,["modelValue"])])}}},R=a(1241);const S=(0,R.A)(C,[["__scopeId","data-v-c7c831cc"]]);var $=S,x=a(5011);const A={class:"posts-container"},E={class:"content-card"},K={class:"thought-input-placeholder"},I={class:"filter-tabs"},D={class:"timeline-wrapper"},P={class:"post-type-selector"},X={key:0,class:"diary-header"},V={class:"diary-date"},W={class:"diary-day"},T={class:"diary-month-year"},j={key:0,class:"diary-weather-mood"},O={key:0,class:"diary-weather"},Q={key:1,class:"diary-mood"},z={key:1,class:"diary-toolbar"},U={class:"toolbar-group"},N={class:"toolbar-group"},B={key:0,class:"diary-image-count"},H={class:"post-options"},M={class:"weather-options"},Y=["onClick"],q={class:"weather-icon"},G={class:"mood-selector"},J=["onClick"],Z={class:"mood-emoji"},ee={class:"mood-text"},te={key:0,class:"upload-title"},ae=["src"],le={class:"dialog-footer"};var oe={__name:"Posts",setup(e){const t=(0,i.D)(),a=(0,o.KR)(!1),c=(0,o.KR)(!1),d=(0,o.KR)(!1),v=(0,o.KR)(!1),p=(0,o.KR)("thought"),y=(0,o.KR)("all"),m=(0,o.KR)(!1),k=(0,o.KR)(null),g=(0,o.KR)([]),h=(0,o.KR)(""),f=(0,o.KR)(!1),w=(0,o.KR)(!1),L=(0,o.KR)({title:"",content:"",images:[],uploadFiles:[],location:"",mood:"",weather:"",type:"thought"}),b=[{emoji:"😊",text:"开心",value:"happy"},{emoji:"😢",text:"伤心",value:"sad"},{emoji:"😡",text:"生气",value:"angry"},{emoji:"😴",text:"疲惫",value:"tired"},{emoji:"🥰",text:"爱意",value:"love"},{emoji:"🤔",text:"思考",value:"thinking"}],_=e=>{const t=b.find((t=>t.value===e));return t?`${t.emoji} ${t.text}`:""},F=()=>{v.value=!v.value},C=e=>{L.value.mood=e,v.value=!1},R=(0,l.EW)((()=>"diary"===p.value?L.value.title.trim()&&L.value.content.trim():L.value.content.trim())),S=(0,l.EW)((()=>{if(!Array.isArray(t.posts))return console.warn("posts 不是数组:",t.posts),[];let e=[...t.posts];return console.log("原始帖子数据:",e),"all"!==y.value&&(e=e.filter((e=>e.type===y.value))),e.sort(((e,t)=>{const a=e.updatedAt?new Date(e.updatedAt).getTime():0,l=t.updatedAt?new Date(t.updatedAt).getTime():0;return a-l})),e.map((e=>{console.log("后端返回的帖子：",e),console.log("处理帖子日期:",{id:e._id,createdAt:e.createdAt});let t=e.title||"";if(!t)if(e.location)t=`📍 ${e.location}`;else if(e.mood){const a=b.find((t=>t.value===e.mood));t=a?`${a.emoji} ${a.text}`:""}else t="diary"===e.type?"无标题日记":"";let a=e.content;if(e.weather&&"diary"===e.type){const t={sunny:"☀️ 晴天",rainy:"🌧️ 下雨",cloudy:"☁️ 多云",snowy:"❄️ 下雪"};a=`${t[e.weather]||""}\n${a}`}return{time:e.updatedAt,title:t,description:a,imageSrc:e.images&&e.images.length>0?e.images[0]:null,galleryImages:e.images||[],id:e._id,postType:e.type,location:e.location,mood:e.mood,weather:e.weather}}))})),oe=async()=>{await t.fetchPosts("all"===y.value?"":y.value)};(0,l.wB)(y,(async()=>{await oe()}));const se=()=>{L.value={title:"",content:"",images:[],uploadFiles:[],location:"",mood:"neutral",weather:"sunny",type:p.value},g.value=[],c.value=!1,d.value=!1,v.value=!1,m.value=!1,k.value=null},ie=async e=>{const a=await t.removePost(e);a&&oe()};(0,l.sV)((()=>{oe()}));const ne=e=>{h.value=e.url||URL.createObjectURL(e.raw),f.value=!0},ue=e=>{L.value.uploadFiles||(L.value.uploadFiles=[]),L.value.uploadFiles.push(e.raw);const t=URL.createObjectURL(e.raw);e.url=t},re=e=>{if(L.value.uploadFiles){const t=L.value.uploadFiles.findIndex((t=>t===e.raw));-1!==t&&L.value.uploadFiles.splice(t,1)}if(e.url&&e.url.startsWith("http")){const t=L.value.images.indexOf(e.url);-1!==t&&L.value.images.splice(t,1)}},ce=async()=>{if(!L.value.uploadFiles||0===L.value.uploadFiles.length)return[];w.value=!0;try{console.log("准备上传图片，数量:",L.value.uploadFiles.length);const e=await x.A.uploadMultipleFiles(L.value.uploadFiles);return console.log("图片上传成功，URL列表:",e),L.value.uploadFiles=[],e||[]}catch(e){return console.error("上传图片失败:",e),u.nk.error(`上传图片失败: ${e.message||"未知错误"}`),[]}finally{w.value=!1}},de=()=>{document.getElementById("upload-section")?.scrollIntoView({behavior:"smooth"})};(0,l.wB)(p,(e=>{L.value.type=e,console.log("切换类型为:",e)}));const ve=(e="thought")=>{m.value=!1,k.value=null,p.value=e,L.value={title:"",content:"",images:[],uploadFiles:[],location:"",mood:"neutral",weather:"sunny",type:e},g.value=[],a.value=!0},pe=e=>{m.value=!0,k.value=e.id,p.value=e.postType,L.value={title:e.title,content:e.description,images:e.galleryImages||[],uploadFiles:[],location:e.location||"",mood:e.mood||"",weather:e.weather||"",type:e.postType,createdAt:e.time},g.value=(e.galleryImages||[]).map(((e,t)=>({name:`已有图片${t+1}`,url:e,status:"success"}))),L.value.location&&(c.value=!0),L.value.weather&&(d.value=!0),a.value=!0},ye=async()=>{if(R.value)try{const e=r.Ks.service({lock:!0,text:"正在处理图片和提交内容，请稍候...",background:"rgba(0, 0, 0, 0.7)"});let l=[];L.value.uploadFiles&&L.value.uploadFiles.length>0&&(l=await ce());let o=[...L.value.images||[]];o=[...o,...l];const s={...L.value,images:o,createdAt:m.value?L.value.createdAt:(new Date).toISOString()};let i;delete s.uploadFiles,console.log("准备提交的帖子数据:",s),i=m.value?await t.updatePost(k.value,s):await t.addCustomPost(s),e.close(),i&&(se(),a.value=!1,await oe(),u.nk.success(m.value?"更新成功":"发布成功"))}catch(e){console.error("操作失败:",e),u.nk.error("操作失败，请稍后再试")}};return(e,t)=>{const i=(0,l.g2)("el-icon"),u=(0,l.g2)("el-input"),r=(0,l.g2)("el-form-item"),k=(0,l.g2)("el-button"),w=(0,l.g2)("el-upload"),x=(0,l.g2)("el-dialog"),oe=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",A,[t[21]||(t[21]=(0,l.Lk)("div",{class:"page-header"},[(0,l.Lk)("h1",{class:"page-title"},"心情空间"),(0,l.Lk)("p",{class:"page-subtitle"},"记录生活的点滴，分享心情的瞬间")],-1)),(0,l.Lk)("div",E,[(0,l.Lk)("div",{class:"thought-input-area",onClick:t[0]||(t[0]=e=>ve("thought"))},[(0,l.Lk)("div",K,[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Edit))])),_:1}),t[15]||(t[15]=(0,l.Lk)("span",null,"写下心中碎碎念...",-1))])]),(0,l.Lk)("div",I,[(0,l.Lk)("div",{class:(0,s.C4)(["filter-tab",{active:"all"===y.value}]),onClick:t[1]||(t[1]=e=>y.value="all")}," 全部 ",2),(0,l.Lk)("div",{class:(0,s.C4)(["filter-tab",{active:"diary"===y.value}]),onClick:t[2]||(t[2]=e=>y.value="diary")}," 日记 ",2),(0,l.Lk)("div",{class:(0,s.C4)(["filter-tab",{active:"thought"===y.value}]),onClick:t[3]||(t[3]=e=>y.value="thought")}," 说说 ",2)])]),(0,l.Lk)("div",D,[(0,l.bF)($,{stories:S.value,onDeletePost:ie,onEditPost:pe},null,8,["stories"])]),(0,l.bF)(x,{modelValue:a.value,"onUpdate:modelValue":t[14]||(t[14]=e=>a.value=e),title:m.value?"diary"===p.value?"编辑日记":"编辑说说":"diary"===p.value?"写日记":"发说说",width:"65%","custom-class":"post-dialog","destroy-on-close":"",fullscreen:!1},{footer:(0,l.k6)((()=>[(0,l.Lk)("div",le,[(0,l.bF)(k,{onClick:t[13]||(t[13]=e=>a.value=!1)},{default:(0,l.k6)((()=>t[20]||(t[20]=[(0,l.eW)("取消")]))),_:1}),(0,l.bF)(k,{type:"primary",onClick:ye,disabled:!R.value,size:"diary"===p.value?"large":"default"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(m.value?"保存修改":"diary"===p.value?"保存日记":"发布说说"),1)])),_:1},8,["disabled","size"])])])),default:(0,l.k6)((()=>[(0,l.Lk)("div",P,[(0,l.Lk)("div",{class:(0,s.C4)(["post-type-option",{active:"thought"===p.value}]),onClick:t[4]||(t[4]=e=>p.value="thought")},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.ChatDotRound))])),_:1}),t[16]||(t[16]=(0,l.Lk)("span",null,"说说",-1))],2),(0,l.Lk)("div",{class:(0,s.C4)(["post-type-option",{active:"diary"===p.value}]),onClick:t[5]||(t[5]=e=>p.value="diary")},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Notebook))])),_:1}),t[17]||(t[17]=(0,l.Lk)("span",null,"日记",-1))],2)]),"diary"===p.value?((0,l.uX)(),(0,l.CE)("div",X,[(0,l.Lk)("div",V,[(0,l.Lk)("div",W,(0,s.v_)((new Date).getDate()),1),(0,l.Lk)("div",T,(0,s.v_)((new Date).toLocaleDateString("zh-CN",{month:"long",year:"numeric"})),1)]),L.value.weather||L.value.mood?((0,l.uX)(),(0,l.CE)("div",j,[L.value.weather?((0,l.uX)(),(0,l.CE)("span",O,(0,s.v_)({sunny:"☀️ 晴天",rainy:"🌧️ 下雨",cloudy:"☁️ 多云",snowy:"❄️ 下雪"}[L.value.weather]||""),1)):(0,l.Q3)("",!0),L.value.mood?((0,l.uX)(),(0,l.CE)("span",Q,(0,s.v_)(_(L.value.mood)),1)):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.bF)(oe,{class:"diary-form"},{default:(0,l.k6)((()=>["diary"===p.value?((0,l.uX)(),(0,l.Wv)(r,{key:0,class:"diary-title-item"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:L.value.title,"onUpdate:modelValue":t[6]||(t[6]=e=>L.value.title=e),placeholder:"给今天写个标题...","prefix-icon":(0,o.R1)(n.Document),class:"diary-title-input",size:"diary"===p.value?"large":"default"},null,8,["modelValue","prefix-icon","size"])])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(r,{class:"diary-content-item"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:L.value.content,"onUpdate:modelValue":t[7]||(t[7]=e=>L.value.content=e),type:"textarea",rows:"diary"===p.value?10:6,placeholder:"diary"===p.value?"今天发生了什么...\n\n写下此刻的心情，记录生活的点滴...":"此刻的想法...",class:"diary-content",resize:"none"},null,8,["modelValue","rows","placeholder"])])),_:1}),"diary"===p.value?((0,l.uX)(),(0,l.CE)("div",z,[(0,l.Lk)("div",U,[(0,l.Lk)("div",{class:"option-item",onClick:F},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.StarFilled))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(L.value.mood?`心情：${_(L.value.mood)}`:"添加心情"),1)]),(0,l.Lk)("div",{class:"option-item",onClick:t[8]||(t[8]=e=>c.value=!c.value)},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Location))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(c.value?"隐藏位置":"添加位置"),1)]),(0,l.Lk)("div",{class:"option-item",onClick:t[9]||(t[9]=e=>d.value=!d.value)},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Sunny))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(d.value?"隐藏天气":"添加天气"),1)])]),(0,l.Lk)("div",N,[L.value.images.length>0?((0,l.uX)(),(0,l.CE)("div",B," 已添加 "+(0,s.v_)(L.value.images.length)+" 张图片 ",1)):(0,l.Q3)("",!0),(0,l.bF)(k,{size:"small",onClick:de},{default:(0,l.k6)((()=>t[18]||(t[18]=[(0,l.eW)("添加图片")]))),_:1})])])):(0,l.Q3)("",!0),"diary"!==p.value?((0,l.uX)(),(0,l.Wv)(r,{key:2,class:"thought-options"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",H,[(0,l.Lk)("div",{class:"option-item",onClick:F},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.StarFilled))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(L.value.mood?`心情：${_(L.value.mood)}`:"添加心情"),1)]),(0,l.Lk)("div",{class:"option-item",onClick:t[10]||(t[10]=e=>c.value=!c.value)},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Location))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(c.value?"隐藏位置":"添加位置"),1)])])])),_:1})):(0,l.Q3)("",!0),c.value?((0,l.uX)(),(0,l.Wv)(r,{key:3},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:L.value.location,"onUpdate:modelValue":t[11]||(t[11]=e=>L.value.location=e),placeholder:"我在哪里...","prefix-icon":(0,o.R1)(n.Location),class:"location-input"},null,8,["modelValue","prefix-icon"])])),_:1})):(0,l.Q3)("",!0),d.value&&"diary"===p.value?((0,l.uX)(),(0,l.Wv)(r,{key:4,class:"weather-selector"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",M,[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)({sunny:"☀️ 晴天",rainy:"🌧️ 下雨",cloudy:"☁️ 多云",snowy:"❄️ 下雪"},((e,t)=>(0,l.Lk)("div",{key:t,class:(0,s.C4)(["weather-option",{active:L.value.weather===t}]),onClick:e=>L.value.weather=t},[(0,l.Lk)("span",q,(0,s.v_)(e.split(" ")[0]),1),(0,l.Lk)("span",null,(0,s.v_)(e.split(" ")[1]),1)],10,Y))),64))])])),_:1})):(0,l.Q3)("",!0),v.value?((0,l.uX)(),(0,l.Wv)(r,{key:5,class:"mood-item"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",G,[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(b,(e=>(0,l.Lk)("div",{key:e.value,class:(0,s.C4)(["mood-item",{active:L.value.mood===e.value}]),onClick:t=>C(e.value)},[(0,l.Lk)("span",Z,(0,s.v_)(e.emoji),1),(0,l.Lk)("span",ee,(0,s.v_)(e.text),1)],10,J))),64))])])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(r,{id:"upload-section"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",{class:(0,s.C4)(["upload-area",{"diary-upload":"diary"===p.value}])},["diary"===p.value?((0,l.uX)(),(0,l.CE)("div",te,"添加图片记录美好瞬间")):(0,l.Q3)("",!0),(0,l.bF)(w,{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":ue,"on-remove":re,"file-list":g.value,"on-preview":ne},{default:(0,l.k6)((()=>[(0,l.bF)(i,{class:"upload-icon"},{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Plus))])),_:1}),t[19]||(t[19]=(0,l.Lk)("span",{class:"upload-text"},"添加图片",-1))])),_:1},8,["file-list"]),(0,l.bF)(x,{modelValue:f.value,"onUpdate:modelValue":t[12]||(t[12]=e=>f.value=e)},{default:(0,l.k6)((()=>[(0,l.Lk)("img",{"w-full":"",src:h.value,alt:"预览图片"},null,8,ae)])),_:1},8,["modelValue"])],2)])),_:1})])),_:1})])),_:1},8,["modelValue","title"])])}}};const se=(0,R.A)(oe,[["__scopeId","data-v-0dc2d5a7"]]);var ie=se},5011:function(e,t,a){a(8111),a(1701);var l=a(4300),o=a(788),s=a.n(o);const i={getOSSConfig(){return l.Ay.get("/oss/config")},getOSSPolicy(e="posts/"){return l.Ay.get("/oss/policy",{params:{dir:e}})},async uploadFile(e,t="posts/"){try{const a=await this.getOSSPolicy(t),l=a.policy;if(!l)throw new Error("获取上传策略失败");let o=l.host;"object"===typeof o&&(console.error("Host 是一个对象而不是字符串:",o),o=`https://${l.bucket}.${l.region}.aliyuncs.com`),o.startsWith("http")||(o=`https://${o}`);const i=new FormData,n=`${l.key}${e.name.substring(e.name.lastIndexOf("."))}`;i.append("key",n),i.append("OSSAccessKeyId",l.accessKeyId),i.append("policy",l.policyBase64),i.append("signature",l.signature),i.append("success_action_status","200"),i.append("file",e),console.log("正在上传文件到:",o),await s().post(o,i,{headers:{"Content-Type":"multipart/form-data"}});let u=l.cdnHost||o;"object"===typeof u&&(u=o);const r=`${u}/${n}`;return console.log("文件上传成功，URL:",r),r}catch(a){throw console.error("上传文件到OSS失败:",a),a}},async uploadMultipleFiles(e,t="posts/"){if(!e||0===e.length)return[];try{const a=await this.getOSSPolicy(t),l=a.policy;if(!l)throw new Error("获取上传策略失败");let o=l.host;"object"===typeof o&&(console.error("Host 是一个对象而不是字符串:",o),o=`https://${l.bucket}.${l.region}.aliyuncs.com`),o.startsWith("http")||(o=`https://${o}`),console.log("准备批量上传文件到:",o);const i=e.map((async(t,a)=>{try{const i=new FormData,n=`${l.key}-${a}${t.name.substring(t.name.lastIndexOf("."))}`;i.append("key",n),i.append("OSSAccessKeyId",l.accessKeyId),i.append("policy",l.policyBase64),i.append("signature",l.signature),i.append("success_action_status","200"),i.append("file",t),await s().post(o,i,{headers:{"Content-Type":"multipart/form-data"}});let u=l.cdnHost||o;"object"===typeof u&&(u=o);const r=`${u}/${n}`;return console.log(`文件 ${a+1}/${e.length} 上传成功:`,r),r}catch(i){throw console.error(`文件 ${a+1}/${e.length} 上传失败:`,i),i}})),n=await Promise.all(i);return console.log("所有文件上传完成，URL列表:",n),n}catch(a){throw console.error("批量上传文件到OSS失败:",a),a}}};t.A=i}}]);
//# sourceMappingURL=491.a7cb1222.js.map