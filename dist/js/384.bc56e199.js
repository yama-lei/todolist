"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[384],{2333:function(e,t,a){a.d(t,{O:function(){return i}});a(4114),a(8111),a(2489),a(116);var n=a(2261),r=a(144),o=a(6768),l=a(3271),s=a(4300),c=a(1219);const i=(0,n.nY)("task",(()=>{const e=(0,r.KR)([]),t=(0,r.KR)([]),a=(0,r.KR)([]),n=(0,r.KR)(!1),i=(0,o.EW)((()=>e.value.filter((e=>!e.completed)))),u=async()=>{try{n.value=!0;const t=await s.WY.getTasks();e.value=t.tasks.filter((e=>!e.completed)),a.value=t.tasks.filter((e=>e.completed))}catch(t){c.nk.error("è·å–ä»»åŠ¡åˆ—è¡¨å¤±è´¥")}finally{n.value=!1}},d=async()=>{try{n.value=!0;const e=await s.WY.getSystemTasks();t.value=e.tasks}catch(e){c.nk.error("è·å–ç³»ç»Ÿä»»åŠ¡å¤±è´¥")}finally{n.value=!1}},k=async t=>{try{const a=await s.WY.createTask({title:t.title,description:t.description||"",deadline:t.deadline||"",important:t.important||!1});e.value.push(a.task),c.nk.success("ä»»åŠ¡åˆ›å»ºæˆåŠŸ")}catch(a){c.nk.error("åˆ›å»ºä»»åŠ¡å¤±è´¥")}},p=async t=>{try{await s.WY.completeTask(t);const n=e.value.find((e=>e._id===t));n&&(a.value.unshift({...n,completed:!0,completedAt:(new Date).toISOString()}),e.value=e.value.filter((e=>e._id!==t)));const r=(0,l.g)();if(r.plants&&r.plants.length>0){const e=r.plants.find((e=>e.isMainPlant));if(e){const t=e._id||e.id;if(t){const e=n&&n.important?50:25;await r.gainExperience(t,e),c.nk.success(`ä»»åŠ¡å·²å®Œæˆï¼Œè·å¾— ${e} ç‚¹ç»éªŒå€¼ï¼`)}}}else c.nk.success("ä»»åŠ¡å·²å®Œæˆ")}catch(n){c.nk.error("å®Œæˆä»»åŠ¡å¤±è´¥")}},g=async e=>{try{const a=(0,l.g)();if(!a.currentPlant)return c.nk.warning("è¯·å…ˆæ·»åŠ ä¸€ä¸ªæ¤ç‰©"),!1;const n=await s.WY.completeSystemTask(e),r=t.value.findIndex((t=>t._id===e));if(-1!==r&&(t.value[r].completed=!0),n.rewards)c.nk.success(`å®Œæˆä»»åŠ¡è·å¾— ${n.rewards.experience} ç‚¹ç»éªŒ`);else{const e=a.currentPlant._id||a.currentPlant.id;if(e){const t=35;await a.gainExperience(e,t),c.nk.success(`å®Œæˆç³»ç»Ÿä»»åŠ¡è·å¾— ${t} ç‚¹ç»éªŒå€¼`)}}return!0}catch(a){return 400===a.response?.status?c.nk.warning("ä»Šå¤©å·²ç»å®Œæˆè¿‡æ­¤ä»»åŠ¡"):c.nk.error("å®Œæˆç³»ç»Ÿä»»åŠ¡å¤±è´¥"),!1}},h=async t=>{try{if(!t)return void c.nk.error("ä»»åŠ¡IDæ— æ•ˆï¼Œæ— æ³•åˆ é™¤");await s.WY.deleteTask(t),e.value=e.value.filter((e=>e._id!==t)),c.nk.success("ä»»åŠ¡å·²åˆ é™¤")}catch(a){console.error("åˆ é™¤ä»»åŠ¡å¤±è´¥:",a),c.nk.error("åˆ é™¤ä»»åŠ¡å¤±è´¥")}},v=async e=>{try{if(!e)return void c.nk.error("ä»»åŠ¡IDæ— æ•ˆï¼Œæ— æ³•åˆ é™¤");await s.WY.deleteTask(e),a.value=a.value.filter((t=>t._id!==e)),c.nk.success("ä»»åŠ¡å·²åˆ é™¤")}catch(t){console.error("åˆ é™¤ä»»åŠ¡å¤±è´¥:",t),c.nk.error("åˆ é™¤ä»»åŠ¡å¤±è´¥")}},m=async t=>{try{const{_id:a,title:n,description:r,deadline:o,important:l}=t,i=await s.WY.updateTask(a,{title:n,description:r,deadline:o,important:l}),u=e.value.findIndex((e=>e._id===a));-1!==u&&(e.value[u]=i.task),c.nk.success("ä»»åŠ¡å·²æ›´æ–°")}catch(a){c.nk.error("æ›´æ–°ä»»åŠ¡å¤±è´¥")}},f=async t=>{const a=e.value.find((e=>e._id===t));a&&await m({...a,important:!a.important})};return{tasks:e,systemTasks:t,completedTasks:a,pendingTasks:i,loading:n,fetchTasks:u,fetchSystemTasks:d,addTask:k,completeTask:p,completeSystemTask:g,removeTask:h,removeCompletedTask:v,updateTask:m,toggleTaskImportance:f}}))},3446:function(e,t,a){a.d(t,{D:function(){return s}});a(8111),a(2489);var n=a(2261),r=a(144),o=(a(3271),a(4300)),l=a(1219);const s=(0,n.nY)("post",(()=>{const e=(0,r.KR)([]),t=(0,r.KR)(!1),a=async(a="all")=>{t.value=!0;try{const t=await o.d_.getPosts(a);return e.value=t.posts,t.posts}catch(n){return console.error("è·å–å¸–å­å¤±è´¥:",n),l.nk.error("è·å–å¸–å­åˆ—è¡¨å¤±è´¥"),[]}finally{t.value=!1}},n=async e=>{try{const t={...e,createdAt:e.createdAt||(new Date).toISOString()};console.log("å‡†å¤‡æäº¤åˆ°åç«¯çš„å¸–å­æ•°æ®:",t);await o.d_.createPost(t);return await a(),!0}catch(t){return console.error("å‘å¸ƒå¤±è´¥:",t),l.nk.error("å‘å¸ƒå¤±è´¥ï¼Œè¯·ç¨åå†è¯•"),!1}},s=async(e,t=[],a="")=>await n({content:e,images:t,location:a,type:"thought"}),c=async a=>{t.value=!0;try{return await o.d_.deletePost(a),e.value=e.value.filter((e=>e._id!==a)),l.nk.success("åˆ é™¤æˆåŠŸ"),!0}catch(n){return console.error("åˆ é™¤å¸–å­å¤±è´¥:",n),l.nk.error("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•"),!1}finally{t.value=!1}},i=async(e,t)=>{try{const n={...t,createdAt:t.createdAt||(new Date).toISOString()};console.log("æ›´æ–°å¸–å­æ•°æ®:",n);await o.d_.updatePost(e,n);return await a(),l.nk.success("æ›´æ–°æˆåŠŸ"),!0}catch(n){return console.error("æ›´æ–°å¤±è´¥:",n),l.nk.error("æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åå†è¯•"),!1}},u=()=>{a()};return u(),{posts:e,loading:t,fetchPosts:a,addPost:s,addCustomPost:n,removePost:c,updatePost:i}}))},9384:function(e,t,a){a.r(t),a.d(t,{default:function(){return I}});var n=a(6768),r=a(4232),o=a(5130);const l={class:"plant-voice-page"},s={class:"container"},c={class:"plant-voice-header card"},i={class:"plant-icon"},u={class:"plant-emoji"},d={class:"plant-info"},k={class:"action-bar card"},p={class:"thoughts-list"},g={key:0,class:"empty-thoughts card"},h={key:1},v={class:"thought-date"},m={class:"thought-content"},f={class:"thought-footer"};function y(e,t,a,y,w,P){const _=(0,n.g2)("ChatLineRound"),T=(0,n.g2)("el-icon"),b=(0,n.g2)("el-button"),L=(0,n.g2)("el-option"),C=(0,n.g2)("el-select"),S=(0,n.g2)("el-empty"),F=(0,n.g2)("Star");return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",s,[(0,n.Lk)("div",c,[(0,n.Lk)("div",i,[(0,n.Lk)("span",u,(0,r.v_)(y.getPlantEmoji()),1)]),(0,n.Lk)("div",d,[(0,n.Lk)("h2",null,(0,r.v_)(y.plantStore.currentPlant?y.plantStore.currentPlant.name:"å°šæœªæ·»åŠ æ¤ç‰©")+"çš„å¿ƒå£°",1),t[1]||(t[1]=(0,n.Lk)("p",{class:"plant-description"}," ä»æ¤ç‰©çš„è§†è§’çœ‹å¾…ä½ çš„ç”Ÿæ´»ï¼Œå€¾å¬å®ƒå¯¹ä½ çš„æƒ³æ³•å’Œå»ºè®®ã€‚ ",-1))])]),(0,n.Lk)("div",k,[(0,n.bF)(b,{type:"primary",onClick:y.generateThought,class:"generate-btn",loading:y.loading},{default:(0,n.k6)((()=>[(0,n.bF)(T,null,{default:(0,n.k6)((()=>[(0,n.bF)(_)])),_:1}),t[2]||(t[2]=(0,n.eW)(" ç”Ÿæˆæ–°çš„æ¤ç‰©å¿ƒå£° "))])),_:1},8,["onClick","loading"]),(0,n.bF)(C,{modelValue:y.plantMood,"onUpdate:modelValue":t[0]||(t[0]=e=>y.plantMood=e),placeholder:"é€‰æ‹©æ¤ç‰©å¿ƒæƒ…",onChange:y.updateMood,class:"mood-select"},{default:(0,n.k6)((()=>[(0,n.bF)(L,{label:"å¼€å¿ƒ",value:"happy"},{default:(0,n.k6)((()=>t[3]||(t[3]=[(0,n.Lk)("div",{class:"mood-option"},[(0,n.Lk)("span",{class:"mood-emoji"},"ğŸ˜Š"),(0,n.eW)(" å¼€å¿ƒ ")],-1)]))),_:1}),(0,n.bF)(L,{label:"ä¸€èˆ¬",value:"neutral"},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.Lk)("div",{class:"mood-option"},[(0,n.Lk)("span",{class:"mood-emoji"},"ğŸ˜"),(0,n.eW)(" ä¸€èˆ¬ ")],-1)]))),_:1}),(0,n.bF)(L,{label:"éš¾è¿‡",value:"sad"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.Lk)("div",{class:"mood-option"},[(0,n.Lk)("span",{class:"mood-emoji"},"ğŸ˜¢"),(0,n.eW)(" éš¾è¿‡ ")],-1)]))),_:1})])),_:1},8,["modelValue","onChange"])]),(0,n.Lk)("div",p,[y.plantStore.thoughts&&0!==y.plantStore.thoughts.length?((0,n.uX)(),(0,n.CE)("div",h,[(0,n.bF)(o.F,{name:"thought-fade"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(y.plantStore.thoughts,((e,a)=>((0,n.uX)(),(0,n.CE)("div",{key:e.id||e._id||a,class:"thought-card card"},[t[7]||(t[7]=(0,n.Lk)("div",{class:"thought-bubble"},null,-1)),(0,n.Lk)("div",v,(0,r.v_)(y.formatDate(e.timestamp)),1),(0,n.Lk)("div",m,(0,r.v_)(e.content),1),(0,n.Lk)("div",f,[(0,n.bF)(b,{type:"text",size:"small",onClick:t=>y.toggleLikeThought(e),class:(0,r.C4)(["like-btn",{liked:e.liked}])},{default:(0,n.k6)((()=>[(0,n.bF)(T,null,{default:(0,n.k6)((()=>[(0,n.bF)(F)])),_:1}),(0,n.eW)(" "+(0,r.v_)(e.liked?"å·²æ”¶è—":"æ”¶è—"),1)])),_:2},1032,["onClick","class"])])])))),128))])),_:1})])):((0,n.uX)(),(0,n.CE)("div",g,[(0,n.bF)(S,{description:"è¿˜æ²¡æœ‰æ¤ç‰©å¿ƒå£°ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆå§ï¼"},{default:(0,n.k6)((()=>[(0,n.bF)(b,{type:"primary",onClick:y.generateThought,class:"empty-btn",loading:y.loading},{default:(0,n.k6)((()=>[(0,n.bF)(T,null,{default:(0,n.k6)((()=>[(0,n.bF)(_)])),_:1}),t[6]||(t[6]=(0,n.eW)(" ç”Ÿæˆç¬¬ä¸€æ¡å¿ƒå£° "))])),_:1},8,["onClick","loading"])])),_:1})]))])])])}a(8111),a(1701);var w=a(144),P=a(3271),_=a(2333),T=a(3446),b=a(5796),L=a(7477),C=a(1219),S=a(4300),F={name:"PlantVoicePage",components:{ChatLineRound:L.ChatLineRound,Star:L.Star},setup(){const e=(0,P.g)(),t=(0,_.O)(),a=((0,T.D)(),(0,w.KR)(e.currentPlant?.mood||"neutral")),r=(0,w.KR)(!1),o=(0,w.KR)(!0);(0,n.wB)((()=>e.mainPlant),(async t=>{if(t){e.currentPlant=t,a.value=t.mood||"neutral";try{const a=t._id||t.id;a&&(r.value=!0,await e.fetchPlantThoughts(a),0!==e.thoughts.length||o.value||await l())}catch(n){console.error("è·å–æ¤ç‰©å¿ƒå£°å¤±è´¥:",n),C.nk.error("è·å–æ¤ç‰©å¿ƒå£°å¤±è´¥")}finally{r.value=!1}}}),{immediate:!0});const l=async()=>{if(!e.currentPlant)return void C.nk.warning("è¯·å…ˆåœ¨èŠ±å›­ä¸­è´­ä¹°ä¸€ä¸ªæ¤ç‰©");const n=e.currentPlant._id||e.currentPlant.id;if(!n)return console.error("æ¤ç‰©IDæ— æ•ˆ"),void C.nk.warning("æ¤ç‰©ä¿¡æ¯ä¸å®Œæ•´ï¼Œè¯·é‡æ–°é€‰æ‹©æ¤ç‰©");try{r.value=!0,console.log("å¼€å§‹ç”Ÿæˆæ¤ç‰©å¿ƒå£°ï¼Œæ¤ç‰©ID:",n);const o={weather:e.currentPlant.weather||"sunny",timeOfDay:s(),mood:a.value,recentTasks:t.completedTasks.slice(0,3).map((e=>({id:e._id||e.id,title:e.title,completed:!0})))};console.log("ç”Ÿæˆæ¤ç‰©å¿ƒå£°çš„ä¸Šä¸‹æ–‡:",o);const l=await e.generatePlantThought(n,o);console.log("ç”Ÿæˆæ¤ç‰©å¿ƒå£°çš„ç»“æœ:",l),l&&(0,C.nk)({message:"æ¤ç‰©æœ‰æ–°çš„å¿ƒå£°å•¦ï¼",type:"success"})}catch(o){console.error("ç”Ÿæˆæ¤ç‰©å¿ƒå£°å¤±è´¥",o),C.nk.error("ç”Ÿæˆæ¤ç‰©å¿ƒå£°å¤±è´¥")}finally{r.value=!1}},s=()=>{const e=(new Date).getHours();return e>=5&&e<12?"morning":e>=12&&e<18?"afternoon":"evening"},c=async t=>{if(!e.currentPlant)return void C.nk.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¤ç‰©");const n=e.currentPlant._id||e.currentPlant.id;if(!n)return console.error("æ¤ç‰©IDæ— æ•ˆ"),void C.nk.warning("æ¤ç‰©ä¿¡æ¯ä¸å®Œæ•´ï¼Œè¯·é‡æ–°é€‰æ‹©æ¤ç‰©");try{r.value=!0;const o=await e.updatePlant(n,{mood:t});if(o){a.value=t;const e={happy:"æ¤ç‰©çœ‹èµ·æ¥å¾ˆå¼€å¿ƒï¼",neutral:"æ¤ç‰©å¿ƒæƒ…å¹³é™",sad:"æ¤ç‰©æœ‰ç‚¹éš¾è¿‡ï¼Œéœ€è¦æ›´å¤šå…³çˆ±"};(0,C.nk)({type:"sad"===t?"warning":"happy"===t?"success":"info",message:e[t]||"æ¤ç‰©å¿ƒæƒ…å·²æ›´æ–°"})}}catch(o){console.error("æ›´æ–°æ¤ç‰©å¿ƒæƒ…å¤±è´¥:",o),C.nk.error("æ›´æ–°æ¤ç‰©å¿ƒæƒ…å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"),a.value=e.currentPlant.mood||"neutral"}finally{r.value=!1}},i=e=>e?(0,b.GP)(new Date(e),"yyyy-MM-dd HH:mm"):"",u=()=>e.currentPlant&&e.currentPlant.emoji||"ğŸŒ±",d=async t=>{if(!t?.id)return console.error("å¿ƒå£°å¯¹è±¡æ— æ•ˆ"),void C.nk.warning("æ— æ³•æ“ä½œï¼Œå¿ƒå£°ä¿¡æ¯æ— æ•ˆ");if(!e.currentPlant)return void C.nk.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¤ç‰©");const a=e.currentPlant._id||e.currentPlant.id;if(!a)return console.error("æ¤ç‰©IDæ— æ•ˆ"),void C.nk.warning("æ¤ç‰©ä¿¡æ¯ä¸å®Œæ•´ï¼Œè¯·é‡æ–°é€‰æ‹©æ¤ç‰©");try{r.value=!0,t.liked?(await S.AK.unlikeThought(a,t.id),t.liked=!1,(0,C.nk)({message:"å·²å–æ¶ˆæ”¶è—",type:"info"})):(await S.AK.likeThought(a,t.id),t.liked=!0,(0,C.nk)({message:"å·²æ”¶è—æ­¤å¿ƒå£°",type:"success"}))}catch(n){console.error("æ“ä½œå¿ƒå£°æ”¶è—å¤±è´¥:",n),C.nk.error("æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{r.value=!1}},k=e=>!!e&&!(!e._id&&!e.id);return(0,n.sV)((async()=>{if(e.currentPlant||await e.fetchPlants(),e.currentPlant&&k(e.currentPlant)){const a=e.currentPlant._id||e.currentPlant.id;try{r.value=!0,await e.fetchPlantThoughts(a),0===e.thoughts.length&&o.value&&await l()}catch(t){console.error("è·å–æ¤ç‰©å¿ƒå£°å¤±è´¥:",t),C.nk.error("è·å–æ¤ç‰©å¿ƒå£°å¤±è´¥")}finally{r.value=!1,o.value=!1}}})),{plantStore:e,plantMood:a,loading:r,generateThought:l,updateMood:c,formatDate:i,getPlantEmoji:u,toggleLikeThought:d}}},D=a(1241);const W=(0,D.A)(F,[["render",y],["__scopeId","data-v-c068cffc"]]);var I=W}}]);
//# sourceMappingURL=384.bc56e199.js.map