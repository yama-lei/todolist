"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[851],{503:function(e,t,a){a.d(t,{c:function(){return s}});var n=a(2261);a(4300);const s=(0,n.nY)("currency",{state:()=>({coins:parseInt(localStorage.getItem("coins")||"100"),loading:!1}),actions:{addCoins(e){this.coins+=e,this.saveCoins()},deductCoins(e){return this.coins>=e&&(this.coins-=e,this.saveCoins(),!0)},saveCoins(){localStorage.setItem("coins",this.coins.toString())},resetCoins(){this.coins=100,this.saveCoins()}}})},3174:function(e,t,a){a.r(t),a.d(t,{default:function(){return ne}});var n=a(6768),s=a(4232);const l={class:"garden-page"},i={class:"container"},r={class:"garden-header card"},o={class:"garden-stats"},c={class:"stats-item plants"},p={class:"stats-value"},d={class:"garden-content"},u={class:"my-garden-section card"},h={key:0,class:"empty-garden"},g={key:1,class:"garden-plants-row"},v={class:"plant-avatar"},k=["src"],m={class:"plant-details"},y={class:"plant-header"},P={class:"plant-name"},f={key:0,class:"main-plant-badge"},w={class:"plant-level-container"},C={class:"plant-level"},L={class:"level-value"},M={class:"plant-weather-selector"},b={class:"weather-options"},D=["onClick"],_=["onClick"],x=["onClick"],I={class:"plant-actions"},W={key:2,class:"plant-companionship"};function E(e,t,a,E,T,F){const S=(0,n.g2)("el-empty"),A=(0,n.g2)("WeatherCanvas"),$=(0,n.g2)("el-tag"),j=(0,n.g2)("el-progress"),X=(0,n.g2)("el-button"),z=(0,n.g2)("PlantDialog");return(0,n.uX)(),(0,n.CE)("div",l,[t[12]||(t[12]=(0,n.Lk)("div",{class:"garden-background"},null,-1)),(0,n.Lk)("div",i,[(0,n.Lk)("div",r,[t[3]||(t[3]=(0,n.Lk)("h2",{class:"card-title"},"花语坊",-1)),t[4]||(t[4]=(0,n.Lk)("p",{class:"garden-description"}," 在这里，你可以查看和管理你的植物，打造属于自己的花园。 ",-1)),(0,n.Lk)("div",o,[(0,n.Lk)("div",c,[t[1]||(t[1]=(0,n.Lk)("span",{class:"stats-icon"},"🌱",-1)),(0,n.Lk)("span",p,(0,s.v_)(E.myPlants.length),1),t[2]||(t[2]=(0,n.Lk)("span",{class:"stats-label"},"植物",-1))])])]),(0,n.Lk)("div",d,[(0,n.Lk)("div",u,[t[11]||(t[11]=(0,n.Lk)("div",{class:"section-header"},[(0,n.Lk)("h3",{class:"section-title"},"未完成的春天")],-1)),0===E.myPlants.length?((0,n.uX)(),(0,n.CE)("div",h,[(0,n.bF)(S,{description:"你的花园还空空如也~"},{image:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.Lk)("div",{class:"empty-image"},"🏡",-1)]))),_:1})])):((0,n.uX)(),(0,n.CE)("div",g,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(E.filteredPlants,(e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:(0,s.C4)(["garden-plant-item",{"is-main-plant":e.isMainPlant}])},[(0,n.Lk)("div",v,[(0,n.bF)(A,{weather:e.weather||"sunny",width:200,height:200},null,8,["weather"]),(0,n.Lk)("img",{src:E.getPlantImage(e),class:"plant-image",alt:"植物图片"},null,8,k)]),(0,n.Lk)("div",m,[(0,n.Lk)("div",y,[(0,n.Lk)("div",P,(0,s.v_)(e.name),1),e.isMainPlant?((0,n.uX)(),(0,n.CE)("div",f,[(0,n.bF)($,{size:"small",type:"success",effect:"dark"},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("主要植物")]))),_:1})])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",w,[(0,n.Lk)("div",C,[t[7]||(t[7]=(0,n.eW)("等级: ")),(0,n.Lk)("span",L,(0,s.v_)(e.level),1)]),(0,n.bF)(j,{percentage:E.calculatePlantExp(e),format:E.expFormat,"stroke-width":10,class:"plant-exp-progress"},null,8,["percentage","format"])]),(0,n.Lk)("div",M,[t[8]||(t[8]=(0,n.Lk)("span",{class:"weather-label"},"环境:",-1)),(0,n.Lk)("div",b,[(0,n.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"sunny"===e.weather||!e.weather}]),title:"晴天",onClick:t=>E.updatePlantWeather(e,"sunny")},"☀️",10,D),(0,n.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"rainy"===e.weather}]),title:"下雨",onClick:t=>E.updatePlantWeather(e,"rainy")},"🌧️",10,_),(0,n.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"cloudy"===e.weather}]),title:"多云",onClick:t=>E.updatePlantWeather(e,"cloudy")},"☁️",10,x)])])]),(0,n.Lk)("div",I,[(0,n.bF)(X,{size:"small",type:"primary",onClick:t=>E.showDialog(e)},{default:(0,n.k6)((()=>t[9]||(t[9]=[(0,n.Lk)("span",{class:"button-icon"},"💬",-1),(0,n.eW)("聆听心声 ")]))),_:2},1032,["onClick"]),(0,n.bF)(X,{size:"small",type:"success",plain:"",onClick:t=>E.setAsMainPlant(e),disabled:e.isMainPlant},{default:(0,n.k6)((()=>t[10]||(t[10]=[(0,n.Lk)("span",{class:"button-icon"},"⭐",-1),(0,n.eW)("设为主植物 ")]))),_:2},1032,["onClick","disabled"])])],2)))),128))])),E.myPlants.length>0?((0,n.uX)(),(0,n.CE)("div",W," 不知不觉中，植物已经陪伴你"+(0,s.v_)(E.plantDays)+"天了,陪你完成了"+(0,s.v_)(E.completedTasksCount)+"个任务 ",1)):(0,n.Q3)("",!0)])])]),(0,n.bF)(z,{messages:E.plantStore.thoughts,"is-visible":E.showPlantThoughtDialog,"show-buttons":!1,onPrimaryAction:t[0]||(t[0]=e=>E.showPlantThoughtDialog=!1)},null,8,["messages","is-visible"])])}a(8111),a(2489),a(116),a(1701);var T=a(144),F=a(503),S=a(3271),A=a(2333),$=a(1219),j=a(9523),X=a(9104),z=a(178),K=a(1145),R=a(3024),Q=a(529),B=a(1546),G=a(403),O=a(2292),V=a(9151),Y=a(2214),q=a(7243),H=a(3107),J=a(7593),N=a(902),U=a(2669),Z=a(9428),ee={name:"GardenPage",components:{WeatherCanvas:j.A,PlantDialog:X.A},setup(){const e=(0,F.c)(),t=(0,S.g)(),a=(0,A.O)(),s=(0,T.KR)(null),l=(0,T.KR)(!1),i=(0,T.KR)(""),r={"玫瑰":{1:z,2:K,3:R},"仙人掌":{1:Q,2:B,3:G},"郁金香":{1:O,2:V,3:Y},"白百合":{1:q,2:H,3:J},"向日葵":{1:N,2:U,3:Z}},o=e=>{if(!e||!e.type)return z;const t=e.type.trim(),a=e.level||1,n=Math.min(Math.max(a,1),3),s=r[t];return s&&s[n]||z},c=(0,T.Kh)([{id:"plant1",name:"绯色絮语",type:"玫瑰",emoji:"🌹",level:1,experience:0,weather:"sunny",isMainPlant:!1},{id:"plant2",name:"沙屿星芒",type:"仙人掌",emoji:"🌵",level:1,experience:0,weather:"sunny",isMainPlant:!1},{id:"plant3",name:"冰爵士",type:"郁金香",emoji:"🌸",level:1,experience:0,weather:"sunny",isMainPlant:!1},{id:"plant4",name:"云归处",type:"白百何",emoji:"🌲",level:1,experience:0,weather:"sunny",isMainPlant:!1},{id:"plant5",name:"日轮礼赞",type:"向日葵",emoji:"🌻",level:1,experience:0,weather:"sunny",isMainPlant:!1}]);(0,n.sV)((async()=>{await t.fetchPlants();for(const a of c){const e=t.plants.find((e=>e.type===a.type));if(!e)try{const e=await t.createPlant({name:a.name,type:a.type,emoji:a.emoji,isMainPlant:a.isMainPlant});console.log("创建新植物成功:",e)}catch(n){console.error("创建植物失败:",n),$.nk.error("创建植物失败")}}const e=t.plants.find((e=>e.isMainPlant));if(!e&&t.plants.length>0){const e=t.plants[0],a=e._id||e.id;if(a)try{await t.updatePlant(a,{isMainPlant:!0}),console.log("设置主植物成功:",e.name)}catch(n){console.error("设置主植物失败:",n),$.nk.error("设置主植物失败")}}await a.fetchTasks()}));const p=e=>{const t=e.experience||0,a=e.level||1;return Math.min(100,t/(100*a)*100)},d=e=>{const a=t.plants.find((t=>p(t)===e));if(!a){if(s.value){const e=t.plants.find((e=>e._id===s.value._id||e.id===s.value.id));if(e){const t=e.experience||0,a=e.level||1,n=100*a;return`${t}/${n}`}}return`${Math.round(e)}%`}const n=a.experience||0,l=a.level||1,i=100*l;return`${n}/${i}`},u=async(e,a)=>{if(e.weather===a)return;const n=e._id||e.id;if(!n)return console.error("无法更新植物天气: 植物ID无效",e),void $.nk.error("更新失败：无法获取植物ID");console.log("更新植物天气，植物ID:",n,"天气:",a);try{await t.updatePlant(n,{weather:a}),$.nk.success("植物环境已更新")}catch(s){console.error("更新植物天气失败:",s),$.nk.error(`更新失败: ${s.message||"未知错误"}`)}},h=async e=>{const a=e._id||e.id;if(!a)return console.error("无法显示植物心声: 植物ID无效",e),void $.nk.error("无法显示植物心声：植物ID无效");s.value=e,l.value=!0;try{const e=await t.fetchPlantThoughts(a);t.thoughts=e.map((e=>({type:"plant",content:e.content,timestamp:e.timestamp})))}catch(n){console.error("获取植物心声失败:",n),$.nk.error("获取植物心声失败")}},g=async e=>{const a=e._id||e.id;if(!a)return console.error("无法生成植物心声: 植物ID无效",e),void $.nk.error("生成失败：植物ID无效");try{const n={weather:e.weather||"sunny",level:e.level||1,experience:e.experience||0,growthStage:e.growthStage||1},s=await t.generatePlantThought(a,n);s&&t.thoughts.unshift({type:"plant",content:s.content,timestamp:s.timestamp}),$.nk.success("植物心声已生成")}catch(n){console.error("生成植物心声失败:",n),$.nk.error(`生成失败: ${n.message||"未知错误"}`)}},v=async e=>{if(e.isMainPlant)return;const a=e._id||e.id;if(!a)return console.error("无法设置主植物: 植物ID无效",e),void $.nk.error("设置失败：无法获取植物ID");console.log("设置主植物，植物ID:",a);try{for(const e of t.plants)if(e.isMainPlant){const a=e._id||e.id;await t.updatePlant(a,{isMainPlant:!1})}await t.updatePlant(a,{isMainPlant:!0}),await t.fetchPlantThoughts(a),l.value&&(s.value=e),$.nk.success("已设置为主植物")}catch(n){console.error("设置主植物失败:",n),$.nk.error(`设置失败: ${n.message||"未知错误"}`)}},k=(0,n.EW)((()=>{if(!i.value)return t.plants;const e=i.value.toLowerCase();return t.plants.filter((t=>t.name.toLowerCase().includes(e)))})),m=(0,n.EW)((()=>{if(0===t.plants.length)return 0;const e=t.plants[0];if(!e||!e.createdAt)return 0;const a=new Date(e.createdAt),n=new Date,s=Math.abs(n-a),l=Math.ceil(s/864e5);return l})),y=(0,n.EW)((()=>a.completedTasks.length));return(0,n.wB)((()=>t.plants.find((e=>e.isMainPlant))),(async e=>{if(e&&(s.value=e,l.value)){const n=e._id||e.id;if(n)try{await t.fetchPlantThoughts(n)}catch(a){console.error("更新植物心声失败:",a),$.nk.error("更新植物心声失败")}}}),{immediate:!0}),{currencyStore:e,plantStore:t,taskStore:a,selectedPlantForDialog:s,showPlantThoughtDialog:l,searchPlant:i,myPlants:(0,n.EW)((()=>t.plants)),filteredPlants:k,plantDays:m,completedTasksCount:y,calculatePlantExp:p,expFormat:d,updatePlantWeather:u,showDialog:h,generatePlantThought:g,setAsMainPlant:v,getPlantImage:o}}},te=a(1241);const ae=(0,te.A)(ee,[["render",E],["__scopeId","data-v-ea87d3dc"]]);var ne=ae}}]);
//# sourceMappingURL=851.af1a2bb3.js.map