"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[335],{2333:function(e,t,a){a.d(t,{O:function(){return c}});a(4114),a(8111),a(2489),a(116);var s=a(2261),n=a(144),l=a(6768),i=a(3271),r=a(4300),o=a(1219);const c=(0,s.nY)("task",(()=>{const e=(0,n.KR)([]),t=(0,n.KR)([]),a=(0,n.KR)([]),s=(0,n.KR)(!1),c=(0,l.EW)((()=>e.value.filter((e=>!e.completed)))),d=async()=>{try{s.value=!0;const t=await r.WY.getTasks();e.value=t.tasks.filter((e=>!e.completed)),a.value=t.tasks.filter((e=>e.completed))}catch(t){o.nk.error("获取任务列表失败")}finally{s.value=!1}},k=async()=>{try{s.value=!0;const e=await r.WY.getSystemTasks();t.value=e.tasks}catch(e){o.nk.error("获取系统任务失败")}finally{s.value=!1}},u=async t=>{try{const a=await r.WY.createTask({title:t.title,description:t.description||"",deadline:t.deadline||"",important:t.important||!1});e.value.push(a.task),o.nk.success("任务创建成功")}catch(a){o.nk.error("创建任务失败")}},m=async t=>{try{await r.WY.completeTask(t);const s=e.value.find((e=>e._id===t));s&&(a.value.unshift({...s,completed:!0,completedAt:(new Date).toISOString()}),e.value=e.value.filter((e=>e._id!==t)));const n=(0,i.g)();if(n.plants&&n.plants.length>0){const e=n.plants.find((e=>e.isMainPlant));if(e){const t=e._id||e.id;if(t){const e=s&&s.important?50:25;await n.gainExperience(t,e),o.nk.success(`任务已完成，获得 ${e} 点经验值！`)}}}else o.nk.success("任务已完成")}catch(s){o.nk.error("完成任务失败")}},p=async e=>{try{const a=(0,i.g)();if(!a.currentPlant)return o.nk.warning("请先添加一个植物"),!1;const s=await r.WY.completeSystemTask(e),n=t.value.findIndex((t=>t._id===e));if(-1!==n&&(t.value[n].completed=!0),s.rewards)o.nk.success(`完成任务获得 ${s.rewards.experience} 点经验`);else{const e=a.currentPlant._id||a.currentPlant.id;if(e){const t=35;await a.gainExperience(e,t),o.nk.success(`完成系统任务获得 ${t} 点经验值`)}}return!0}catch(a){return 400===a.response?.status?o.nk.warning("今天已经完成过此任务"):o.nk.error("完成系统任务失败"),!1}},f=async t=>{try{if(!t)return void o.nk.error("任务ID无效，无法删除");await r.WY.deleteTask(t),e.value=e.value.filter((e=>e._id!==t)),o.nk.success("任务已删除")}catch(a){console.error("删除任务失败:",a),o.nk.error("删除任务失败")}},v=async e=>{try{if(!e)return void o.nk.error("任务ID无效，无法删除");await r.WY.deleteTask(e),a.value=a.value.filter((t=>t._id!==e)),o.nk.success("任务已删除")}catch(t){console.error("删除任务失败:",t),o.nk.error("删除任务失败")}},T=async t=>{try{const{_id:a,title:s,description:n,deadline:l,important:i}=t,c=await r.WY.updateTask(a,{title:s,description:n,deadline:l,important:i}),d=e.value.findIndex((e=>e._id===a));-1!==d&&(e.value[d]=c.task),o.nk.success("任务已更新")}catch(a){o.nk.error("更新任务失败")}},y=async t=>{const a=e.value.find((e=>e._id===t));a&&await T({...a,important:!a.important})};return{tasks:e,systemTasks:t,completedTasks:a,pendingTasks:c,loading:s,fetchTasks:d,fetchSystemTasks:k,addTask:u,completeTask:m,completeSystemTask:p,removeTask:f,removeCompletedTask:v,updateTask:T,toggleTaskImportance:y}}))},5335:function(e,t,a){a.r(t),a.d(t,{default:function(){return fe}});var s=a(6768),n=a(4232);const l={class:"task-page"},i={class:"container"},r={class:"task-header"},o={class:"task-actions"},c={class:"system-tasks-card card"},d={class:"tasks-list system-tasks"},k={class:"task-icon"},u={class:"task-content"},m={class:"task-title"},p={class:"task-description"},f={class:"task-actions"},v={class:"user-tasks-card card"},T={class:"card-header"},y={class:"task-status"},g={key:0,class:"empty-tasks"},h={key:1,class:"tasks-list user-tasks"},_={class:"task-content"},F={class:"task-title"},C={class:"task-description"},w={class:"task-meta"},b={key:0,class:"task-deadline"},L={class:"task-actions"},D={key:0,class:"completed-tasks-card card"},N={class:"card-header"},S={class:"completed-count"},Y={class:"tasks-list completed-tasks"},U={class:"task-content"},W={class:"task-title"},x={class:"task-meta"},V={class:"completed-at"},E={class:"dialog-footer"};function I(e,t,a,I,P,M){const X=(0,s.g2)("Plus"),K=(0,s.g2)("el-icon"),H=(0,s.g2)("el-button"),$=(0,s.g2)("el-empty"),z=(0,s.g2)("Clock"),R=(0,s.g2)("el-button-group"),Z=(0,s.g2)("el-input"),B=(0,s.g2)("el-form-item"),A=(0,s.g2)("el-date-picker"),O=(0,s.g2)("el-checkbox"),Q=(0,s.g2)("el-form"),q=(0,s.g2)("el-dialog");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",i,[(0,s.Lk)("div",r,[t[7]||(t[7]=(0,s.Lk)("h1",null,"任务管理",-1)),(0,s.Lk)("div",o,[(0,s.bF)(H,{type:"primary",onClick:I.openTaskForm},{default:(0,s.k6)((()=>[(0,s.bF)(K,null,{default:(0,s.k6)((()=>[(0,s.bF)(X)])),_:1}),t[6]||(t[6]=(0,s.eW)(" 新建任务 "))])),_:1},8,["onClick"])])]),(0,s.Lk)("div",c,[t[8]||(t[8]=(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h2",null,"每日任务"),(0,s.Lk)("div",{class:"task-info"}," 完成任务可以获得经验值，帮助植物成长 ")],-1)),(0,s.Lk)("div",d,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(I.taskStore.systemTasks,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e._id,class:(0,n.C4)(["task-item",{completed:e.completed}])},[(0,s.Lk)("div",k,(0,n.v_)(e.icon),1),(0,s.Lk)("div",u,[(0,s.Lk)("div",m,(0,n.v_)(e.title),1),(0,s.Lk)("div",p,(0,n.v_)(e.description),1)]),(0,s.Lk)("div",f,[(0,s.bF)(H,{type:e.completed?"success":"primary",disabled:e.completed,onClick:t=>I.completeSystemTask(e._id)},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(e.completed?"已完成":"完成"),1)])),_:2},1032,["type","disabled","onClick"])])],2)))),128))])]),(0,s.Lk)("div",v,[(0,s.Lk)("div",T,[t[9]||(t[9]=(0,s.Lk)("h2",null,"我的任务",-1)),(0,s.Lk)("div",y,[(0,s.Lk)("span",null,(0,n.v_)(I.taskStore.pendingTasks.length)+" 个待完成",1)])]),0===I.taskStore.pendingTasks.length?((0,s.uX)(),(0,s.CE)("div",g,[(0,s.bF)($,{description:"暂无任务，点击右上角添加新任务吧！"})])):((0,s.uX)(),(0,s.CE)("div",h,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(I.taskStore.pendingTasks,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e._id,class:(0,n.C4)(["task-item",{important:e.important}])},[(0,s.Lk)("div",_,[(0,s.Lk)("div",F,(0,n.v_)(e.title),1),(0,s.Lk)("div",C,(0,n.v_)(e.description),1),(0,s.Lk)("div",w,[e.deadline?((0,s.uX)(),(0,s.CE)("span",b,[(0,s.bF)(K,null,{default:(0,s.k6)((()=>[(0,s.bF)(z)])),_:1}),(0,s.eW)(" "+(0,n.v_)(I.formatDate(e.deadline)),1)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",L,[(0,s.bF)(R,null,{default:(0,s.k6)((()=>[(0,s.bF)(H,{type:"primary",onClick:t=>I.completeUserTask(e._id)},{default:(0,s.k6)((()=>t[10]||(t[10]=[(0,s.eW)(" 完成 ")]))),_:2},1032,["onClick"]),(0,s.bF)(H,{type:"default",onClick:t=>I.editTask(e)},{default:(0,s.k6)((()=>t[11]||(t[11]=[(0,s.eW)(" 编辑 ")]))),_:2},1032,["onClick"]),(0,s.bF)(H,{type:"danger",onClick:t=>I.deleteTask(e._id)},{default:(0,s.k6)((()=>t[12]||(t[12]=[(0,s.eW)(" 删除 ")]))),_:2},1032,["onClick"])])),_:2},1024)])],2)))),128))]))]),I.taskStore.completedTasks.length>0?((0,s.uX)(),(0,s.CE)("div",D,[(0,s.Lk)("div",N,[t[13]||(t[13]=(0,s.Lk)("h2",null,"已完成任务",-1)),(0,s.Lk)("div",S,(0,n.v_)(I.taskStore.completedTasks.length)+" 个任务 ",1)]),(0,s.Lk)("div",Y,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(I.taskStore.completedTasks,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e._id,class:"task-item completed"},[(0,s.Lk)("div",U,[(0,s.Lk)("div",W,(0,n.v_)(e.title),1),(0,s.Lk)("div",x,[(0,s.Lk)("span",V," 完成于 "+(0,n.v_)(I.formatDate(e.completedAt)),1)])])])))),128))])])):(0,s.Q3)("",!0)]),(0,s.bF)(q,{modelValue:I.showTaskForm,"onUpdate:modelValue":t[5]||(t[5]=e=>I.showTaskForm=e),title:I.editingTask?"编辑任务":"新建任务",width:"500px"},{footer:(0,s.k6)((()=>[(0,s.Lk)("span",E,[(0,s.bF)(H,{onClick:t[4]||(t[4]=e=>I.showTaskForm=!1)},{default:(0,s.k6)((()=>t[15]||(t[15]=[(0,s.eW)("取消")]))),_:1}),(0,s.bF)(H,{type:"primary",onClick:I.saveTask},{default:(0,s.k6)((()=>t[16]||(t[16]=[(0,s.eW)(" 保存 ")]))),_:1},8,["onClick"])])])),default:(0,s.k6)((()=>[(0,s.bF)(Q,{model:I.taskForm,"label-position":"top"},{default:(0,s.k6)((()=>[(0,s.bF)(B,{label:"任务标题",required:""},{default:(0,s.k6)((()=>[(0,s.bF)(Z,{modelValue:I.taskForm.title,"onUpdate:modelValue":t[0]||(t[0]=e=>I.taskForm.title=e),placeholder:"输入任务标题"},null,8,["modelValue"])])),_:1}),(0,s.bF)(B,{label:"任务描述"},{default:(0,s.k6)((()=>[(0,s.bF)(Z,{modelValue:I.taskForm.description,"onUpdate:modelValue":t[1]||(t[1]=e=>I.taskForm.description=e),type:"textarea",rows:3,placeholder:"输入任务描述"},null,8,["modelValue"])])),_:1}),(0,s.bF)(B,{label:"截止日期"},{default:(0,s.k6)((()=>[(0,s.bF)(A,{modelValue:I.taskForm.deadline,"onUpdate:modelValue":t[2]||(t[2]=e=>I.taskForm.deadline=e),type:"datetime",placeholder:"选择截止日期","value-format":"YYYY-MM-DDTHH:mm:ss",format:"YYYY-MM-DD HH:mm",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,s.bF)(B,null,{default:(0,s.k6)((()=>[(0,s.bF)(O,{modelValue:I.taskForm.important,"onUpdate:modelValue":t[3]||(t[3]=e=>I.taskForm.important=e)},{default:(0,s.k6)((()=>t[14]||(t[14]=[(0,s.eW)("标记为重要")]))),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}var P=a(144),M=a(2333),X=a(3271),K=a(2933),H=a(5796),$=a(2436),z=a(5808),R=a(4068);function Z(e,t){const a=()=>(0,z.w)(t?.in,NaN),s=t?.additionalDigits??2,n=q(e);let l;if(n.date){const e=G(n.date,s);l=j(e.restDateString,e.year)}if(!l||isNaN(+l))return a();const i=+l;let r,o=0;if(n.time&&(o=ee(n.time),isNaN(o)))return a();if(!n.timezone){const e=new Date(i+o),a=(0,R.a)(0,t?.in);return a.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),a.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),a}return r=ae(n.timezone),isNaN(r)?a():(0,R.a)(i+o+r,t?.in)}const B={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},A=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,O=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Q=/^([+-])(\d{2})(?::?(\d{2}))?$/;function q(e){const t={},a=e.split(B.dateTimeDelimiter);let s;if(a.length>2)return t;if(/:/.test(a[0])?s=a[0]:(t.date=a[0],s=a[1],B.timeZoneDelimiter.test(t.date)&&(t.date=e.split(B.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){const e=B.timezone.exec(s);e?(t.time=s.replace(e[1],""),t.timezone=e[1]):t.time=s}return t}function G(e,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(a);if(!s)return{year:NaN,restDateString:""};const n=s[1]?parseInt(s[1]):null,l=s[2]?parseInt(s[2]):null;return{year:null===l?n:100*l,restDateString:e.slice((s[1]||s[2]).length)}}function j(e,t){if(null===t)return new Date(NaN);const a=e.match(A);if(!a)return new Date(NaN);const s=!!a[4],n=J(a[1]),l=J(a[2])-1,i=J(a[3]),r=J(a[4]),o=J(a[5])-1;if(s)return oe(t,r,o)?se(t,r,o):new Date(NaN);{const e=new Date(0);return ie(t,l,i)&&re(t,n)?(e.setUTCFullYear(t,l,Math.max(n,i)),e):new Date(NaN)}}function J(e){return e?parseInt(e):1}function ee(e){const t=e.match(O);if(!t)return NaN;const a=te(t[1]),s=te(t[2]),n=te(t[3]);return ce(a,s,n)?a*$.s0+s*$.Cg+1e3*n:NaN}function te(e){return e&&parseFloat(e.replace(",","."))||0}function ae(e){if("Z"===e)return 0;const t=e.match(Q);if(!t)return 0;const a="+"===t[1]?-1:1,s=parseInt(t[2]),n=t[3]&&parseInt(t[3])||0;return de(s,n)?a*(s*$.s0+n*$.Cg):NaN}function se(e,t,a){const s=new Date(0);s.setUTCFullYear(e,0,4);const n=s.getUTCDay()||7,l=7*(t-1)+a+1-n;return s.setUTCDate(s.getUTCDate()+l),s}const ne=[31,null,31,30,31,30,31,31,30,31,30,31];function le(e){return e%400===0||e%4===0&&e%100!==0}function ie(e,t,a){return t>=0&&t<=11&&a>=1&&a<=(ne[t]||(le(e)?29:28))}function re(e,t){return t>=1&&t<=(le(e)?366:365)}function oe(e,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function ce(e,t,a){return 24===e?0===t&&0===a:a>=0&&a<60&&t>=0&&t<60&&e>=0&&e<25}function de(e,t){return t>=0&&t<=59}var ke=a(7477),ue={name:"TaskPage",components:{Plus:ke.Plus,Clock:ke.Clock},setup(){const e=(0,M.O)(),t=(0,X.g)(),a=(0,P.KR)(!1),n=(0,P.KR)(null),l=(0,P.Kh)({id:null,title:"",description:"",deadline:"",important:!1});(0,s.sV)((async()=>{console.log("任务页面加载"),t.currentPlant||await t.fetchPlants();try{await Promise.all([e.fetchTasks(),e.fetchSystemTasks()]),console.log("任务数据加载成功")}catch(a){console.error("加载任务数据失败:",a)}}));const i=()=>{r(),a.value=!0},r=()=>{l.id=null,l.title="",l.description="",l.deadline="",l.important=!1,n.value=null},o=async a=>{t.currentPlant?await e.completeSystemTask(a):K.s.alert("请先在花园中添加一个植物","提示",{confirmButtonText:"确定"})},c=async t=>{await e.completeTask(t)},d=e=>{n.value=e,l.id=e._id,l.title=e.title,l.description=e.description||"",l.deadline=e.deadline||"",l.important=e.important||!1,a.value=!0},k=t=>{K.s.confirm("确定要删除这个任务吗？","删除任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e.removeTask(t)})).catch((()=>{}))},u=()=>{l.title.trim()?(n.value?e.updateTask({_id:l.id,title:l.title,description:l.description,deadline:l.deadline,important:l.important}):e.addTask({title:l.title,description:l.description,deadline:l.deadline,important:l.important}),a.value=!1,r()):K.s.alert("请输入任务标题","提示",{confirmButtonText:"确定"})},m=e=>{if(!e)return"";try{return(0,H.GP)(Z(e),"yyyy-MM-dd HH:mm")}catch(t){return e}};return{taskStore:e,plantStore:t,showTaskForm:a,taskForm:l,editingTask:n,openTaskForm:i,completeSystemTask:o,completeUserTask:c,editTask:d,deleteTask:k,saveTask:u,formatDate:m}}},me=a(1241);const pe=(0,me.A)(ue,[["render",I],["__scopeId","data-v-d4de7ee6"]]);var fe=pe}}]);
//# sourceMappingURL=335.6f3a8206.js.map