"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[66],{503:function(e,t,n){n.d(t,{c:function(){return s}});var a=n(2261);n(4300);const s=(0,a.nY)("currency",{state:()=>({coins:parseInt(localStorage.getItem("coins")||"100"),loading:!1}),actions:{addCoins(e){this.coins+=e,this.saveCoins()},deductCoins(e){return this.coins>=e&&(this.coins-=e,this.saveCoins(),!0)},saveCoins(){localStorage.setItem("coins",this.coins.toString())},resetCoins(){this.coins=100,this.saveCoins()}}})},9431:function(e,t,n){n.r(t),n.d(t,{default:function(){return de}});var a=n(6768),s=n(4232);const l={class:"garden-page"},i={class:"container"},r={class:"garden-content"},o={class:"my-garden-section card"},c={key:0,class:"plant-companionship"},u={key:1,class:"empty-garden"},d={key:2,class:"garden-plants-row"},h={class:"plant-avatar"},p=["src"],v={class:"plant-details"},g={class:"plant-header"},m={class:"plant-name"},k={key:0,class:"main-plant-badge"},y={class:"plant-level-container"},f={class:"plant-level"},P={class:"level-value"},w={class:"plant-weather-selector"},C={class:"weather-options"},L=["onClick"],T=["onClick"],b=["onClick"],M={key:0,class:"plant-thought-bubble"},I={class:"thought-content"},D={class:"typing-segment"},_={key:0,class:"typing-cursor"},x={class:"thought-time"},E={class:"plant-introduction"},F={class:"intro-text"},K={class:"plant-actions"},W=["onClick"],X=["onClick","disabled"];function S(e,t,n,S,A,R){const j=(0,a.g2)("el-empty"),$=(0,a.g2)("WeatherCanvas"),Q=(0,a.g2)("el-tag"),z=(0,a.g2)("el-progress"),B=(0,a.g2)("PlantDialog");return(0,a.uX)(),(0,a.CE)("div",l,[t[11]||(t[11]=(0,a.Lk)("div",{class:"garden-background"},null,-1)),(0,a.Lk)("div",i,[t[10]||(t[10]=(0,a.Lk)("div",{class:"garden-header card"},[(0,a.Lk)("h2",{class:"card-title"},"花语坊"),(0,a.Lk)("p",{class:"garden-description"}," 在这里，你可以查看和管理你的植物，打造属于自己的花园。 ")],-1)),(0,a.Lk)("div",r,[(0,a.Lk)("div",o,[t[9]||(t[9]=(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("h3",{class:"section-title"},"未完成的春天")],-1)),S.myPlants.length>0?((0,a.uX)(),(0,a.CE)("div",c," 不知不觉中，植物已经陪伴你"+(0,s.v_)(S.plantDays)+"天了,陪你完成了"+(0,s.v_)(S.completedTasksCount)+"个任务 ",1)):(0,a.Q3)("",!0),0===S.myPlants.length?((0,a.uX)(),(0,a.CE)("div",u,[(0,a.bF)(j,{description:"你的花园还空空如也~"},{image:(0,a.k6)((()=>t[1]||(t[1]=[(0,a.Lk)("div",{class:"empty-image"},"🏡",-1)]))),_:1})])):((0,a.uX)(),(0,a.CE)("div",d,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(S.filteredPlants,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:(0,s.C4)(["garden-plant-item",{"is-main-plant":e.isMainPlant}])},[(0,a.Lk)("div",h,[(0,a.bF)($,{weather:e.weather||"sunny",width:200,height:200},null,8,["weather"]),(0,a.Lk)("img",{src:S.getPlantImage(e),class:"plant-image",alt:"植物图片"},null,8,p)]),(0,a.Lk)("div",v,[(0,a.Lk)("div",g,[(0,a.Lk)("div",m,(0,s.v_)(e.name),1),e.isMainPlant?((0,a.uX)(),(0,a.CE)("div",k,[(0,a.bF)(Q,{size:"small",type:"success",effect:"dark"},{default:(0,a.k6)((()=>t[2]||(t[2]=[(0,a.eW)("展示植物")]))),_:1})])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",y,[(0,a.Lk)("div",f,[t[3]||(t[3]=(0,a.eW)("等级: ")),(0,a.Lk)("span",P,(0,s.v_)(e.level),1)]),(0,a.bF)(z,{percentage:S.calculatePlantExp(e),format:S.expFormat,"stroke-width":10,class:"plant-exp-progress"},null,8,["percentage","format"])]),(0,a.Lk)("div",w,[t[4]||(t[4]=(0,a.Lk)("span",{class:"weather-label"},"环境:",-1)),(0,a.Lk)("div",C,[(0,a.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"sunny"===e.weather||!e.weather}]),title:"晴天",onClick:t=>S.updatePlantWeather(e,"sunny")},"☀️",10,L),(0,a.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"rainy"===e.weather}]),title:"下雨",onClick:t=>S.updatePlantWeather(e,"rainy")},"🌧️",10,T),(0,a.Lk)("span",{class:(0,s.C4)(["weather-option",{active:"cloudy"===e.weather}]),title:"多云",onClick:t=>S.updatePlantWeather(e,"cloudy")},"☁️",10,b)])]),e.id!==S.showingThoughtForPlantId&&e._id!==S.showingThoughtForPlantId||!S.currentThought?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",M,[t[5]||(t[5]=(0,a.Lk)("div",{class:"thought-bubble-pointer"},null,-1)),(0,a.Lk)("div",I,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(S.displayedSegments,((e,t)=>((0,a.uX)(),(0,a.CE)("span",{key:t,class:"message-segment"},(0,s.v_)(e),1)))),128)),(0,a.Lk)("span",D,(0,s.v_)(S.currentTypingText),1),S.isTyping?((0,a.uX)(),(0,a.CE)("span",_,"|")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",x,(0,s.v_)(S.formatThoughtTime(S.currentThought.timestamp)),1)])),(0,a.Lk)("div",E,[t[6]||(t[6]=(0,a.Lk)("div",{class:"intro-title"},"植物介绍",-1)),(0,a.Lk)("div",F,(0,s.v_)(S.getPlantIntroduction(e.type)),1)])]),(0,a.Lk)("div",K,[(0,a.Lk)("button",{class:"custom-btn listen-btn",onClick:t=>S.listenToPlantThought(e)},t[7]||(t[7]=[(0,a.Lk)("span",{class:"btn-icon"},"💬",-1),(0,a.Lk)("span",{class:"btn-text"},"聆听心声",-1)]),8,W),(0,a.Lk)("button",{class:(0,s.C4)(["custom-btn main-btn",{disabled:e.isMainPlant}]),onClick:t=>S.setAsMainPlant(e),disabled:e.isMainPlant},t[8]||(t[8]=[(0,a.Lk)("span",{class:"btn-icon"},"⭐",-1),(0,a.Lk)("span",{class:"btn-text"},"设为展示植物",-1)]),10,X)])],2)))),128))]))])])]),(0,a.bF)(B,{messages:S.plantStore.thoughts,"is-visible":S.showPlantThoughtDialog,"show-buttons":!1,onPrimaryAction:t[0]||(t[0]=e=>S.showPlantThoughtDialog=!1)},null,8,["messages","is-visible"])])}n(4114),n(8111),n(2489),n(116),n(1701);var A=n(144),R=n(503),j=n(3271),$=n(2333),Q=n(1219),z=n(9523),B=n(9104),G=n(3066),H=n(5796),O=n(8665),V=n(178),Y=n(1145),q=n(3024),J=n(529),N=n(1546),U=n(403),Z=n(2292),ee=n(9151),te=n(2214),ne=n(7243),ae=n(3107),se=n(7593),le=n(902),ie=n(2669),re=n(9428),oe={name:"GardenPage",components:{WeatherCanvas:z.A,PlantDialog:B.A},setup(){const e=(0,R.c)(),t=(0,j.g)(),n=(0,$.O)(),s=(0,A.KR)(null),l=(0,A.KR)(!1),i=(0,A.KR)(""),r=(0,A.KR)(null),o=(0,A.KR)(null),c=(0,A.KR)([]),u=(0,A.KR)(""),d=(0,A.KR)(!1),h=(0,A.KR)(null),p=50,v=1e3,g=e=>e?e.split(/\n\n|\n/).filter((e=>""!==e.trim())):[],m=e=>{if(y(),e)try{c.value=[],u.value="",d.value=!0;const t=g(e);if(0===t.length)return c.value=[e],void(d.value=!1);let n=0;const a=()=>{if(n>=t.length)return void k();const e=t[n];let s=0;h.value&&clearInterval(h.value),h.value=setInterval((()=>{s<=e.length?(u.value=e.substring(0,s),s++):(clearInterval(h.value),c.value.push(e),u.value="",n++,n<t.length?setTimeout(a,v):k())}),p)};a()}catch(t){console.error("打字效果出错:",t),c.value=[e],d.value=!1}},k=()=>{d.value=!1,h.value&&(clearInterval(h.value),h.value=null)},y=()=>{d.value=!1,h.value&&(clearInterval(h.value),h.value=null),c.value=[],u.value=""},f=()=>{const e=(new Date).getHours();return e>=5&&e<12?"morning":e>=12&&e<18?"afternoon":"evening"},P=e=>{if(!e)return"";const t={"向日葵":"向日葵并不关心世界是否在崩溃，她只关心阳光够不够晒到她的脸。她早晨起得比闹钟还早，晚上睡得比月亮还迟。她的梦想很简单——开一场阳光发布会，最好还能有早餐提供。","仙人掌":'没有人真正了解仙人掌。甚至连仙人掌自己也不是很确定，他到底是植物，还是某种硬核的情绪集合体。他喜欢独处，不是因为孤独，而是因为社交时要说"你好"太麻烦。',"郁金香":'"优雅"两个字，如果有具象化，那一定是郁金香——当然，是他自己说的。他不屑于参加普通植物的舞会，只在严寒的午夜出场，然后一言不发地……香了一下。',"白百合":'她不是安静，她是带着回声的沉默。白百合总是在别人崩溃边缘时，递上一句"要不要喝点热水？"她喜欢站在风里发呆，说那样能听见遥远星系的心跳——虽然其他植物觉得那是空气流通的声音。',"白百何":'她不是安静，她是带着回声的沉默。白百合总是在别人崩溃边缘时，递上一句"要不要喝点热水？"她喜欢站在风里发呆，说那样能听见遥远星系的心跳——虽然其他植物觉得那是空气流通的声音。',"玫瑰":"她总是自带BGM登场，哪怕背景是一片荒芜草地，她也能走出红毯既视感。玫瑰没兴趣当墙角里的盆栽，她要做花园的女主角，还是自编自导自演的那种。"};return t[e.trim()]||""};(0,a.hi)((()=>{y()}));const w={"玫瑰":{1:V,2:Y,3:q},"仙人掌":{1:J,2:N,3:U},"郁金香":{1:Z,2:ee,3:te},"白百何":{1:ne,2:ae,3:se},"向日葵":{1:le,2:ie,3:re}},C=e=>{if(!e||!e.type)return V;const t=e.type.trim(),n=e.level||1,a=Math.min(Math.max(n,1),3),s=w[t];return s&&s[a]||V},L=(0,A.Kh)([{id:"plant1",name:"绯色絮语",type:"玫瑰",emoji:"🌹",level:1,experience:0,weather:"sunny",isMainPlant:!1},{id:"plant2",name:"沙屿星芒",type:"仙人掌",emoji:"🌵",level:1,experience:0,weather:"sunny",isMainPlant:!1},{id:"plant3",name:"冰爵士",type:"郁金香",emoji:"🌸",level:1,experience:0,weather:"sunny",isMainPlant:!1},{id:"plant4",name:"云归处",type:"白百何",emoji:"🌲",level:1,experience:0,weather:"sunny",isMainPlant:!1},{id:"plant5",name:"日轮礼赞",type:"向日葵",emoji:"🌻",level:1,experience:0,weather:"sunny",isMainPlant:!1}]);(0,a.sV)((async()=>{await t.fetchPlants();for(const n of L){const e=t.plants.find((e=>e.type===n.type));if(!e)try{const e=await t.createPlant({name:n.name,type:n.type,emoji:n.emoji,isMainPlant:n.isMainPlant});console.log("创建新植物成功:",e)}catch(a){console.error("创建植物失败:",a),Q.nk.error("创建植物失败")}}const e=t.plants.find((e=>e.isMainPlant));if(!e&&t.plants.length>0){const e=t.plants[0],n=e._id||e.id;if(n)try{await t.updatePlant(n,{isMainPlant:!0}),console.log("设置主植物成功:",e.name)}catch(a){console.error("设置主植物失败:",a),Q.nk.error("设置主植物失败")}}await n.fetchTasks()}));const T=e=>{const t=e.experience||0,n=e.level||1;return Math.min(100,t/(100*n)*100)},b=e=>{const n=t.plants.find((t=>T(t)===e));if(!n){if(s.value){const e=t.plants.find((e=>e._id===s.value._id||e.id===s.value.id));if(e){const t=e.experience||0,n=e.level||1,a=100*n;return`${t}/${a}`}}return`${Math.round(e)}%`}const a=n.experience||0,l=n.level||1,i=100*l;return`${a}/${i}`},M=async(e,n)=>{if(e.weather===n)return;const a=e._id||e.id;if(!a)return console.error("无法更新植物天气: 植物ID无效",e),void Q.nk.error("更新失败：无法获取植物ID");console.log("更新植物天气，植物ID:",a,"天气:",n);try{await t.updatePlant(a,{weather:n}),Q.nk.success("植物环境已更新")}catch(s){console.error("更新植物天气失败:",s),Q.nk.error(`更新失败: ${s.message||"未知错误"}`)}},I=e=>{if(!e)return"";try{return(0,G.B)(new Date(e),new Date,{addSuffix:!0,locale:O.A})}catch(t){return console.error("格式化日期失败:",t),(0,H.GP)(new Date(e),"yyyy-MM-dd HH:mm")}},D=async e=>{const n=e._id||e.id;if(!n)return console.error("无法显示植物心声: 植物ID无效",e),void Q.nk.error("无法显示植物心声：植物ID无效");try{s.value=e,l.value=!0;const a=await t.fetchPlantThoughts(n);t.thoughts=a.map((e=>({type:"plant",content:e.content,timestamp:e.timestamp})))}catch(a){console.error("获取植物心声失败:",a),Q.nk.error("获取植物心声失败")}},_=async e=>{const a=e._id||e.id;if(!a)return console.error("无法获取植物心声: 植物ID无效",e),void Q.nk.error("无法获取植物心声：植物ID无效");try{r.value=a;const s={weather:e.weather||"sunny",timeOfDay:f(),recentTasks:n.completedTasks.slice(0,3).map((e=>({id:e._id||e.id,title:e.title,completed:!0})))},l=await t.generatePlantThought(a,s);l?(o.value=l,m(l.content),(0,Q.nk)({message:"植物想和你说话了！",type:"success"}),setTimeout((()=>{r.value===a&&(r.value=null,y())}),15e3)):Q.nk.warning("植物似乎不想说话...")}catch(s){console.error("获取植物心声失败",s),Q.nk.error("获取植物心声失败")}},x=async e=>{if(e.isMainPlant)return;const n=e._id||e.id;if(!n)return console.error("无法设置主植物: 植物ID无效",e),void Q.nk.error("设置失败：无法获取植物ID");console.log("设置主植物，植物ID:",n);try{for(const e of t.plants)if(e.isMainPlant){const n=e._id||e.id;await t.updatePlant(n,{isMainPlant:!1})}await t.updatePlant(n,{isMainPlant:!0}),await t.fetchPlantThoughts(n),l.value&&(s.value=e),Q.nk.success("已设置为主植物")}catch(a){console.error("设置主植物失败:",a),Q.nk.error(`设置失败: ${a.message||"未知错误"}`)}},E=(0,a.EW)((()=>{if(!i.value)return t.plants;const e=i.value.toLowerCase();return t.plants.filter((t=>t.name.toLowerCase().includes(e)))})),F=(0,a.EW)((()=>{if(0===t.plants.length)return 0;const e=t.plants[0];if(!e||!e.createdAt)return 0;const n=new Date(e.createdAt),a=new Date,s=Math.abs(a-n),l=Math.ceil(s/864e5);return l})),K=(0,a.EW)((()=>n.completedTasks.length));return(0,a.wB)((()=>t.plants.find((e=>e.isMainPlant))),(async e=>{if(e){s.value=e;const a=e._id||e.id;if(a)try{const e=await t.fetchPlantThoughts(a);e&&e.length>0&&(o.value=e[0]),l.value&&(t.thoughts=e.map((e=>({type:"plant",content:e.content,timestamp:e.timestamp}))))}catch(n){console.error("更新植物心声失败:",n),Q.nk.error("更新植物心声失败")}}else o.value=null}),{immediate:!0}),{currencyStore:e,plantStore:t,taskStore:n,selectedPlantForDialog:s,showPlantThoughtDialog:l,searchPlant:i,myPlants:(0,a.EW)((()=>t.plants)),filteredPlants:E,plantDays:F,completedTasksCount:K,showingThoughtForPlantId:r,currentThought:o,displayedSegments:c,currentTypingText:u,isTyping:d,calculatePlantExp:T,expFormat:b,updatePlantWeather:M,showDialog:D,listenToPlantThought:_,setAsMainPlant:x,getPlantImage:C,formatThoughtTime:I,getPlantIntroduction:P,startTypingEffect:m,stopTypingEffect:y}}},ce=n(1241);const ue=(0,ce.A)(oe,[["render",S],["__scopeId","data-v-a1f054c2"]]);var de=ue}}]);
//# sourceMappingURL=66.9b031bb3.js.map