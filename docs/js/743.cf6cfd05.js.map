{"version":3,"file":"js/743.cf6cfd05.js","mappings":"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","sources":["webpack://zhiyuxinsheng/./src/stores/currency.js","webpack://zhiyuxinsheng/./src/stores/task.js","webpack://zhiyuxinsheng/./src/views/Profile.vue","webpack://zhiyuxinsheng/./src/views/Profile.vue?24e8","webpack://zhiyuxinsheng/./src/services/ossApi.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport api from '../services/api'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nexport const useCurrencyStore = defineStore('currency', {\r\n  state: () => ({\r\n    coins: parseInt(localStorage.getItem('coins') || '100'),\r\n    loading: false\r\n  }),\r\n  \r\n  actions: {\r\n    // 增加金币\r\n    addCoins(amount) {\r\n      this.coins += amount\r\n      this.saveCoins()\r\n    },\r\n    \r\n    // 减少金币\r\n    deductCoins(amount) {\r\n      if (this.coins >= amount) {\r\n        this.coins -= amount\r\n        this.saveCoins()\r\n        return true\r\n      }\r\n      return false\r\n    },\r\n    \r\n    // 保存金币到本地存储\r\n    saveCoins() {\r\n      localStorage.setItem('coins', this.coins.toString())\r\n    },\r\n    \r\n    // 重置金币\r\n    resetCoins() {\r\n      this.coins = 100\r\n      this.saveCoins()\r\n    }\r\n  }\r\n}) ","import { defineStore } from 'pinia'\nimport { ref, computed } from 'vue'\nimport { usePlantStore } from './plant'\nimport { taskApi } from '../services/api'\nimport { ElMessage } from 'element-plus'\n\nexport const useTaskStore = defineStore('task', () => {\n  // 所有任务数据\n  const tasks = ref([])\n  const systemTasks = ref([])\n  const completedTasks = ref([])\n  const loading = ref(false)\n  \n  // 计算属性：待完成任务\n  const pendingTasks = computed(() => tasks.value.filter(task => !task.completed))\n  \n  // 获取所有任务\n  const fetchTasks = async () => {\n    try {\n      loading.value = true\n      const response = await taskApi.getTasks()\n      tasks.value = response.tasks.filter(task => !task.completed)\n      completedTasks.value = response.tasks.filter(task => task.completed)\n    } catch (error) {\n      ElMessage.error('获取任务列表失败')\n    } finally {\n      loading.value = false\n    }\n  }\n  \n  // 获取系统任务\n  const fetchSystemTasks = async () => {\n    try {\n      loading.value = true\n      const response = await taskApi.getSystemTasks()\n      systemTasks.value = response.tasks\n    } catch (error) {\n      ElMessage.error('获取系统任务失败')\n    } finally {\n      loading.value = false\n    }\n  }\n  \n  // 添加任务\n  const addTask = async (task) => {\n    try {\n      const response = await taskApi.createTask({\n        title: task.title,\n        description: task.description || '',\n        deadline: task.deadline || '',\n        important: task.important || false\n      })\n      \n      // 添加到本地状态\n      tasks.value.push(response.task)\n      \n      // 不再给创建任务增加经验值\n      ElMessage.success('任务创建成功')\n    } catch (error) {\n      ElMessage.error('创建任务失败')\n    }\n  }\n  \n  // 完成任务\n  const completeTask = async (id) => {\n    try {\n      const response = await taskApi.completeTask(id)\n      \n      // 从任务列表中移除\n      const task = tasks.value.find(t => t._id === id)\n      if (task) {\n        // 将任务移动到已完成列表\n        completedTasks.value.unshift({\n          ...task,\n          completed: true,\n          completedAt: new Date().toISOString()\n        })\n        // 从待办任务中移除\n        tasks.value = tasks.value.filter(t => t._id !== id)\n      }\n      \n      // 增加植物经验值\n      const plantStore = usePlantStore()\n      if (plantStore.plants && plantStore.plants.length > 0) {\n        // 获取主植物\n        const mainPlant = plantStore.plants.find(p => p.isMainPlant)\n        if (mainPlant) {\n          const plantId = mainPlant._id || mainPlant.id\n          if (plantId) {\n            // 根据任务是否重要，增加不同的经验值\n            // 普通任务25点，重要任务50点\n            const expAmount = task && task.important ? 50 : 25;\n            await plantStore.gainExperience(plantId, expAmount)\n            \n            // 显示具体获得的经验值\n            ElMessage.success(`任务已完成，获得 ${expAmount} 点经验值！`)\n          }\n        }\n      } else {\n        ElMessage.success('任务已完成')\n      }\n    } catch (error) {\n      ElMessage.error('完成任务失败')\n    }\n  }\n  \n  // 完成系统任务\n  const completeSystemTask = async (id) => {\n    try {\n      const plantStore = usePlantStore()\n      if (!plantStore.currentPlant) {\n        ElMessage.warning('请先添加一个植物')\n        return false\n      }\n      \n      const response = await taskApi.completeSystemTask(id)\n      \n      // 更新任务状态\n      const index = systemTasks.value.findIndex(t => t._id === id)\n      if (index !== -1) {\n        systemTasks.value[index].completed = true\n      }\n      \n      // 如果后端已经处理了经验值奖励，则显示相应的提示\n      if (response.rewards) {\n        ElMessage.success(`完成任务获得 ${response.rewards.experience} 点经验`)\n      } \n      // 如果后端没有处理经验值奖励，则在前端处理\n      else {\n        // 获取主植物\n        const plantId = plantStore.currentPlant._id || plantStore.currentPlant.id\n        if (plantId) {\n          // 系统任务固定增加35点经验值\n          const expAmount = 35;\n          await plantStore.gainExperience(plantId, expAmount)\n          ElMessage.success(`完成系统任务获得 ${expAmount} 点经验值`)\n        }\n      }\n      \n      return true\n    } catch (error) {\n      if (error.response?.status === 400) {\n        ElMessage.warning('今天已经完成过此任务')\n      } else {\n        ElMessage.error('完成系统任务失败')\n      }\n      return false\n    }\n  }\n  \n  // 移除任务\n  const removeTask = async (id) => {\n    try {\n      // 检查ID是否有效\n      if (!id) {\n        ElMessage.error('任务ID无效，无法删除')\n        return\n      }\n      \n      await taskApi.deleteTask(id)\n      tasks.value = tasks.value.filter(task => task._id !== id)\n      ElMessage.success('任务已删除')\n    } catch (error) {\n      console.error('删除任务失败:', error)\n      ElMessage.error('删除任务失败')\n    }\n  }\n  \n  // 删除已完成任务\n  const removeCompletedTask = async (id) => {\n    try {\n      // 检查ID是否有效\n      if (!id) {\n        ElMessage.error('任务ID无效，无法删除')\n        return\n      }\n      \n      await taskApi.deleteTask(id)\n      completedTasks.value = completedTasks.value.filter(task => task._id !== id)\n      ElMessage.success('任务已删除')\n    } catch (error) {\n      console.error('删除任务失败:', error)\n      ElMessage.error('删除任务失败')\n    }\n  }\n  \n  // 更新任务\n  const updateTask = async (updatedTask) => {\n    try {\n      const { _id, title, description, deadline, important } = updatedTask\n      \n      const response = await taskApi.updateTask(_id, {\n        title,\n        description,\n        deadline,\n        important\n      })\n      \n      // 更新本地状态\n      const index = tasks.value.findIndex(t => t._id === _id)\n      if (index !== -1) {\n        tasks.value[index] = response.task\n      }\n      \n      ElMessage.success('任务已更新')\n    } catch (error) {\n      ElMessage.error('更新任务失败')\n    }\n  }\n  \n  // 切换任务重要性\n  const toggleTaskImportance = async (id) => {\n    const task = tasks.value.find(t => t._id === id)\n    if (task) {\n      await updateTask({\n        ...task,\n        important: !task.important\n      })\n    }\n  }\n\n  return {\n    tasks,\n    systemTasks,\n    completedTasks,\n    pendingTasks,\n    loading,\n    \n    fetchTasks,\n    fetchSystemTasks,\n    addTask,\n    completeTask,\n    completeSystemTask,\n    removeTask,\n    removeCompletedTask,\n    updateTask,\n    toggleTaskImportance\n  }\n}) ","<template>\r\n  <div class=\"profile-page\">\r\n    <div class=\"profile-container\">\r\n      <div class=\"page-header\">\r\n        <h1 class=\"page-title\">个人资料</h1>\r\n        <el-button type=\"primary\" @click=\"enterEditMode\" v-if=\"!isEditing\">\r\n          <el-icon><Edit /></el-icon>\r\n          编辑资料\r\n        </el-button>\r\n        <div class=\"header-actions\" v-else>\r\n          <el-button @click=\"cancelEdit\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"saveProfile\" :loading=\"saving\">保存</el-button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"profile-content\">\r\n        <div class=\"profile-sidebar\">\r\n          <div class=\"avatar-container\">\r\n            <el-avatar :size=\"120\" :src=\"editedProfile.avatar || userAvatar\" @click=\"viewOrEditAvatar\" class=\"clickable-avatar\" v-if=\"!isEditing\" />\r\n            <div class=\"avatar-upload\" v-else>\r\n              <el-avatar :size=\"120\" :src=\"editedProfile.avatar || userAvatar\" />\r\n              <div class=\"avatar-upload-mask\">\r\n                <el-popover\r\n                  placement=\"bottom\"\r\n                  :width=\"300\"\r\n                  trigger=\"click\"\r\n                >\r\n                  <template #reference>\r\n                    <el-button type=\"primary\" circle>\r\n                      <el-icon><Camera /></el-icon>\r\n                    </el-button>\r\n                  </template>\r\n                  <div class=\"avatar-options\">\r\n                    <div class=\"avatar-section\">\r\n                      <h4>默认头像</h4>\r\n                      <div class=\"default-avatars\">\r\n                        <div \r\n                          v-for=\"(avatar, index) in defaultAvatars\" \r\n                          :key=\"index\"\r\n                          class=\"default-avatar-item\"\r\n                          @click=\"selectDefaultAvatar(avatar)\"\r\n                        >\r\n                          <el-avatar :size=\"50\" :src=\"avatar\" />\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div class=\"avatar-section\">\r\n                      <h4>上传头像</h4>\r\n                      <el-upload\r\n                        class=\"avatar-uploader\"\r\n                        action=\"#\"\r\n                        :auto-upload=\"false\"\r\n                        :show-file-list=\"false\"\r\n                        :on-change=\"handleAvatarChange\"\r\n                        accept=\"image/*\"\r\n                      >\r\n                        <el-button type=\"primary\">\r\n                          <el-icon><Upload /></el-icon>\r\n                          选择图片\r\n                        </el-button>\r\n                      </el-upload>\r\n                    </div>\r\n                  </div>\r\n                </el-popover>\r\n              </div>\r\n            </div>\r\n            <h2 class=\"username\">{{ authStore.userInfo.username }}</h2>\r\n            <div class=\"user-level\">\r\n              <el-tag type=\"success\">等级 {{ userLevel }}</el-tag>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"sidebar-stats\">\r\n            <div class=\"stat-item achievement\">\r\n              <div class=\"stat-icon\">\r\n                <el-icon><Trophy /></el-icon>\r\n              </div>\r\n              <div class=\"stat-content\">\r\n                <div class=\"stat-label\">一路走来，你已经完成了 <span class=\"highlight\">{{ completedTasksCount }}</span> 个任务</div>\r\n              </div>\r\n            </div>\r\n            <div class=\"stat-item companion\">\r\n              <div class=\"stat-icon\">\r\n                <el-icon><Sunny /></el-icon>\r\n              </div>\r\n              <div class=\"stat-content\">\r\n                <div class=\"stat-label\">你的植物朋友们，已经陪伴了你 <span class=\"highlight\">{{ plantDays }}</span> 天</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"profile-details\">\r\n          <el-form :model=\"editedProfile\" label-position=\"top\" :disabled=\"!isEditing\" class=\"modern-form\">\r\n            <div class=\"form-section\">\r\n              <h3 class=\"section-title\">基本信息</h3>\r\n              <el-form-item label=\"用户名\" class=\"form-item-animated\">\r\n                <el-input v-model=\"editedProfile.username\" placeholder=\"请输入用户名\" class=\"modern-input\" />\r\n              </el-form-item>\r\n              <el-form-item label=\"邮箱\" class=\"form-item-animated\">\r\n                <el-input v-model=\"editedProfile.email\" placeholder=\"请输入邮箱\" disabled class=\"modern-input\" />\r\n              </el-form-item>\r\n              <el-form-item label=\"性别\" class=\"form-item-animated\">\r\n                <el-select v-model=\"editedProfile.gender\" placeholder=\"请选择性别\" class=\"modern-select\">\r\n                  <el-option label=\"男\" value=\"male\" />\r\n                  <el-option label=\"女\" value=\"female\" />\r\n                  <el-option label=\"保密\" value=\"secret\" />\r\n                </el-select>\r\n              </el-form-item>\r\n              <el-form-item label=\"生日\" class=\"form-item-animated\">\r\n                <el-date-picker\r\n                  v-model=\"editedProfile.birthday\"\r\n                  type=\"date\"\r\n                  placeholder=\"请选择生日\"\r\n                  format=\"YYYY-MM-DD\"\r\n                  value-format=\"YYYY-MM-DD\"\r\n                  :disabled-date=\"disabledDate\"\r\n                  clearable\r\n                  class=\"modern-date-picker\"\r\n                />\r\n              </el-form-item>\r\n              <el-form-item label=\"年龄\" class=\"form-item-animated\">\r\n                <el-input :model-value=\"computedAge\" disabled class=\"modern-input\">\r\n                  <template #append>岁</template>\r\n                </el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"所在地\" class=\"form-item-animated\">\r\n                <el-input v-model=\"editedProfile.location\" placeholder=\"请输入所在地\" class=\"modern-input\" />\r\n              </el-form-item>\r\n              <el-form-item label=\"个性签名\" class=\"form-item-animated\">\r\n                <el-input \r\n                  v-model=\"editedProfile.signature\" \r\n                  type=\"textarea\" \r\n                  :rows=\"2\" \r\n                  placeholder=\"写下你的个性签名...\" \r\n                  class=\"modern-textarea\"\r\n                />\r\n              </el-form-item>\r\n              <el-form-item label=\"个人简介\" class=\"form-item-animated\">\r\n                <el-input \r\n                  v-model=\"editedProfile.bio\" \r\n                  type=\"textarea\" \r\n                  :rows=\"4\" \r\n                  placeholder=\"介绍一下自己吧...\" \r\n                  class=\"modern-textarea\"\r\n                />\r\n              </el-form-item>\r\n            </div>\r\n          </el-form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 修改密码对话框 -->\r\n    <el-dialog\r\n      v-model=\"showPasswordDialog\"\r\n      title=\"修改密码\"\r\n      width=\"30%\"\r\n      custom-class=\"modern-dialog\"\r\n    >\r\n      <el-form :model=\"passwordForm\" label-width=\"120px\" :rules=\"passwordRules\" ref=\"passwordFormRef\" class=\"modern-form\">\r\n        <el-form-item label=\"当前密码\" prop=\"currentPassword\" class=\"form-item-animated\">\r\n          <el-input \r\n            v-model=\"passwordForm.currentPassword\" \r\n            type=\"password\" \r\n            show-password \r\n            placeholder=\"请输入当前密码\"\r\n            class=\"modern-input\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item label=\"新密码\" prop=\"newPassword\" class=\"form-item-animated\">\r\n          <el-input \r\n            v-model=\"passwordForm.newPassword\" \r\n            type=\"password\" \r\n            show-password \r\n            placeholder=\"请输入新密码\"\r\n            class=\"modern-input\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item label=\"确认新密码\" prop=\"confirmPassword\" class=\"form-item-animated\">\r\n          <el-input \r\n            v-model=\"passwordForm.confirmPassword\" \r\n            type=\"password\" \r\n            show-password \r\n            placeholder=\"请再次输入新密码\"\r\n            class=\"modern-input\"\r\n          />\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <div class=\"dialog-footer\">\r\n          <el-button @click=\"showPasswordDialog = false\" class=\"cancel-button\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"changePassword\" :loading=\"changingPassword\" class=\"save-button\">\r\n            确认修改\r\n          </el-button>\r\n        </div>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch, onMounted, reactive } from 'vue'\r\nimport { useAuthStore } from '../stores/auth'\r\nimport { usePlantStore } from '../stores/plant'\r\nimport { useTaskStore } from '../stores/task'\r\nimport { useCurrencyStore } from '../stores/currency'\r\nimport { Edit, Camera, Upload, Trophy, Sunny } from '@element-plus/icons-vue'\r\nimport { ElMessage, ElLoading } from 'element-plus'\r\nimport ossApi from '@/services/ossApi'\r\n    \r\n// 计算植物陪伴的天数\r\nconst plantDays = computed(() => {\r\n      if (plantStore.plants.length === 0) return 0\r\n      \r\n      // 使用第一个植物的创建时间计算\r\n      const firstPlant = plantStore.plants[0]\r\n      if (!firstPlant || !firstPlant.createdAt) return 0\r\n      \r\n      const createdDate = new Date(firstPlant.createdAt)\r\n      const today = new Date()\r\n      const diffTime = Math.abs(today - createdDate)\r\n      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))\r\n      \r\n      return diffDays\r\n    })\r\n    \r\n// 获取store实例\r\nconst authStore = useAuthStore()\r\nconst plantStore = usePlantStore()\r\nconst taskStore = useTaskStore()\r\nconst currencyStore = useCurrencyStore()\r\n\r\n// 基本数据\r\nconst isEditing = ref(false)\r\nconst saving = ref(false)\r\nconst editedProfile = ref({\r\n  username: authStore.userInfo.username || '',\r\n  email: authStore.userInfo.email || '',\r\n  avatar: authStore.userInfo.avatar || '',\r\n  bio: authStore.userInfo.bio || '',\r\n  gender: authStore.userInfo.gender || 'secret',\r\n  birthday: authStore.userInfo.birthday || '',\r\n  location: authStore.userInfo.location || '',\r\n  signature: authStore.userInfo.signature || ''\r\n})\r\n\r\n// 默认头像列表\r\nconst defaultAvatars = [\r\n  '/avatars/default1.png',\r\n  '/avatars/default2.png',\r\n  '/avatars/default3.png',\r\n  '/avatars/default4.png',\r\n  '/avatars/default5.png',\r\n  '/avatars/default6.png',\r\n]\r\n\r\n// 计算年龄\r\nconst computedAge = computed(() => {\r\n  if (!editedProfile.value.birthday) return '保密';\r\n  const birthDate = new Date(editedProfile.value.birthday);\r\n  const today = new Date();\r\n  let age = today.getFullYear() - birthDate.getFullYear();\r\n  const m = today.getMonth() - birthDate.getMonth();\r\n  if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {\r\n    age--;\r\n  }\r\n  return age.toString();\r\n});\r\n\r\n// 禁用未来日期\r\nconst disabledDate = (time) => {\r\n  return time.getTime() > Date.now();\r\n};\r\n\r\n// 计算属性\r\nconst userAvatar = computed(() => {\r\n  return authStore.userInfo.avatar || 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png'\r\n})\r\n\r\nconst userLevel = computed(() => {\r\n  return authStore.userInfo.level || 1\r\n})\r\n\r\nconst completedTasksCount = computed(() => {\r\n  return taskStore.completedTasks?.length || 0\r\n})\r\n\r\nconst plantCount = computed(() => {\r\n  return plantStore.plants?.length || 0\r\n})\r\n\r\n// 修改密码相关\r\nconst showPasswordDialog = ref(false)\r\nconst changingPassword = ref(false)\r\nconst passwordFormRef = ref(null)\r\nconst passwordForm = reactive({\r\n  currentPassword: '',\r\n  newPassword: '',\r\n  confirmPassword: ''\r\n})\r\n\r\nconst passwordRules = {\r\n  currentPassword: [\r\n    { required: true, message: '请输入当前密码', trigger: 'blur' }\r\n  ],\r\n  newPassword: [\r\n    { required: true, message: '请输入新密码', trigger: 'blur' },\r\n    { min: 6, message: '密码长度不能少于6个字符', trigger: 'blur' }\r\n  ],\r\n  confirmPassword: [\r\n    { required: true, message: '请确认新密码', trigger: 'blur' },\r\n    { \r\n      validator: (rule, value, callback) => {\r\n        if (value !== passwordForm.newPassword) {\r\n          callback(new Error('两次输入的密码不一致'))\r\n        } else {\r\n          callback()\r\n        }\r\n      }, \r\n      trigger: 'blur' \r\n    }\r\n  ]\r\n}\r\n\r\n// 选择默认头像\r\nconst selectDefaultAvatar = (avatar) => {\r\n  editedProfile.value.avatar = avatar\r\n}\r\n\r\n// 处理头像变更\r\nconst handleAvatarChange = async (file) => {\r\n  try {\r\n    // 文件类型检查\r\n    const isImage = file.raw.type.startsWith('image/')\r\n    if (!isImage) {\r\n      ElMessage.error('只能上传图片文件！')\r\n      return\r\n    }\r\n    \r\n    // 文件大小检查（限制为2MB）\r\n    const isLt2M = file.raw.size / 1024 / 1024 < 5\r\n    if (!isLt2M) {\r\n      ElMessage.error('图片大小不能超过5MB！')\r\n      return\r\n    }\r\n    \r\n    // 显示上传中的加载状态\r\n    const loading = ElLoading.service({\r\n      lock: true,\r\n      text: '头像上传中...',\r\n      background: 'rgba(0, 0, 0, 0.7)'\r\n    })\r\n    \r\n    try {\r\n      // 上传图片到OSS\r\n      const fileUrl = await ossApi.uploadFile(file.raw, 'avatars/')\r\n      console.log('头像上传成功，URL:', fileUrl)\r\n      \r\n      // 更新头像URL\r\n      editedProfile.value.avatar = fileUrl\r\n      \r\n      ElMessage.success('头像上传成功')\r\n    } finally {\r\n      loading.close()\r\n    }\r\n  } catch (error) {\r\n    console.error('上传头像失败:', error)\r\n    ElMessage.error('上传头像失败，请重试')\r\n  }\r\n}\r\n\r\n// 加载用户数据\r\nonMounted(async () => {\r\n  try {\r\n    // 强制刷新用户信息\r\n    await authStore.fetchUserInfo()\r\n    \r\n    // 更新本地编辑数据\r\n    editedProfile.value = {\r\n      username: authStore.userInfo.username || '',\r\n      email: authStore.userInfo.email || '',\r\n      avatar: authStore.userInfo.avatar || '',\r\n      bio: authStore.userInfo.bio || '',\r\n      gender: authStore.userInfo.gender || 'secret',\r\n      birthday: authStore.userInfo.birthday || '',\r\n      location: authStore.userInfo.location || '',\r\n      signature: authStore.userInfo.signature || ''\r\n    }\r\n    \r\n    console.log('用户头像URL:', authStore.userInfo.avatar)\r\n  } catch (error) {\r\n    console.error('加载用户信息失败:', error)\r\n    ElMessage.error('加载用户信息失败')\r\n  }\r\n})\r\n\r\n// 进入编辑模式\r\nconst enterEditMode = () => {\r\n  isEditing.value = true\r\n}\r\n\r\n// 取消编辑\r\nconst cancelEdit = () => {\r\n  isEditing.value = false\r\n  // 重置编辑数据\r\n  editedProfile.value = {\r\n    username: authStore.userInfo.username || '',\r\n    email: authStore.userInfo.email || '',\r\n    avatar: authStore.userInfo.avatar || '',\r\n    bio: authStore.userInfo.bio || '',\r\n    gender: authStore.userInfo.gender || 'secret',\r\n    birthday: authStore.userInfo.birthday || '',\r\n    location: authStore.userInfo.location || '',\r\n    signature: authStore.userInfo.signature || ''\r\n  }\r\n}\r\n\r\n// 保存个人资料\r\nconst saveProfile = async () => {\r\n  saving.value = true\r\n  try {\r\n    // 确保头像URL也被保存\r\n    const profileToSave = { ...editedProfile.value }\r\n    \r\n    // 调用API更新用户资料\r\n    await authStore.updateProfile(profileToSave)\r\n    \r\n    // 重新获取用户信息以确保数据同步\r\n    await authStore.fetchUserInfo()\r\n    \r\n    ElMessage.success('个人资料更新成功')\r\n    isEditing.value = false\r\n  } catch (error) {\r\n    console.error('更新个人资料失败:', error)\r\n    ElMessage.error('更新个人资料失败')\r\n  } finally {\r\n    saving.value = false\r\n  }\r\n}\r\n\r\n// 显示修改密码对话框\r\nconst showChangePasswordDialog = () => {\r\n  showPasswordDialog.value = true\r\n  // 重置表单\r\n  passwordForm.currentPassword = ''\r\n  passwordForm.newPassword = ''\r\n  passwordForm.confirmPassword = ''\r\n}\r\n\r\n// 修改密码\r\nconst changePassword = async () => {\r\n  if (!passwordFormRef.value) return\r\n  \r\n  await passwordFormRef.value.validate(async (valid) => {\r\n    if (!valid) return\r\n    \r\n    changingPassword.value = true\r\n    try {\r\n      await authStore.changePassword({\r\n        currentPassword: passwordForm.currentPassword,\r\n        newPassword: passwordForm.newPassword\r\n      })\r\n      \r\n      ElMessage.success('密码修改成功')\r\n      showPasswordDialog.value = false\r\n    } catch (error) {\r\n      console.error('修改密码失败:', error)\r\n    } finally {\r\n      changingPassword.value = false\r\n    }\r\n  })\r\n}\r\n\r\n// 查看或修改头像\r\nconst viewOrEditAvatar = () => {\r\n  if (isEditing.value) {\r\n    // 打开头像编辑弹窗\r\n    ElMessage.info('进入头像编辑模式');\r\n  } else {\r\n    // 查看头像逻辑\r\n    const avatarUrl = editedProfile.value.avatar || 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png';\r\n    window.open(avatarUrl, '_blank'); // 打开头像图片\r\n  }\r\n}\r\n\r\n// 显示头像悬停提示文字\r\nconst showAvatarHover = ref(false)\r\n</script>\r\n\r\n<style scoped>\r\n.profile-page {\r\n  padding: 20px;\r\n  min-height: 100vh;\r\n}\r\n\r\n.profile-container {\r\n  max-width: 1000px;\r\n  margin: 0 auto;\r\n  background-color: #fff;\r\n  border-radius: 16px;\r\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);\r\n  padding: 24px;\r\n  animation: fadeIn 0.5s ease;\r\n}\r\n\r\n@keyframes fadeIn {\r\n  from {\r\n    opacity: 0;\r\n    transform: translateY(10px);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n.page-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 24px;\r\n  padding-bottom: 16px;\r\n  border-bottom: 1px solid #eee;\r\n}\r\n\r\n.page-title {\r\n  font-size: 24px;\r\n  margin: 0;\r\n  color: #303133;\r\n  font-weight: 600;\r\n  position: relative;\r\n  padding-left: 16px;\r\n}\r\n\r\n.page-title::before {\r\n  content: '';\r\n  position: absolute;\r\n  left: 0;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  width: 4px;\r\n  height: 20px;\r\n  background: linear-gradient(to bottom, #42b983, #2d9cdb);\r\n  border-radius: 2px;\r\n}\r\n\r\n.header-actions {\r\n  display: flex;\r\n  gap: 12px;\r\n}\r\n\r\n.profile-content {\r\n  display: grid;\r\n  grid-template-columns: 280px 1fr;\r\n  gap: 24px;\r\n}\r\n\r\n.profile-sidebar {\r\n  background: linear-gradient(145deg, #f9fafc, #f5f7fa);\r\n  border-radius: 16px;\r\n  padding: 24px;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\r\n  height: fit-content;\r\n  border: 1px solid rgba(0, 0, 0, 0.03);\r\n}\r\n\r\n.avatar-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-bottom: 24px;\r\n}\r\n\r\n.clickable-avatar {\r\n  border: 4px solid white;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.clickable-avatar:hover {\r\n  transform: scale(1.05);\r\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.username {\r\n  margin: 16px 0 8px;\r\n  font-size: 20px;\r\n  font-weight: 600;\r\n  color: #303133;\r\n}\r\n\r\n.user-level {\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.user-level .el-tag {\r\n  padding: 6px 12px;\r\n  border-radius: 20px;\r\n  font-size: 13px;\r\n  font-weight: 500;\r\n}\r\n\r\n.sidebar-stats {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16px;\r\n  margin-top: 24px;\r\n}\r\n\r\n.stat-item {\r\n  display: flex;\r\n  align-items: flex-start;\r\n  gap: 12px;\r\n  background: linear-gradient(145deg, #ffffff, #f9fafc);\r\n  border-radius: 14px;\r\n  padding: 16px;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);\r\n  transition: all 0.3s ease;\r\n  border: 1px solid rgba(0, 0, 0, 0.03);\r\n}\r\n\r\n.stat-item:hover {\r\n  transform: translateY(-3px);\r\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);\r\n}\r\n\r\n.stat-icon {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 12px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.achievement .stat-icon {\r\n  background: linear-gradient(135deg, #FFA53E, #FF7643);\r\n  color: white;\r\n  font-size: 20px;\r\n}\r\n\r\n.companion .stat-icon {\r\n  background: linear-gradient(135deg, #50C4ED, #7FDBFF);\r\n  color: white;\r\n  font-size: 20px;\r\n}\r\n\r\n.stat-content {\r\n  flex: 1;\r\n}\r\n\r\n.stat-label {\r\n  font-size: 14px;\r\n  color: #606266;\r\n  font-weight: 500;\r\n  line-height: 1.5;\r\n}\r\n\r\n.highlight {\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  background: linear-gradient(135deg, #42b983, #2d9cdb);\r\n  -webkit-background-clip: text;\r\n  -webkit-text-fill-color: transparent;\r\n  padding: 0 2px;\r\n}\r\n\r\n.profile-details {\r\n  background-color: white;\r\n  border-radius: 16px;\r\n  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);\r\n  border: 1px solid rgba(0, 0, 0, 0.03);\r\n  overflow: hidden;\r\n}\r\n\r\n.form-section {\r\n  padding: 0 16px;\r\n}\r\n\r\n.section-title {\r\n  font-size: 18px;\r\n  margin: 16px 0;\r\n  padding: 12px 0;\r\n  color: #303133;\r\n  font-weight: 600;\r\n  position: relative;\r\n  padding-left: 16px;\r\n}\r\n\r\n.section-title::before {\r\n  content: '';\r\n  position: absolute;\r\n  left: 0;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  width: 4px;\r\n  height: 18px;\r\n  background: linear-gradient(to bottom, #42b983, #2d9cdb);\r\n  border-radius: 2px;\r\n}\r\n\r\n.avatar-upload {\r\n  position: relative;\r\n}\r\n\r\n.avatar-upload-mask {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  opacity: 0;\r\n  transition: opacity 0.3s;\r\n}\r\n\r\n.avatar-upload:hover .avatar-upload-mask {\r\n  opacity: 1;\r\n}\r\n\r\n.avatar-icon {\r\n  font-size: 24px;\r\n  color: white;\r\n}\r\n\r\n/* 响应式设计 */\r\n@media screen and (max-width: 768px) {\r\n  .profile-content {\r\n    grid-template-columns: 1fr;\r\n  }\r\n  \r\n  .profile-sidebar {\r\n    padding: 16px;\r\n  }\r\n  \r\n  .sidebar-stats {\r\n    grid-template-columns: repeat(3, 1fr);\r\n  }\r\n}\r\n\r\n.el-form-item {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.el-select {\r\n  width: 100%;\r\n}\r\n\r\n.el-date-picker {\r\n  width: 100%;\r\n}\r\n\r\n.avatar-options {\r\n  padding: 16px;\r\n}\r\n\r\n.avatar-section {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.avatar-section h4 {\r\n  margin: 0 0 12px 0;\r\n  color: #606266;\r\n  font-weight: 600;\r\n}\r\n\r\n.default-avatars {\r\n  display: grid;\r\n  grid-template-columns: repeat(3, 1fr);\r\n  gap: 12px;\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.default-avatar-item {\r\n  cursor: pointer;\r\n  transition: transform 0.3s;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.default-avatar-item:hover {\r\n  transform: scale(1.1);\r\n}\r\n\r\n.default-avatar-item .el-avatar {\r\n  border: 2px solid transparent;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.default-avatar-item:hover .el-avatar {\r\n  border-color: #42b983;\r\n  box-shadow: 0 4px 12px rgba(66, 185, 131, 0.2);\r\n}\r\n\r\n.avatar-uploader {\r\n  text-align: center;\r\n}\r\n\r\n.avatar-uploader :deep(.el-button) {\r\n  padding: 10px 20px;\r\n  border-radius: 30px;\r\n}\r\n\r\n.clickable-avatar {\r\n  cursor: pointer;\r\n}\r\n\r\n/* 美化表单元素 */\r\n.modern-form :deep(.el-form-item__label) {\r\n  font-weight: 600;\r\n  color: #606266;\r\n  padding-bottom: 8px;\r\n}\r\n\r\n.modern-input :deep(.el-input__wrapper),\r\n.modern-textarea :deep(.el-textarea__inner),\r\n.modern-date-picker :deep(.el-input__wrapper),\r\n.modern-select :deep(.el-input__wrapper) {\r\n  border-radius: 10px;\r\n  border: 1px solid #e0e7ff;\r\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);\r\n  transition: all 0.3s;\r\n}\r\n\r\n.modern-input :deep(.el-input__wrapper:hover),\r\n.modern-textarea :deep(.el-textarea__inner:hover),\r\n.modern-date-picker :deep(.el-input__wrapper:hover),\r\n.modern-select :deep(.el-input__wrapper:hover) {\r\n  border-color: #42b983;\r\n  box-shadow: 0 4px 8px rgba(66, 185, 131, 0.1);\r\n}\r\n\r\n.modern-input :deep(.el-input__wrapper.is-focus),\r\n.modern-textarea :deep(.el-textarea__inner:focus),\r\n.modern-date-picker :deep(.el-input__wrapper.is-focus),\r\n.modern-select :deep(.el-input__wrapper.is-focus) {\r\n  border-color: #42b983;\r\n  box-shadow: 0 0 0 2px rgba(66, 185, 131, 0.2);\r\n}\r\n\r\n.form-item-animated {\r\n  animation: fadeInUp 0.5s ease;\r\n  animation-fill-mode: both;\r\n}\r\n\r\n.form-item-animated:nth-child(1) {\r\n  animation-delay: 0.1s;\r\n}\r\n\r\n.form-item-animated:nth-child(2) {\r\n  animation-delay: 0.15s;\r\n}\r\n\r\n.form-item-animated:nth-child(3) {\r\n  animation-delay: 0.2s;\r\n}\r\n\r\n.form-item-animated:nth-child(4) {\r\n  animation-delay: 0.25s;\r\n}\r\n\r\n.form-item-animated:nth-child(5) {\r\n  animation-delay: 0.3s;\r\n}\r\n\r\n.form-item-animated:nth-child(6) {\r\n  animation-delay: 0.35s;\r\n}\r\n\r\n.form-item-animated:nth-child(7) {\r\n  animation-delay: 0.4s;\r\n}\r\n\r\n.form-item-animated:nth-child(8) {\r\n  animation-delay: 0.45s;\r\n}\r\n\r\n@keyframes fadeInUp {\r\n  from {\r\n    opacity: 0;\r\n    transform: translateY(10px);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n/* 对话框样式 */\r\n.modern-dialog :deep(.el-dialog__header) {\r\n  padding: 20px 24px;\r\n  border-bottom: 1px solid #eee;\r\n  background: linear-gradient(135deg, #42b983, #2d9cdb);\r\n}\r\n\r\n.modern-dialog :deep(.el-dialog__title) {\r\n  color: white;\r\n  font-size: 20px;\r\n  font-weight: 500;\r\n}\r\n\r\n.modern-dialog :deep(.el-dialog__headerbtn .el-dialog__close) {\r\n  color: rgba(255, 255, 255, 0.9);\r\n}\r\n\r\n.modern-dialog :deep(.el-dialog__body) {\r\n  padding: 24px;\r\n}\r\n\r\n.dialog-footer {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 12px;\r\n  padding-top: 10px;\r\n}\r\n\r\n.cancel-button,\r\n.save-button {\r\n  padding: 10px 20px;\r\n  border-radius: 30px;\r\n  border: none;\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.cancel-button {\r\n  background-color: #f5f7fa;\r\n  color: #606266;\r\n}\r\n\r\n.cancel-button:hover {\r\n  background-color: #e9ecf2;\r\n}\r\n\r\n.save-button {\r\n  background: linear-gradient(135deg, #42b983, #2d9cdb);\r\n  color: white;\r\n}\r\n\r\n.save-button:hover {\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 6px 18px rgba(66, 185, 131, 0.35);\r\n}\r\n\r\n.save-button:active {\r\n  transform: translateY(1px);\r\n  box-shadow: 0 2px 8px rgba(66, 185, 131, 0.3);\r\n}\r\n</style>","import script from \"./Profile.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Profile.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Profile.vue?vue&type=style&index=0&id=7ec82c14&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-7ec82c14\"]])\n\nexport default __exports__","import api from './api';\r\nimport axios from 'axios';\r\n\r\n// OSS操作相关API\r\nconst ossApi = {\r\n  /**\r\n   * 获取OSS配置（临时凭证）\r\n   * @returns {Promise<Object>} OSS配置信息\r\n   */\r\n  getOSSConfig() {\r\n    return api.get('/oss/config');\r\n  },\r\n\r\n  /**\r\n   * 获取OSS上传策略（Policy）\r\n   * @param {string} dir 上传目录\r\n   * @returns {Promise<Object>} 上传策略\r\n   */\r\n  getOSSPolicy(dir = 'posts/') {\r\n    return api.get('/oss/policy', { params: { dir } });\r\n  },\r\n\r\n  /**\r\n   * 直接上传文件到阿里云OSS\r\n   * @param {File} file 要上传的文件对象\r\n   * @param {string} dir 上传目录\r\n   * @returns {Promise<string>} 文件的URL\r\n   */\r\n  async uploadFile(file, dir = 'posts/') {\r\n    try {\r\n      // 1. 获取上传策略\r\n      const policyRes = await this.getOSSPolicy(dir);\r\n      const policy = policyRes.policy;\r\n      \r\n      if (!policy) {\r\n        throw new Error('获取上传策略失败');\r\n      }\r\n      \r\n      // 检查并处理host，确保是一个有效的URL字符串\r\n      let host = policy.host;\r\n      if (typeof host === 'object') {\r\n        console.error('Host 是一个对象而不是字符串:', host);\r\n        // 尝试从对象中获取URL，或者构建一个默认URL\r\n        host = `https://${policy.bucket}.${policy.region}.aliyuncs.com`;\r\n      }\r\n      \r\n      // 确保host是一个有效的URL字符串\r\n      if (!host.startsWith('http')) {\r\n        host = `https://${host}`;\r\n      }\r\n      \r\n      // 2. 准备表单数据\r\n      const formData = new FormData();\r\n      const key = `${policy.key}${file.name.substring(file.name.lastIndexOf('.'))}`;\r\n      \r\n      formData.append('key', key);\r\n      formData.append('OSSAccessKeyId', policy.accessKeyId);\r\n      formData.append('policy', policy.policyBase64);\r\n      formData.append('signature', policy.signature);\r\n      formData.append('success_action_status', '200');\r\n      formData.append('file', file);\r\n      \r\n      console.log('正在上传文件到:', host);\r\n      \r\n      // 3. 上传文件到OSS\r\n      await axios.post(host, formData, {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data'\r\n        }\r\n      });\r\n      \r\n      // 4. 返回文件URL\r\n      let cdnHost = policy.cdnHost || host;\r\n      if (typeof cdnHost === 'object') {\r\n        cdnHost = host; // 如果cdnHost也是对象，则使用host\r\n      }\r\n      \r\n      // 确保URL格式正确\r\n      const fileUrl = `${cdnHost}/${key}`;\r\n      console.log('文件上传成功，URL:', fileUrl);\r\n      \r\n      return fileUrl;\r\n    } catch (error) {\r\n      console.error('上传文件到OSS失败:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  \r\n  /**\r\n   * 批量上传文件到阿里云OSS\r\n   * @param {Array<File>} files 要上传的文件对象数组\r\n   * @param {string} dir 上传目录\r\n   * @returns {Promise<Array<string>>} 文件URL数组\r\n   */\r\n  async uploadMultipleFiles(files, dir = 'posts/') {\r\n    if (!files || files.length === 0) {\r\n      return [];\r\n    }\r\n    \r\n    try {\r\n      // 同时获取一次上传策略\r\n      const policyRes = await this.getOSSPolicy(dir);\r\n      const policy = policyRes.policy;\r\n      \r\n      if (!policy) {\r\n        throw new Error('获取上传策略失败');\r\n      }\r\n      \r\n      // 检查并处理host，确保是一个有效的URL字符串\r\n      let host = policy.host;\r\n      if (typeof host === 'object') {\r\n        console.error('Host 是一个对象而不是字符串:', host);\r\n        // 尝试从对象中获取URL，或者构建一个默认URL\r\n        host = `https://${policy.bucket}.${policy.region}.aliyuncs.com`;\r\n      }\r\n      \r\n      // 确保host是一个有效的URL字符串\r\n      if (!host.startsWith('http')) {\r\n        host = `https://${host}`;\r\n      }\r\n      \r\n      console.log('准备批量上传文件到:', host);\r\n      \r\n      // 并行上传所有文件\r\n      const uploadPromises = files.map(async (file, index) => {\r\n        try {\r\n          const formData = new FormData();\r\n          const key = `${policy.key}-${index}${file.name.substring(file.name.lastIndexOf('.'))}`;\r\n          \r\n          formData.append('key', key);\r\n          formData.append('OSSAccessKeyId', policy.accessKeyId);\r\n          formData.append('policy', policy.policyBase64);\r\n          formData.append('signature', policy.signature);\r\n          formData.append('success_action_status', '200');\r\n          formData.append('file', file);\r\n          \r\n          await axios.post(host, formData, {\r\n            headers: {\r\n              'Content-Type': 'multipart/form-data'\r\n            }\r\n          });\r\n          \r\n          // 处理返回URL\r\n          let cdnHost = policy.cdnHost || host;\r\n          if (typeof cdnHost === 'object') {\r\n            cdnHost = host; // 如果cdnHost也是对象，则使用host\r\n          }\r\n          \r\n          const fileUrl = `${cdnHost}/${key}`;\r\n          console.log(`文件 ${index+1}/${files.length} 上传成功:`, fileUrl);\r\n          return fileUrl;\r\n        } catch (error) {\r\n          console.error(`文件 ${index+1}/${files.length} 上传失败:`, error);\r\n          throw error;\r\n        }\r\n      });\r\n      \r\n      // 等待所有上传完成\r\n      const fileUrls = await Promise.all(uploadPromises);\r\n      console.log('所有文件上传完成，URL列表:', fileUrls);\r\n      return fileUrls;\r\n    } catch (error) {\r\n      console.error('批量上传文件到OSS失败:', error);\r\n      throw error;\r\n    }\r\n  }\r\n};\r\n\r\nexport default ossApi; "],"names":["useCurrencyStore","defineStore","state","coins","parseInt","localStorage","getItem","loading","actions","addCoins","amount","this","saveCoins","deductCoins","setItem","toString","resetCoins","useTaskStore","tasks","ref","systemTasks","completedTasks","pendingTasks","computed","value","filter","task","completed","fetchTasks","async","response","taskApi","getTasks","error","ElMessage","fetchSystemTasks","getSystemTasks","addTask","createTask","title","description","deadline","important","push","success","completeTask","id","find","t","_id","unshift","completedAt","Date","toISOString","plantStore","usePlantStore","plants","length","mainPlant","p","isMainPlant","plantId","expAmount","gainExperience","completeSystemTask","currentPlant","warning","index","findIndex","rewards","experience","status","removeTask","deleteTask","console","removeCompletedTask","updateTask","updatedTask","toggleTaskImportance","plantDays","firstPlant","createdAt","createdDate","today","diffTime","Math","abs","diffDays","ceil","authStore","useAuthStore","taskStore","isEditing","saving","editedProfile","username","userInfo","email","avatar","bio","gender","birthday","location","signature","defaultAvatars","computedAge","birthDate","age","getFullYear","m","getMonth","getDate","disabledDate","time","getTime","now","userAvatar","userLevel","level","completedTasksCount","showPasswordDialog","changingPassword","passwordFormRef","passwordForm","reactive","currentPassword","newPassword","confirmPassword","passwordRules","required","message","trigger","min","validator","rule","callback","Error","selectDefaultAvatar","handleAvatarChange","isImage","file","raw","type","startsWith","isLt2M","size","ElLoading","service","lock","text","background","fileUrl","ossApi","uploadFile","log","close","onMounted","fetchUserInfo","enterEditMode","cancelEdit","saveProfile","profileToSave","updateProfile","changePassword","validate","valid","viewOrEditAvatar","info","avatarUrl","window","open","__exports__","getOSSConfig","api","get","getOSSPolicy","dir","params","policyRes","policy","host","bucket","region","formData","FormData","key","name","substring","lastIndexOf","append","accessKeyId","policyBase64","axios","headers","cdnHost","uploadMultipleFiles","files","uploadPromises","map","fileUrls","Promise","all"],"sourceRoot":""}