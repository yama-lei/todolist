(function(){"use strict";var t={14:function(t,e,a){a.d(e,{n:function(){return u}});var n=a(2261),s=a(144),r=a(6768),o=a(788),l=a.n(o),i=a(1219);a(6564);const c={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||"http://localhost:3001/api",u=(0,n.nY)("auth",(()=>{const t=(0,s.KR)(null),e=(0,s.KR)(localStorage.getItem("token")||""),a=(0,s.KR)(!1),n=(0,s.KR)(null),o=(0,r.EW)((()=>!!e.value)),u=(0,r.EW)((()=>t.value||{})),d=(0,r.EW)((()=>"admin"===t.value?.role)),h=async s=>{a.value=!0,n.value=null;try{const a={email:s.email,password:s.password},n=await l().post(`${c}/auth/login`,a),{token:r,user:o}=n.data;return e.value=r,t.value=o,s.remember,localStorage.setItem("token",r),l().defaults.headers.common["Authorization"]=`Bearer ${r}`,i.nk.success("登录成功!"),n.data}catch(r){throw console.error("登录失败:",r),n.value=r.response?.data?.message||"登录失败，请检查您的邮箱和密码",i.nk.error(n.value),r}finally{a.value=!1}},p=async t=>{a.value=!0,n.value=null;try{const e=await l().post(`${c}/auth/register`,t);return i.nk.success("注册成功！请登录您的账号。"),e.data}catch(e){throw console.error("注册失败:",e),n.value=e.response?.data?.message||"注册失败，请稍后再试",i.nk.error(n.value),e}finally{a.value=!1}},g=async t=>{a.value=!0,n.value=null;try{const e=await l().post(`${c}/auth/forgot-password`,{email:t});return e.data}catch(e){throw console.error("发送重置密码邮件失败:",e),n.value=e.response?.data?.message||"发送重置密码邮件失败，请稍后再试",i.nk.error(n.value),e}finally{a.value=!1}},k=async t=>{a.value=!0,n.value=null;try{const e=await l().post(`${c}/auth/reset-password`,t);return e.data}catch(e){throw console.error("重置密码失败:",e),n.value=e.response?.data?.message||"重置密码失败，请稍后再试",i.nk.error(n.value),e}finally{a.value=!1}},m=async()=>{if(!e.value)return null;a.value=!0,n.value=null;try{const e=await l().get(`${c}/auth/me`);return t.value=e.data,console.log("已获取用户信息:",t.value),e.data}catch(s){return console.error("获取用户信息失败:",s),401===s.response?.status&&f(),n.value=s.response?.data?.message||"获取用户信息失败",null}finally{a.value=!1}},f=()=>{t.value=null,e.value="",localStorage.removeItem("token"),delete l().defaults.headers.common["Authorization"]},y=async()=>{if(e.value){l().defaults.headers.common["Authorization"]=`Bearer ${e.value}`;try{const t=await m();return!!t||(console.warn("初始化认证状态时获取用户信息失败，清除token"),f(),!1)}catch(t){return console.error("初始化认证状态失败:",t),f(),!1}}return!1},v=async t=>{try{a.value=!0,n.value=null;const e=await l().post(`${c}/auth/change-password`,t);return i.nk.success("密码修改成功！"),e}catch(e){throw n.value=e.response?.data?.message||"修改密码失败，请稍后再试",i.nk.error(n.value),e}finally{a.value=!1}},D=async e=>{try{a.value=!0,n.value=null;const s=await l().put(`${c}/auth/profile`,e);return s.data&&(void 0!==s.data.avatar?t.value=s.data:(t.value={...t.value,...s.data},e.avatar&&!s.data.avatar&&(t.value.avatar=e.avatar))),s.data}catch(s){throw n.value=s.response?.data?.message||"更新个人资料失败，请稍后再试",i.nk.error(n.value),s}finally{a.value=!1}};return{user:t,token:e,loading:a,error:n,isAuthenticated:o,userInfo:u,isAdmin:d,login:h,register:p,forgotPassword:g,resetPassword:k,fetchUserInfo:m,logout:f,initAuth:y,changePassword:v,updateProfile:D}}))},2059:function(t,e,a){a(4114);var n=a(5130),s=a(6768),r=a(4232),o=a.p+"media/bg1.380f67cf.mp4";const l={class:"user-panel"},i={class:"username"},c={key:0,class:"user-dropdown"};function u(t,e,a,n,u,d){const h=(0,s.g2)("router-view"),p=(0,s.g2)("House"),g=(0,s.g2)("el-icon"),k=(0,s.g2)("el-menu-item"),m=(0,s.g2)("List"),f=(0,s.g2)("PriceTag"),y=(0,s.g2)("ChatDotRound"),v=(0,s.g2)("ChatLineRound"),D=(0,s.g2)("Reading"),C=(0,s.g2)("Calendar"),P=(0,s.g2)("el-menu"),w=(0,s.g2)("el-avatar"),b=(0,s.g2)("CaretTop"),T=(0,s.g2)("User"),I=(0,s.g2)("Setting"),L=(0,s.g2)("SwitchButton"),M=(0,s.g2)("el-aside"),A=(0,s.g2)("el-main"),E=(0,s.g2)("el-container");return(0,s.uX)(),(0,s.CE)("div",{class:(0,r.C4)(["app-container",{"auth-page":n.isAuthRoute}])},[n.isAuthRoute?((0,s.uX)(),(0,s.Wv)(h,{key:0})):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[e[15]||(e[15]=(0,s.Lk)("div",{class:"video-background"},[(0,s.Lk)("video",{autoplay:"",muted:"",loop:"",playsinline:""},[(0,s.Lk)("source",{src:o,type:"video/mp4"})])],-1)),(0,s.bF)(E,{class:"main-container"},{default:(0,s.k6)((()=>[(0,s.bF)(M,{width:"220px",class:"sidebar"},{default:(0,s.k6)((()=>[e[14]||(e[14]=(0,s.Lk)("div",{class:"logo-container"},[(0,s.Lk)("div",{class:"logo"},[(0,s.Lk)("img",{src:"https://yamapicgo.oss-cn-nanjing.aliyuncs.com/picgoImage/icon-rmbg.png",alt:"logo",class:"logo-image"}),(0,s.Lk)("span",null,"植语心声")])],-1)),(0,s.bF)(P,{"default-active":n.activeMenu,class:"el-menu-vertical",router:""},{default:(0,s.k6)((()=>[(0,s.bF)(k,{index:"/"},{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(p)])),_:1}),e[4]||(e[4]=(0,s.Lk)("span",null,"心灵起点",-1))])),_:1}),(0,s.bF)(k,{index:"/tasks"},{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(m)])),_:1}),e[5]||(e[5]=(0,s.Lk)("span",null,"待办清单",-1))])),_:1}),(0,s.bF)(k,{index:"/garden"},{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(f)])),_:1}),e[6]||(e[6]=(0,s.Lk)("span",null,"植物花园",-1))])),_:1}),(0,s.bF)(k,{index:"/plant-voice"},{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(y)])),_:1}),e[7]||(e[7]=(0,s.Lk)("span",null,"植物心声",-1))])),_:1}),(0,s.bF)(k,{index:"/plant-chat"},{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(v)])),_:1}),e[8]||(e[8]=(0,s.Lk)("span",null,"心灵树洞",-1))])),_:1}),(0,s.bF)(k,{index:"/posts"},{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(D)])),_:1}),e[9]||(e[9]=(0,s.Lk)("span",null,"生活手札",-1))])),_:1}),(0,s.bF)(k,{index:"/calendar"},{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(C)])),_:1}),e[10]||(e[10]=(0,s.Lk)("span",null,"成长轨迹",-1))])),_:1})])),_:1},8,["default-active"]),(0,s.Lk)("div",l,[(0,s.Lk)("div",{class:"user-info",onClick:e[0]||(e[0]=t=>n.showUserMenu=!n.showUserMenu)},[(0,s.bF)(w,{size:32,src:n.userAvatar},null,8,["src"]),(0,s.Lk)("span",i,(0,r.v_)(n.username),1),(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(b,{class:(0,r.C4)({"rotate-icon":n.showUserMenu})},null,8,["class"])])),_:1})]),n.showUserMenu?((0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("div",{class:"dropdown-item",onClick:e[1]||(e[1]=(...t)=>n.goToProfile&&n.goToProfile(...t))},[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(T)])),_:1}),e[11]||(e[11]=(0,s.Lk)("span",null,"个人资料",-1))]),(0,s.Lk)("div",{class:"dropdown-item",onClick:e[2]||(e[2]=(...t)=>n.goToSettings&&n.goToSettings(...t))},[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(I)])),_:1}),e[12]||(e[12]=(0,s.Lk)("span",null,"设置",-1))]),(0,s.Lk)("div",{class:"dropdown-item logout",onClick:e[3]||(e[3]=(...t)=>n.handleLogout&&n.handleLogout(...t))},[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(L)])),_:1}),e[13]||(e[13]=(0,s.Lk)("span",null,"退出登录",-1))])])):(0,s.Q3)("",!0)])])),_:1}),(0,s.bF)(A,null,{default:(0,s.k6)((()=>[(0,s.bF)(h,null,{default:(0,s.k6)((({Component:t})=>[((0,s.uX)(),(0,s.Wv)(s.PR,null,[((0,s.uX)(),(0,s.Wv)((0,s.$y)(t)))],1024))])),_:1})])),_:1})])),_:1})],64))],2)}var d=a(144),h=a(1387),p=a(14),g=a(3271),k=a(7477),m=a(2933),f=a(788),y=a.n(f),v={name:"App",components:{Sunny:k.Sunny,House:k.House,List:k.List,PriceTag:k.PriceTag,ChatDotRound:k.ChatDotRound,ChatLineRound:k.ChatLineRound,Reading:k.Reading,Calendar:k.Calendar,CaretTop:k.CaretTop,User:k.User,Setting:k.Setting,SwitchButton:k.SwitchButton},setup(){const t=(0,h.rd)(),e=(0,h.lq)(),a=(0,p.n)(),n=(0,g.g)(),r=(0,d.KR)(!1),o=(0,s.EW)((()=>{const t=["/login","/register","/forgot-password"];return t.some((t=>e.path.startsWith(t)))||e.path.startsWith("/reset-password")})),l=(0,s.EW)((()=>e.path)),i=(0,s.EW)((()=>a.userInfo?.username||"未登录")),c=(0,s.EW)((()=>a.userInfo?.avatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png")),u=()=>{m.s.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{a.logout(),t.push("/login")})).catch((()=>{}))},k=()=>{r.value=!1,t.push("/profile")},f=()=>{r.value=!1,m.s.alert("设置功能正在开发中","提示",{confirmButtonText:"确定"})},v=t=>{const e=document.querySelector(".user-panel");e&&!e.contains(t.target)&&r.value&&(r.value=!1)};return(0,s.sV)((async()=>{document.addEventListener("click",v),console.log("App组件挂载，检查认证状态");const e=localStorage.getItem("token");if(e&&""!==e.trim()){console.log("检测到有存储的token，确保用户数据已加载"),y().defaults.headers.common["Authorization"]=`Bearer ${e}`;try{console.log("加载用户信息");const e=await a.fetchUserInfo();e?(console.log("用户信息加载成功",e),await n.fetchPlants(),console.log("植物数据加载成功")):(console.warn("获取用户信息失败，清除无效token"),a.logout(),o.value||t.push("/login"))}catch(s){console.error("初始化应用状态失败:",s),a.logout(),o.value||t.push("/login")}}else console.log("未检测到有效token"),o.value||(console.log("重定向到登录页面"),t.push("/login"))})),(0,s.xo)((()=>{document.removeEventListener("click",v)})),{isAuthRoute:o,activeMenu:l,username:i,userAvatar:c,showUserMenu:r,handleLogout:u,goToProfile:k,goToSettings:f}}},D=a(1241);const C=(0,D.A)(v,[["render",u]]);var P=C,w=a(6564),b=a(2261),T=a(9188),I=(a(4188),a(5186));y().defaults.baseURL={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||"http://localhost:3001/api";const L=(0,b.Ey)(),M=(0,n.Ef)(P);for(const[S,$]of Object.entries(k))M.component(S,$);M.use(L),M.use(w.A),M.use(T.A,{locale:I.A}),y().interceptors.response.use((t=>t),(t=>{if(t.response&&401===t.response.status){const t=(0,p.n)();t.logout(),w.A.push("/login")}return Promise.reject(t)}));const A=localStorage.getItem("token");A&&(y().defaults.headers.common["Authorization"]=`Bearer ${A}`);const E=(0,p.n)();M.mount("#app"),E.initAuth()},3271:function(t,e,a){a.d(e,{g:function(){return o}});a(4114),a(8111),a(2489),a(116);var n=a(2261),s=a(4300),r=a(1219);const o=(0,n.nY)("plant",{state:()=>({plants:[],currentPlant:null,loading:!1,thoughts:[],conversations:[],hasMoreConversations:!1,isGeneratingThought:!1}),actions:{async fetchPlants(){try{this.loading=!0;const t=await s.AK.getPlants();this.plants=t.plants;const e=this.plants.find((t=>t.isMainPlant));e?this.currentPlant=e:this.plants.length>0&&(this.currentPlant=this.plants[0])}catch(t){r.nk.error("获取植物列表失败")}finally{this.loading=!1}},async fetchPlantDetail(t){try{if(!t)return console.error("植物ID无效"),r.nk.warning("植物ID无效，无法获取植物详情"),null;const e="object"===typeof t?t._id:t;console.log("准备获取植物详情，使用ID:",e),this.loading=!0;const a=await s.AK.getPlant(e),n=this.plants.findIndex((t=>t.id===e||t._id===e));return-1!==n&&(this.plants[n]=a.plant),!this.currentPlant||this.currentPlant.id!==e&&this.currentPlant._id!==e||(this.currentPlant=a.plant),a.plant}catch(e){return console.error("获取植物详情失败:",e),r.nk.error("获取植物详情失败"),null}finally{this.loading=!1}},async createPlant(t){try{this.loading=!0;const e=await s.AK.createPlant(t);return this.plants.push(e.plant),e.plant.isMainPlant&&(this.currentPlant=e.plant),r.nk.success("创建植物成功"),e.plant}catch(e){return r.nk.error("创建植物失败"),null}finally{this.loading=!1}},async updatePlant(t,e){try{if(!t)return console.error("植物ID无效"),r.nk.warning("植物ID无效，无法更新植物信息"),null;const a="object"===typeof t?t._id:t;console.log("准备更新植物信息，使用ID:",a),this.loading=!0;const n=await s.AK.updatePlant(a,e);if(!n||!n.plant)throw new Error("更新植物信息失败：服务器响应无效");const o=n.plant,l=this.plants.findIndex((t=>t.id===a||t._id===a));return-1!==l&&(this.plants[l]={...this.plants[l],...o,id:this.plants[l].id,_id:this.plants[l]._id}),!this.currentPlant||this.currentPlant.id!==a&&this.currentPlant._id!==a||(this.currentPlant={...this.currentPlant,...o,id:this.currentPlant.id,_id:this.currentPlant._id}),o}catch(a){throw console.error("更新植物信息失败:",a),a}finally{this.loading=!1}},async deletePlant(t){try{this.loading=!0;const e=await s.AK.deletePlant(t);return this.plants=this.plants.filter((e=>e.id!==t)),this.currentPlant&&this.currentPlant.id===t&&(this.currentPlant=this.plants.find((t=>t.isMainPlant))||this.plants[0]||null),r.nk.success(e.message||"删除植物成功"),!0}catch(e){return r.nk.error(e.response?.data?.message||"删除植物失败"),!1}finally{this.loading=!1}},async gainExperience(t,e){try{const a=await s.AK.increaseExperience(t,e),n=a.plant,o=this.plants.findIndex((e=>e.id===t));return-1!==o&&(this.plants[o].level=n.level,this.plants[o].experience=n.experience,this.plants[o].state=n.state,this.plants[o].growthStage=n.growthStage),this.currentPlant&&this.currentPlant.id===t&&(this.currentPlant.level=n.level,this.currentPlant.experience=n.experience,this.currentPlant.state=n.state,this.currentPlant.growthStage=n.growthStage),a.levelUp&&r.nk.success(`植物升级了！现在等级为 ${n.level}`),a.stageChange&&r.nk.success(`植物进入了新的生长阶段: ${this.getGrowthStageName(n.growthStage)}`),a}catch(a){return r.nk.error("增加植物经验失败"),null}},async updateGrowthStage(t,e){try{if(!t)return console.error("植物ID无效"),r.nk.warning("植物ID无效，无法更新生长阶段"),null;const a="object"===typeof t?t._id:t;console.log("准备更新植物生长阶段，使用ID:",a);const n=await s.AK.updateGrowthStage(a,e),o=n.plant,l=this.plants.findIndex((t=>t.id===a||t._id===a));return-1!==l&&(this.plants[l].state=o.state,this.plants[l].growthStage=o.growthStage),!this.currentPlant||this.currentPlant.id!==a&&this.currentPlant._id!==a||(this.currentPlant.state=o.state,this.currentPlant.growthStage=o.growthStage),r.nk.success(n.message||`植物生长阶段已更新为 ${this.getGrowthStageName(e)}`),n.plant}catch(a){return console.error("更新植物生长阶段失败:",a),r.nk.error("更新植物生长阶段失败"),null}},getGrowthStageName(t){const e={1:"幼苗期",2:"成长期",3:"成熟期"};return e[t]||"未知阶段"},async fetchPlantThoughts(t){try{if(!t)return console.error("植物ID无效"),r.nk.warning("植物ID无效，无法获取植物心声"),[];const e="object"===typeof t?t._id:t;console.log("准备获取植物心声，使用ID:",e),this.loading=!0;const a=await s.AK.getPlantThoughts(e);return this.thoughts=a.thoughts,a.thoughts}catch(e){return console.error("获取植物心声失败:",e),r.nk.error("获取植物心声失败"),[]}finally{this.loading=!1}},async generatePlantThought(t,e){try{if(this.isGeneratingThought)return console.log("正在生成植物心声，跳过重复调用"),null;if(!t)return console.error("植物ID无效"),r.nk.warning("植物ID无效，无法生成植物心声"),null;const a="object"===typeof t?t._id:t;console.log("准备生成植物心声，使用ID:",a),console.log("当前植物信息:",this.currentPlant);const n=this.currentPlant;if(!n)throw new Error("当前植物信息不存在");this.isGeneratingThought=!0,console.log("调用后端API生成心声，参数:",{plantId:a,context:e});const o=await s.AK.generatePlantThought(a,e);console.log("后端API响应:",o);const l={id:Date.now().toString(),content:o.thought.content,timestamp:(new Date).toISOString(),mood:e.mood,weather:e.weather,icon:o.thought.icon,tag:o.thought.tag};return console.log("生成的心声对象:",l),this.thoughts.unshift(l),l}catch(a){return console.error("生成植物心声失败:",a),r.nk.error("生成植物心声失败"),null}finally{this.isGeneratingThought=!1}},async fetchConversations(t,e=20,a=null){try{if(!t)return console.error("植物ID无效"),r.nk.warning("植物ID无效，无法获取对话历史"),[];const n="object"===typeof t?t._id:t;console.log("准备获取对话历史，使用ID:",n),this.loading=!0;const o=await s.AK.getConversations(n,e,a);return this.conversations=a?[...this.conversations,...o.messages]:o.messages,this.hasMoreConversations=o.hasMore,o.messages}catch(n){return console.error("获取对话历史失败:",n),r.nk.error("获取对话历史失败"),[]}finally{this.loading=!1}},async sendMessage(t,e,a=!1){try{if(!t)return console.error("植物ID无效"),r.nk.warning("植物ID无效，无法发送消息"),null;const n="object"===typeof t?t._id:t;if(console.log("准备发送消息，使用ID:",n),!a){const t={id:Date.now().toString(),sender:"user",content:e,timestamp:(new Date).toISOString()};this.conversations.push(t)}const o=await s.AK.sendMessage(n,e,{});return this.conversations.push(o.response),o.response}catch(n){return console.error("发送消息失败:",n),r.nk.error("发送消息失败"),null}},async clearConversations(t){try{if(!t)return console.error("植物ID无效"),r.nk.warning("植物ID无效，无法清空对话"),!1;const e="object"===typeof t?t._id:t;return console.log("准备清空对话，使用ID:",e),await s.AK.clearConversations(e),this.conversations=[],!0}catch(e){return console.error("清空对话失败:",e),r.nk.error("清空对话失败"),!1}},setCurrentPlant(t){this.currentPlant=t}},getters:{mainPlant:t=>t.plants.find((t=>t.isMainPlant))||(t.plants.length>0?t.plants[0]:null),currentLevel:t=>t.currentPlant?.level||1,experienceToNextLevel:t=>{if(!t.currentPlant)return 100;const e=t.currentPlant.experience||0,a=t.currentPlant.level||1;return 100*a-e},experiencePercentage:t=>{if(!t.currentPlant)return 0;const e=t.currentPlant.experience||0,a=t.currentPlant.level||1;return Math.min(100,e/(100*a)*100)},getPlantAvatar:t=>t=>{if(!t)return"";const e=t.state||"seedling",a=t.weather||"sunny",n=t.mood||"neutral";return`/images/plant/${e}_${a}_${n}.png`},recentThoughts:t=>t.thoughts.slice(0,5)}})},4300:function(t,e,a){a.d(e,{AK:function(){return o},WY:function(){return l},d_:function(){return i}});var n=a(788),s=a.n(n);const r=s().create({baseURL:{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||"http://localhost:3001/api",timeout:30010,headers:{"Content-Type":"application/json"}});r.interceptors.request.use((t=>{const e=localStorage.getItem("token");return e&&(t.headers["Authorization"]=`Bearer ${e}`),t}),(t=>Promise.reject(t))),r.interceptors.response.use((t=>t.data),(t=>(console.error("API错误:",t.response?.data||t.message),Promise.reject(t))));const o={getPlants(){return r.get("/plants")},getPlant(t){return t?(console.log("API请求: 获取植物详情, ID:",t),r.get(`/plants/${t}`)):(console.error("API调用错误: 无法获取植物详情，ID无效",t),Promise.reject(new Error("无效的植物ID")))},createPlant(t){return r.post("/plants",t)},updatePlant(t,e){return t?(console.log("API请求: 更新植物信息, ID:",t),r.put(`/plants/${t}`,e)):(console.error("API调用错误: 无法更新植物，ID无效",t),Promise.reject(new Error("无效的植物ID")))},deletePlant(t){return t?(console.log("API请求: 删除植物, ID:",t),r.delete(`/plants/${t}`)):(console.error("API调用错误: 无法删除植物，ID无效",t),Promise.reject(new Error("无效的植物ID")))},increaseExperience(t,e){return t?(console.log("API请求: 增加植物经验, ID:",t),r.put(`/plants/${t}/experience`,{amount:e})):(console.error("API调用错误: 无法增加植物经验，ID无效",t),Promise.reject(new Error("无效的植物ID")))},updateGrowthStage(t,e){return t?(console.log("API请求: 更新植物生长阶段, ID:",t),r.put(`/plants/${t}/growth-stage`,{stage:e})):(console.error("API调用错误: 无法更新植物生长阶段，ID无效",t),Promise.reject(new Error("无效的植物ID")))},getPlantThoughts(t){return t?r.get(`/plants/${t}/thoughts`):(console.error("API调用错误: 无法获取植物心声，ID无效",t),Promise.reject(new Error("无效的植物ID")))},generatePlantThought(t,e={}){return t?(console.log("API请求: 生成植物心声, ID:",t),r.post(`/plants/${t}/thoughts`,{context:e})):(console.error("API调用错误: 无法生成植物心声，ID无效",t),Promise.reject(new Error("无效的植物ID")))},getConversations(t,e=20,a=null){if(!t)return console.error("API调用错误: 无法获取对话历史，ID无效",t),Promise.reject(new Error("无效的植物ID"));console.log("API请求: 获取对话历史, ID:",t);const n={};return e&&(n.limit=e),a&&(n.before=a),r.get(`/plants/${t}/conversations`,{params:n})},sendMessage(t,e,a={}){return t?(console.log("API请求: 发送消息给植物, ID:",t),r.post(`/plants/${t}/conversations`,{message:e,context:a})):(console.error("API调用错误: 无法发送消息，ID无效",t),Promise.reject(new Error("无效的植物ID")))},clearConversations(t){return t?(console.log("API请求: 清空与植物的对话, ID:",t),r.delete(`/plants/${t}/conversations`)):(console.error("API调用错误: 无法清空对话，ID无效",t),Promise.reject(new Error("无效的植物ID")))}},l={getTasks(){return r.get("/tasks")},getSystemTasks(){return r.get("/tasks/system")},completeSystemTask(t){return r.put(`/tasks/system/${t}/complete`)},createTask(t){return r.post("/tasks",t)},deleteTask(t){return r.delete(`/tasks/${t}`)},updateTask(t,e){return r.put(`/tasks/${t}`,e)},completeTask(t){return r.put(`/tasks/${t}/complete`)}},i={getPosts(t="all"){const e={};return t&&"all"!==t&&(e.type=t),r.get("/posts",{params:e})},createPost(t){return r.post("/posts",t)},updatePost(t,e){return r.put(`/posts/${t}`,e)},deletePost(t){return r.delete(`/posts/${t}`)}};e.Ay=r},6564:function(t,e,a){a.d(e,{A:function(){return vt}});a(8111),a(3579);var n=a(1387),s=a(6768),r=a(4232);const o={class:"calendar-container"},l={class:"calendar-header"},i={class:"calendar-nav"},c={class:"current-month"},u={class:"view-toggle"},d={key:0,class:"calendar-view"},h={class:"custom-calendar"},p={class:"calendar-weekdays"},g={class:"calendar-days"},k=["onClick"],m={class:"day-number"},f={key:0,class:"task-dots"},y={class:"day-indicators"},v={key:0,class:"task-indicator pending"},D={key:1,class:"task-indicator completed"},C={key:2,class:"post-indicator"},P={key:0,class:"day-detail"},w={key:0},b={key:0,class:"day-tasks pending-tasks-section"},T={class:"task-content"},I={key:0,class:"task-icon"},L={key:1,class:"task-icon"},M={class:"task-title"},A={class:"task-time-container"},E={key:0,class:"task-time task-deadline"},S={key:0},$={key:1},_={key:1,class:"day-tasks completed-tasks-section"},x={class:"task-content"},F={key:0,class:"task-icon"},X={key:1,class:"task-icon"},j={class:"task-title"},B={class:"task-time-container"},R={key:0,class:"task-time task-deadline"},O={key:1,class:"task-time task-completed"},K={key:2,class:"day-tasks"},U={class:"task-content"},q={class:"task-title"},N={key:0,class:"task-time"},W={key:3,class:"day-posts"},V={class:"post-type"},Q={class:"post-title"},z={class:"post-time"},G={key:4,class:"day-thoughts"},Y={class:"plant-thought"},H={class:"thought-icon"},Z={class:"thought-content"},J={key:5,class:"empty-day"},tt={key:1,class:"loading"},et={key:1,class:"chart-view"},at={class:"statistics-container"},nt={class:"stat-box"},st={ref:"taskPieChart",class:"chart-item"},rt={class:"stat-box"},ot={ref:"weekdayBarChart",class:"chart-item"},lt={class:"stat-box"},it={ref:"postsPieChart",class:"chart-item"};function ct(t,e,a,n,ct,ut){return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",l,[e[6]||(e[6]=(0,s.Lk)("h1",null,"日历",-1)),(0,s.Lk)("div",i,[(0,s.Lk)("button",{onClick:e[0]||(e[0]=(...t)=>ut.prevMonth&&ut.prevMonth(...t)),class:"nav-btn"},e[4]||(e[4]=[(0,s.Lk)("i",{class:"fas fa-chevron-left"},null,-1)])),(0,s.Lk)("span",c,(0,r.v_)(ct.currentYear)+"年"+(0,r.v_)(ct.currentMonth+1)+"月",1),(0,s.Lk)("button",{onClick:e[1]||(e[1]=(...t)=>ut.nextMonth&&ut.nextMonth(...t)),class:"nav-btn"},e[5]||(e[5]=[(0,s.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]))]),(0,s.Lk)("div",u,[(0,s.Lk)("button",{onClick:e[2]||(e[2]=t=>ut.toggleView("calendar")),class:(0,r.C4)({active:"calendar"===ct.currentView})},"日历视图",2),(0,s.Lk)("button",{onClick:e[3]||(e[3]=t=>ut.toggleView("chart")),class:(0,r.C4)({active:"chart"===ct.currentView})},"数据视图",2)])]),"calendar"===ct.currentView?((0,s.uX)(),(0,s.CE)("div",d,[(0,s.Lk)("div",h,[(0,s.Lk)("div",p,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["一","二","三","四","五","六","日"],(t=>(0,s.Lk)("div",{class:"weekday",key:t},"周"+(0,r.v_)(t),1))),64))]),(0,s.Lk)("div",g,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ct.calendarDays,((t,e)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:(0,r.C4)(["calendar-day",{empty:!t.date,selected:ct.selectedDate===t.date,"has-pending-tasks":t.taskCount&&t.taskCount.pending>0,"has-completed-tasks":t.taskCount&&t.taskCount.completed>0,today:t.date===ut.getCurrentDate()}]),onClick:e=>t.date&&ut.selectDate(t.date)},[t.date?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("div",m,(0,r.v_)(ut.getDayNumber(t.date)),1),t.taskCount&&(t.taskCount.pending>0||t.taskCount.completed>0)?((0,s.uX)(),(0,s.CE)("div",f,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Math.min(t.taskCount.pending,3),(e=>((0,s.uX)(),(0,s.CE)("span",{key:`pending-${e}`,class:(0,r.C4)(["task-dot pending",{important:ut.hasImportantPendingTask(t)}])},null,2)))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Math.min(t.taskCount.completed,3),(t=>((0,s.uX)(),(0,s.CE)("span",{key:`completed-${t}`,class:"task-dot completed"})))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",y,[t.taskCount&&t.taskCount.pending>0?((0,s.uX)(),(0,s.CE)("span",v,(0,r.v_)(t.taskCount.pending)+"待办 ",1)):(0,s.Q3)("",!0),t.taskCount&&t.taskCount.completed>0?((0,s.uX)(),(0,s.CE)("span",D,(0,r.v_)(t.taskCount.completed)+"已完成 ",1)):(0,s.Q3)("",!0),t.posts&&t.posts.length>0?((0,s.uX)(),(0,s.CE)("span",C,(0,r.v_)(t.posts.length)+"条记录 ",1)):(0,s.Q3)("",!0)])],64)):(0,s.Q3)("",!0)],10,k)))),128))])]),ct.selectedDate?((0,s.uX)(),(0,s.CE)("div",P,[(0,s.Lk)("h2",null,(0,r.v_)(ut.formatSelectedDate),1),ct.dayData?((0,s.uX)(),(0,s.CE)("div",w,[ct.pendingTasks.length>0?((0,s.uX)(),(0,s.CE)("div",b,[(0,s.Lk)("h3",null,"待完成任务 ("+(0,r.v_)(ct.pendingTasks.length)+")",1),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ct.pendingTasks,(t=>((0,s.uX)(),(0,s.CE)("li",{key:t.id,class:(0,r.C4)([{important:t.important},"pending-task"])},[(0,s.Lk)("div",T,[t.important?((0,s.uX)(),(0,s.CE)("span",I,"⭐")):((0,s.uX)(),(0,s.CE)("span",L,"📌")),(0,s.Lk)("span",M,(0,r.v_)(t.title),1)]),(0,s.Lk)("div",A,[t.deadline?((0,s.uX)(),(0,s.CE)("span",E,[ut.isOverdue(t.deadline)?((0,s.uX)(),(0,s.CE)("span",S,"已截止: ")):((0,s.uX)(),(0,s.CE)("span",$,"截止: ")),(0,s.eW)(" "+(0,r.v_)(ut.formatFullDateTime(t.deadline)),1)])):(0,s.Q3)("",!0)])],2)))),128))])])):(0,s.Q3)("",!0),ct.completedTasks.length>0?((0,s.uX)(),(0,s.CE)("div",_,[(0,s.Lk)("h3",null,"已完成任务 ("+(0,r.v_)(ct.completedTasks.length)+")",1),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ct.completedTasks,(t=>((0,s.uX)(),(0,s.CE)("li",{key:t.id,class:(0,r.C4)([{important:t.important},"completed-task"])},[(0,s.Lk)("div",x,[t.important?((0,s.uX)(),(0,s.CE)("span",F,"⭐")):((0,s.uX)(),(0,s.CE)("span",X,"✅")),(0,s.Lk)("span",j,(0,r.v_)(t.title),1)]),(0,s.Lk)("div",B,[t.deadline?((0,s.uX)(),(0,s.CE)("span",R,"截止: "+(0,r.v_)(ut.formatFullDateTime(t.deadline)),1)):(0,s.Q3)("",!0),t.completedAt?((0,s.uX)(),(0,s.CE)("span",O,"完成: "+(0,r.v_)(ut.formatFullDateTime(t.completedAt)),1)):(0,s.Q3)("",!0)])],2)))),128))])])):(0,s.Q3)("",!0),ct.dayData.systemTasks&&ct.dayData.systemTasks.length>0?((0,s.uX)(),(0,s.CE)("div",K,[(0,s.Lk)("h3",null,"系统任务 ("+(0,r.v_)(ct.dayData.systemTasks.length)+")",1),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ct.dayData.systemTasks,(t=>((0,s.uX)(),(0,s.CE)("li",{key:t.id,class:"system-task"},[(0,s.Lk)("div",U,[e[7]||(e[7]=(0,s.Lk)("span",{class:"task-icon"},"🔄",-1)),(0,s.Lk)("span",q,(0,r.v_)(t.title),1)]),t.completedAt?((0,s.uX)(),(0,s.CE)("span",N,"完成: "+(0,r.v_)(ut.formatFullDateTime(t.completedAt)),1)):(0,s.Q3)("",!0)])))),128))])])):(0,s.Q3)("",!0),ct.dayData.posts&&ct.dayData.posts.length>0?((0,s.uX)(),(0,s.CE)("div",W,[(0,s.Lk)("h3",null,"说说 & 日记 ("+(0,r.v_)(ct.dayData.posts.length)+")",1),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ct.dayData.posts,(t=>((0,s.uX)(),(0,s.CE)("li",{key:t.id,class:(0,r.C4)({"diary-post":"diary"===t.type,"thought-post":"diary"!==t.type})},[(0,s.Lk)("span",V,(0,r.v_)("diary"===t.type?"📝":"💬"),1),(0,s.Lk)("span",Q,(0,r.v_)(t.title||"无标题"),1),(0,s.Lk)("span",z,(0,r.v_)(ut.formatTime(t.createdAt)),1)],2)))),128))])])):(0,s.Q3)("",!0),ct.dayData.plantThoughts&&ct.dayData.plantThoughts.length>0?((0,s.uX)(),(0,s.CE)("div",G,[e[8]||(e[8]=(0,s.Lk)("h3",null,"植物心声",-1)),(0,s.Lk)("ul",null,[(0,s.Lk)("li",Y,[(0,s.Lk)("span",H,(0,r.v_)(ct.randomPlantThought.icon),1),(0,s.Lk)("span",Z,(0,r.v_)(ct.randomPlantThought.content),1)])])])):(0,s.Q3)("",!0),ct.dayData.tasks&&0!==ct.dayData.tasks.length||ct.dayData.systemTasks&&0!==ct.dayData.systemTasks.length||ct.dayData.posts&&0!==ct.dayData.posts.length||ct.dayData.plantThoughts&&0!==ct.dayData.plantThoughts.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",J,e[9]||(e[9]=[(0,s.Lk)("p",null,"今天没有任何任务或记录",-1)])))])):((0,s.uX)(),(0,s.CE)("div",tt," 加载中... "))])):(0,s.Q3)("",!0)])):"chart"===ct.currentView?((0,s.uX)(),(0,s.CE)("div",et,[(0,s.Lk)("div",at,[(0,s.Lk)("div",nt,[e[10]||(e[10]=(0,s.Lk)("h3",null,"任务完成情况",-1)),(0,s.Lk)("div",st,null,512)]),(0,s.Lk)("div",rt,[e[11]||(e[11]=(0,s.Lk)("h3",null,"每周任务分布",-1)),(0,s.Lk)("div",ot,null,512)]),(0,s.Lk)("div",lt,[e[12]||(e[12]=(0,s.Lk)("h3",null,"说说/日记分布",-1)),(0,s.Lk)("div",it,null,512)])])])):(0,s.Q3)("",!0)])}a(4114),a(2489),a(116),a(7588),a(1701);var ut=a(9671),dt=a(788),ht=a.n(dt),pt={name:"CalendarView",data(){return{currentYear:(new Date).getFullYear(),currentMonth:(new Date).getMonth(),currentView:"calendar",calendarData:null,statistics:null,selectedDate:null,dayData:null,taskPieChart:null,weekdayBarChart:null,postsPieChart:null,loading:!1,useMockData:!1,calendarDays:[],randomPlantThought:null,pendingTasks:[],completedTasks:[]}},computed:{formatSelectedDate(){if(!this.selectedDate)return"";const t=new Date(this.selectedDate),e=["日","一","二","三","四","五","六"][t.getDay()];return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日 星期${e}`}},mounted(){this.fetchCalendarData()},methods:{getCurrentDate(){const t=new Date;return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},async fetchCalendarData(){this.loading=!0;try{if(this.useMockData)this.calendarData=this.getMockMonthlyData(),this.statistics=this.getMockStatistics();else{const t=await ht().get("/calendar/monthly",{params:{year:this.currentYear,month:this.currentMonth+1},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=t.data;e&&e.days&&this.processTasksForCalendar(e.days),this.calendarData=e;const a=await ht().get("/calendar/statistics",{params:{year:this.currentYear,month:this.currentMonth+1},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});this.statistics=a.data}this.generateCalendarDays(),this.$nextTick((()=>{"chart"===this.currentView&&this.initStatisticsCharts();const t=this.getCurrentDate(),e=this.calendarDays.find((e=>e.date===t));if(e)this.selectDate(t);else{const t=this.calendarDays.find((t=>t.date));t&&t.date&&this.selectDate(t.date)}}))}catch(t){console.error("获取日历数据失败",t)}finally{this.loading=!1}},processTasksForCalendar(t){const e={};t.forEach((t=>{e[t.date]=t,t.tasks||(t.tasks=[])}));const a=[];t.forEach((t=>{t.tasks&&t.tasks.length>0&&(t.tasks.forEach((t=>{a.push({...t})})),t.tasks=[])})),a.forEach((t=>{const a=t.deadline?this.extractDate(t.deadline):null,n=t.completedAt?this.extractDate(t.completedAt):null;!t.completed&&a&&e[a]?e[a].tasks.push(t):t.completed&&n&&e[n]&&e[n].tasks.push(t)})),t.forEach((t=>{t.taskCount||(t.taskCount={total:0,completed:0,pending:0});const e=t.tasks.filter((t=>!t.completed)),a=t.tasks.filter((t=>t.completed));t.taskCount.total=t.tasks.length,t.taskCount.completed=a.length,t.taskCount.pending=e.length}))},extractDate(t){return t.split("T")[0]},generateCalendarDays(){if(this.calendarDays=[],!this.calendarData||!this.calendarData.days)return;const t=this.currentYear,e=this.currentMonth,a=new Date(t,e,1).getDay(),n=0===a?7:a,s=new Date(t,e+1,0).getDate();for(let o=1;o<n;o++)this.calendarDays.push({date:null});for(let o=1;o<=s;o++){const a=`${t}-${(e+1).toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}`,n=this.calendarData.days.find((t=>t.date===a))||{date:a};this.calendarDays.push(n)}const r=7-this.calendarDays.length%7;if(r<7)for(let o=0;o<r;o++)this.calendarDays.push({date:null})},getDayNumber(t){return parseInt(t.split("-")[2])},selectDate(t){this.selectedDate=t,this.fetchDayData(t)},async fetchDayData(t){try{if(this.useMockData)this.dayData=this.getMockDayData(t);else{const e=await ht().get("/calendar/day",{params:{date:t},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});this.dayData=e.data,this.processDayTasks(t)}if(this.dayData&&this.dayData.plantThoughts&&this.dayData.plantThoughts.length>0){const t=Math.floor(Math.random()*this.dayData.plantThoughts.length);this.randomPlantThought=this.dayData.plantThoughts[t]}else this.randomPlantThought=null}catch(e){console.error("获取日期详情失败",e),this.dayData=null,this.randomPlantThought=null,this.pendingTasks=[],this.completedTasks=[]}},processDayTasks(t){if(this.dayData||(this.dayData={tasks:[]}),!this.calendarData||!this.calendarData.days)return;const e=[];this.calendarData.days.forEach((t=>{t.tasks&&t.tasks.length>0&&t.tasks.forEach((t=>{e.push({...t})}))}));const a=[];e.forEach((e=>{const n=e.deadline?this.extractDate(e.deadline):null,s=e.completedAt?this.extractDate(e.completedAt):null;e.completed||n!==t||a.push(e),e.completed&&s===t&&a.push(e)})),this.dayData.tasks=a,this.pendingTasks=a.filter((t=>!t.completed)),this.completedTasks=a.filter((t=>t.completed)),console.log(`处理日期 ${t} 的任务:`,{"总任务":a.length,"待办":this.pendingTasks.length,"已完成":this.completedTasks.length})},getMockMonthlyData(){const t=[],e=this.currentYear,a=this.currentMonth+1,n=new Date(e,a,0).getDate();for(let r=1;r<=n;r++){const n=`${e}-${a.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`;t.push({date:n,taskCount:{total:0,completed:0,pending:0},tasks:[],posts:[]})}const s=20;for(let r=0;r<s;r++){const s=Math.floor(Math.random()*n)+1,o=`${e}-${a.toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}`,l=Math.random()>.5;let i=null;if(l){const t=Math.max(1,Math.min(n,s+Math.floor(5*Math.random())-2));i=`${e}-${a.toString().padStart(2,"0")}-${t.toString().padStart(2,"0")}`}const c={id:`task-${r}`,title:`任务 ${r+1}`,description:`这是任务 ${r+1} 的描述`,deadline:`${o}T${Math.floor(10+8*Math.random())}:00:00Z`,completed:l,important:Math.random()>.7};l&&(c.completedAt=`${i}T${Math.floor(10+8*Math.random())}:${Math.floor(60*Math.random())}:00Z`);const u=l?i:o,d=t.find((t=>t.date===u));d&&d.tasks.push(c)}return t.forEach((t=>{const e=Math.floor(2*Math.random());for(let r=0;r<e;r++){const e=0===r;t.posts.push({id:`post-${t.date}-${r}`,title:e?`${a}月${t.date.split("-")[2]}日记录`:`${a}月${t.date.split("-")[2]}日随想`,type:e?"diary":"thought",mood:["happy","excited","calm","sad"][Math.floor(4*Math.random())],createdAt:`${t.date}T${Math.floor(10+12*Math.random())}:${Math.floor(60*Math.random())}:00Z`})}const n=t.tasks.filter((t=>!t.completed)),s=t.tasks.filter((t=>t.completed));t.taskCount.total=t.tasks.length,t.taskCount.completed=s.length,t.taskCount.pending=n.length})),{success:!0,year:e,month:a,days:t}},getMockDayData(t){const e=this.calendarData.days.find((e=>e.date===t));if(!e)return null;const a=[];Math.random()>.3&&a.push({id:`sys-task-${t}-1`,title:"每日植物浇水",completed:Math.random()>.3,completedAt:Math.random()>.3?`${t}T08:30:00Z`:null});const n=[];if(Math.random()>.4){const e=["看到你今天完成了任务，真为你高兴！继续保持！","今天阳光真好，我感觉自己又长高了一点~","主人今天看起来心情不错呢，我也跟着开心！","记得定期给我浇水哦，我会为你加油的！","今天完成了这么多任务，你真棒！休息一下吧~"];n.push({id:`thought-${t}-1`,content:e[Math.floor(Math.random()*e.length)],icon:["🌱","🌷","🌻","🌿"][Math.floor(4*Math.random())],timestamp:`${t}T${Math.floor(12+8*Math.random())}:30:00Z`})}const s=new Date(t),r=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][s.getDay()],o={success:!0,date:t,dayOfWeek:r,tasks:e.tasks||[],systemTasks:a,posts:e.posts||[],plantThoughts:n,statistics:{completionRate:e.taskCount?.total>0?e.taskCount.completed/e.taskCount.total*100:100,totalTasks:e.taskCount?.total||0,completedTasks:e.taskCount?.completed||0}};if(o.plantThoughts&&o.plantThoughts.length>0){const t=Math.floor(Math.random()*o.plantThoughts.length);this.randomPlantThought=o.plantThoughts[t]}else this.randomPlantThought=null;return this.pendingTasks=o.tasks.filter((t=>!t.completed)),this.completedTasks=o.tasks.filter((t=>t.completed)),o},getMockStatistics(){let t=0,e=0,a=0,n=0,s=0;this.calendarData.days.forEach((r=>{t+=r.taskCount.total,e+=r.taskCount.completed,r.posts.forEach((t=>{a++,"diary"===t.type?n++:s++}))}));const r={monday:Math.floor(10*Math.random())+5,tuesday:Math.floor(10*Math.random())+5,wednesday:Math.floor(10*Math.random())+8,thursday:Math.floor(10*Math.random())+5,friday:Math.floor(10*Math.random())+5,saturday:Math.floor(5*Math.random())+1,sunday:Math.floor(5*Math.random())+1};return{success:!0,period:{year:this.currentYear,month:this.currentMonth+1},statistics:{totalTasks:t,completedTasks:e,completionRate:t>0?e/t*100:0,totalPosts:a,postsByType:{diary:n,thought:s},busyDays:this.calendarData.days.filter((t=>t.taskCount.total>2)).map((t=>t.date)).slice(0,3),freeDays:this.calendarData.days.filter((t=>0===t.taskCount.total)).map((t=>t.date)).slice(0,3)},taskDistribution:{byWeekday:r,byImportance:{important:Math.floor(.4*t),normal:t-Math.floor(.4*t)}}}},initStatisticsCharts(){if(!this.statistics)return;this.taskPieChart&&this.taskPieChart.dispose(),this.taskPieChart=ut.Ts(this.$refs.taskPieChart);const t=this.statistics.statistics;this.taskPieChart.setOption({tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:0},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:t.completedTasks,name:"已完成"},{value:t.totalTasks-t.completedTasks,name:"未完成"}]}]}),this.weekdayBarChart&&this.weekdayBarChart.dispose(),this.weekdayBarChart=ut.Ts(this.$refs.weekdayBarChart);const e=this.statistics.taskDistribution.byWeekday;this.weekdayBarChart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"]},yAxis:{type:"value"},series:[{data:[e.monday,e.tuesday,e.wednesday,e.thursday,e.friday,e.saturday,e.sunday],type:"bar",itemStyle:{color:function(t){const e=["#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4"];return e[t.dataIndex]}}}]}),this.postsPieChart&&this.postsPieChart.dispose(),this.postsPieChart=ut.Ts(this.$refs.postsPieChart);const a=t.postsByType;this.postsPieChart.setOption({tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:0},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:a.diary,name:"日记"},{value:a.thought,name:"说说"}]}]})},prevMonth(){0===this.currentMonth?(this.currentYear--,this.currentMonth=11):this.currentMonth--,this.selectedDate=null,this.dayData=null,this.fetchCalendarData()},nextMonth(){11===this.currentMonth?(this.currentYear++,this.currentMonth=0):this.currentMonth++,this.selectedDate=null,this.dayData=null,this.fetchCalendarData()},toggleView(t){this.currentView=t,"chart"===t&&this.$nextTick((()=>{this.initStatisticsCharts()}))},formatTime(t){const e=new Date(t);return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},getLastDayOfMonth(t,e){const a=new Date(t,e+1,0).getDate();return`${t}-${(e+1).toString().padStart(2,"0")}-${a.toString().padStart(2,"0")}`},isOverdue(t){const e=new Date,a=new Date(t);return a<e},hasImportantPendingTask(t){return!(!t||!t.tasks)&&t.tasks.some((t=>!t.completed&&t.important))},formatFullDateTime(t){const e=new Date(t);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}},beforeDestroy(){this.taskPieChart&&this.taskPieChart.dispose(),this.weekdayBarChart&&this.weekdayBarChart.dispose(),this.postsPieChart&&this.postsPieChart.dispose()}},gt=a(1241);const kt=(0,gt.A)(pt,[["render",ct],["__scopeId","data-v-0c08404c"]]);var mt=kt;const ft=[{path:"/",name:"Home",component:()=>Promise.all([a.e(796),a.e(666),a.e(536)]).then(a.bind(a,4329)),meta:{requiresAuth:!0}},{path:"/plant-voice",name:"PlantVoice",component:()=>Promise.all([a.e(796),a.e(384)]).then(a.bind(a,9384)),meta:{requiresAuth:!0}},{path:"/posts",name:"Posts",component:()=>Promise.all([a.e(796),a.e(491)]).then(a.bind(a,3491)),meta:{requiresAuth:!0}},{path:"/garden",name:"Garden",component:()=>Promise.all([a.e(666),a.e(851)]).then(a.bind(a,3174)),meta:{requiresAuth:!0}},{path:"/plant-chat",name:"PlantChat",component:()=>Promise.all([a.e(796),a.e(51)]).then(a.bind(a,51)),meta:{title:"植物聊天",requiresAuth:!0}},{path:"/calendar",name:"Calendar",component:mt,meta:{requiresAuth:!0}},{path:"/tasks",name:"Tasks",component:()=>Promise.all([a.e(796),a.e(335)]).then(a.bind(a,5335)),meta:{title:"任务管理",requiresAuth:!0}},{path:"/login",name:"Login",component:()=>a.e(921).then(a.bind(a,2921)),meta:{title:"用户登录",requiresGuest:!0}},{path:"/register",name:"Register",component:()=>a.e(877).then(a.bind(a,4877)),meta:{title:"用户注册",requiresGuest:!0}},{path:"/forgot-password",name:"ForgotPassword",component:()=>a.e(338).then(a.bind(a,9338)),meta:{title:"忘记密码",requiresGuest:!0}},{path:"/reset-password/:token",name:"ResetPassword",component:()=>a.e(147).then(a.bind(a,5147)),meta:{title:"重置密码",requiresGuest:!0}},{path:"/profile",name:"Profile",component:()=>a.e(743).then(a.bind(a,4743)),meta:{title:"个人资料",requiresAuth:!0}}],yt=(0,n.aE)({history:(0,n.LA)("/"),routes:ft});yt.beforeEach(((t,e,a)=>{const n=localStorage.getItem("token"),s=!!n&&""!==n.trim();console.log("路由守卫：",{path:t.path,requiresAuth:t.matched.some((t=>t.meta.requiresAuth)),isAuthenticated:s,token:n?"存在":"不存在"}),t.matched.some((t=>t.meta.requiresAuth))&&!s?(console.log("需要认证，但未登录，重定向到登录页"),a({name:"Login",query:{redirect:t.fullPath}})):t.matched.some((t=>t.meta.requiresGuest))&&s?(console.log("已登录，重定向到首页"),a({name:"Home"})):a()}));var vt=yt}},e={};function a(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,a),r.exports}a.m=t,function(){var t=[];a.O=function(e,n,s,r){if(!n){var o=1/0;for(u=0;u<t.length;u++){n=t[u][0],s=t[u][1],r=t[u][2];for(var l=!0,i=0;i<n.length;i++)(!1&r||o>=r)&&Object.keys(a.O).every((function(t){return a.O[t](n[i])}))?n.splice(i--,1):(l=!1,r<o&&(o=r));if(l){t.splice(u--,1);var c=s();void 0!==c&&(e=c)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[n,s,r]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){a.f={},a.e=function(t){return Promise.all(Object.keys(a.f).reduce((function(e,n){return a.f[n](t,e),e}),[]))}}(),function(){a.u=function(t){return"js/"+t+"."+{51:"812ef75e",147:"03866fb8",335:"6f3a8206",338:"7d04805c",384:"bc56e199",491:"a7cb1222",536:"f90ae920",666:"9b9ccd70",743:"cf6cfd05",796:"7a7eef2a",851:"af1a2bb3",877:"385048d3",921:"6c5417dd"}[t]+".js"}}(),function(){a.miniCssF=function(t){return"css/"+t+"."+{51:"f75d094c",147:"f085ac72",335:"a9c8915a",338:"9f3aedde",384:"1b5ca7d9",491:"eca33f47",536:"033fc2ec",743:"56ce0835",851:"35707584",877:"99f8e2ce",921:"8230fa50"}[t]+".css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="zhiyuxinsheng:";a.l=function(n,s,r,o){if(t[n])t[n].push(s);else{var l,i;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==e+r){l=d;break}}l||(i=!0,l=document.createElement("script"),l.charset="utf-8",l.timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",e+r),l.src=n),t[n]=[s];var h=function(e,a){l.onerror=l.onload=null,clearTimeout(p);var s=t[n];if(delete t[n],l.parentNode&&l.parentNode.removeChild(l),s&&s.forEach((function(t){return t(a)})),e)return e(a)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=h.bind(null,l.onerror),l.onload=h.bind(null,l.onload),i&&document.head.appendChild(l)}}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){if("undefined"!==typeof document){var t=function(t,e,n,s,r){var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",a.nc&&(o.nonce=a.nc);var l=function(a){if(o.onerror=o.onload=null,"load"===a.type)s();else{var n=a&&a.type,l=a&&a.target&&a.target.href||e,i=new Error("Loading CSS chunk "+t+" failed.\n("+n+": "+l+")");i.name="ChunkLoadError",i.code="CSS_CHUNK_LOAD_FAILED",i.type=n,i.request=l,o.parentNode&&o.parentNode.removeChild(o),r(i)}};return o.onerror=o.onload=l,o.href=e,n?n.parentNode.insertBefore(o,n.nextSibling):document.head.appendChild(o),o},e=function(t,e){for(var a=document.getElementsByTagName("link"),n=0;n<a.length;n++){var s=a[n],r=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(r===t||r===e))return s}var o=document.getElementsByTagName("style");for(n=0;n<o.length;n++){s=o[n],r=s.getAttribute("data-href");if(r===t||r===e)return s}},n=function(n){return new Promise((function(s,r){var o=a.miniCssF(n),l=a.p+o;if(e(o,l))return s();t(n,l,null,s,r)}))},s={524:0};a.f.miniCss=function(t,e){var a={51:1,147:1,335:1,338:1,384:1,491:1,536:1,743:1,851:1,877:1,921:1};s[t]?e.push(s[t]):0!==s[t]&&a[t]&&e.push(s[t]=n(t).then((function(){s[t]=0}),(function(e){throw delete s[t],e})))}}}(),function(){var t={524:0};a.f.j=function(e,n){var s=a.o(t,e)?t[e]:void 0;if(0!==s)if(s)n.push(s[2]);else{var r=new Promise((function(a,n){s=t[e]=[a,n]}));n.push(s[2]=r);var o=a.p+a.u(e),l=new Error,i=function(n){if(a.o(t,e)&&(s=t[e],0!==s&&(t[e]=void 0),s)){var r=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",l.name="ChunkLoadError",l.type=r,l.request=o,s[1](l)}};a.l(o,i,"chunk-"+e,e)}},a.O.j=function(e){return 0===t[e]};var e=function(e,n){var s,r,o=n[0],l=n[1],i=n[2],c=0;if(o.some((function(e){return 0!==t[e]}))){for(s in l)a.o(l,s)&&(a.m[s]=l[s]);if(i)var u=i(a)}for(e&&e(n);c<o.length;c++)r=o[c],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return a.O(u)},n=self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=a.O(void 0,[504],(function(){return a(2059)}));n=a.O(n)})();
//# sourceMappingURL=app.d570e923.js.map