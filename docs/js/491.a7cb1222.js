"use strict";(self["webpackChunkzhiyuxinsheng"]=self["webpackChunkzhiyuxinsheng"]||[]).push([[491],{3446:function(e,t,a){a.d(t,{D:function(){return n}});a(8111),a(2489);var l=a(2261),o=a(144),s=(a(3271),a(4300)),i=a(1219);const n=(0,l.nY)("post",(()=>{const e=(0,o.KR)([]),t=(0,o.KR)(!1),a=async(a="all")=>{t.value=!0;try{const t=await s.d_.getPosts(a);return e.value=t.posts,t.posts}catch(l){return console.error("è·å–å¸–å­å¤±è´¥:",l),i.nk.error("è·å–å¸–å­åˆ—è¡¨å¤±è´¥"),[]}finally{t.value=!1}},l=async e=>{try{const t={...e,createdAt:e.createdAt||(new Date).toISOString()};console.log("å‡†å¤‡æäº¤åˆ°åç«¯çš„å¸–å­æ•°æ®:",t);await s.d_.createPost(t);return await a(),!0}catch(t){return console.error("å‘å¸ƒå¤±è´¥:",t),i.nk.error("å‘å¸ƒå¤±è´¥ï¼Œè¯·ç¨åå†è¯•"),!1}},n=async(e,t=[],a="")=>await l({content:e,images:t,location:a,type:"thought"}),u=async a=>{t.value=!0;try{return await s.d_.deletePost(a),e.value=e.value.filter((e=>e._id!==a)),i.nk.success("åˆ é™¤æˆåŠŸ"),!0}catch(l){return console.error("åˆ é™¤å¸–å­å¤±è´¥:",l),i.nk.error("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•"),!1}finally{t.value=!1}},r=async(e,t)=>{try{const l={...t,createdAt:t.createdAt||(new Date).toISOString()};console.log("æ›´æ–°å¸–å­æ•°æ®:",l);await s.d_.updatePost(e,l);return await a(),i.nk.success("æ›´æ–°æˆåŠŸ"),!0}catch(l){return console.error("æ›´æ–°å¤±è´¥:",l),i.nk.error("æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åå†è¯•"),!1}},c=()=>{a()};return c(),{posts:e,loading:t,fetchPosts:a,addPost:n,addCustomPost:l,removePost:u,updatePost:r}}))},3491:function(e,t,a){a.r(t),a.d(t,{default:function(){return ie}});a(4114),a(8111),a(2489),a(1701);var l=a(6768),o=a(144),s=a(4232),i=a(3446),n=(a(5796),a(7477)),u=a(1219),r=a(5320);const c={class:"timeline-container"},d={class:"timeline"},v={class:"timeline-date"},p={class:"date-bubble"},y={class:"time-text"},m={key:0,class:"content-header"},k={class:"content-title"},g={class:"content-body"},h={class:"content-text"},f={key:0,class:"content-images"},w={key:0,class:"image-count"},L={class:"content-footer"},b={class:"post-actions"},_={key:0,class:"empty-timeline"},F={class:"dialog-footer"};var C={__name:"TimeLinePage",props:{stories:{type:Array,default:()=>[]}},emits:["delete-post","edit-post"],setup(e,{emit:t}){const a=e,n=(0,l.EW)((()=>[...a.stories].sort(((e,t)=>{const a=new Date(e.time).getTime(),l=new Date(t.time).getTime();return l-a})))),u=((0,i.D)(),(0,o.KR)(!1)),r=(0,o.KR)(null),C=t,R=e=>{if(!e)return"æœªçŸ¥æ—¶é—´";try{const t=new Date(e);return isNaN(t.getTime())?(console.warn("æ— æ•ˆçš„æ—¥æœŸæ ¼å¼:",e),"æ— æ•ˆæ—¶é—´"):t.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}catch(t){return console.error("æ—¥æœŸæ ¼å¼åŒ–é”™è¯¯:",t),"æ— æ•ˆæ—¶é—´"}},S=e=>{if(!e)return"";try{const t=new Date(e);return isNaN(t.getTime())?(console.warn("æ— æ•ˆçš„æ—¶é—´æ ¼å¼:",e),""):t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("æ—¶é—´æ ¼å¼åŒ–é”™è¯¯:",t),""}},$=e=>{r.value=e,u.value=!0},x=async()=>{r.value&&(C("delete-post",r.value),u.value=!1,r.value=null)},A=e=>{C("edit-post",e)};return(t,a)=>{const o=(0,l.g2)("el-image"),i=(0,l.g2)("el-button"),r=(0,l.g2)("el-empty"),C=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",c,[(0,l.Lk)("div",d,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.value,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"timeline-item"},[(0,l.Lk)("div",v,[(0,l.Lk)("div",p,(0,s.v_)(R(e.time)),1),(0,l.Lk)("div",y,(0,s.v_)(S(e.time)),1)]),(0,l.Lk)("div",{class:(0,s.C4)(["timeline-content",{"is-diary":"diary"===e.postType}])},[(0,l.Lk)("div",{class:(0,s.C4)(["post-type-tag",{diary:"diary"===e.postType}])},(0,s.v_)("diary"===e.postType?"æ—¥è®°":"è¯´è¯´"),3),!e.title||"diary"!==e.postType&&""===e.title.trim()?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",m,[(0,l.Lk)("h3",k,(0,s.v_)(e.title),1)])),(0,l.Lk)("div",g,[(0,l.Lk)("p",h,(0,s.v_)(e.description),1),e.imageSrc?((0,l.uX)(),(0,l.CE)("div",f,[(0,l.bF)(o,{src:e.imageSrc,"preview-src-list":e.galleryImages||[e.imageSrc],fit:"cover",class:"content-image"},null,8,["src","preview-src-list"]),(e.galleryImages?.length||0)>1?((0,l.uX)(),(0,l.CE)("div",w," +"+(0,s.v_)(e.galleryImages.length-1),1)):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",L,[(0,l.Lk)("div",b,[(0,l.bF)(i,{size:"small",type:"primary",text:"",onClick:t=>A(e)},{default:(0,l.k6)((()=>a[2]||(a[2]=[(0,l.eW)(" ç¼–è¾‘ ")]))),_:2},1032,["onClick"]),(0,l.bF)(i,{size:"small",type:"danger",text:"",onClick:t=>$(e.id)},{default:(0,l.k6)((()=>a[3]||(a[3]=[(0,l.eW)(" åˆ é™¤ ")]))),_:2},1032,["onClick"])])])],2)])))),128)),0===e.stories.length?((0,l.uX)(),(0,l.CE)("div",_,[(0,l.bF)(r,{description:"è¿˜æ²¡æœ‰å†…å®¹ï¼Œå¿«æ¥å‘å¸ƒä¸€æ¡å§ï¼"})])):(0,l.Q3)("",!0)]),(0,l.bF)(C,{modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=e=>u.value=e),title:"ç¡®è®¤åˆ é™¤",width:"300px"},{footer:(0,l.k6)((()=>[(0,l.Lk)("span",F,[(0,l.bF)(i,{onClick:a[0]||(a[0]=e=>u.value=!1)},{default:(0,l.k6)((()=>a[4]||(a[4]=[(0,l.eW)("å–æ¶ˆ")]))),_:1}),(0,l.bF)(i,{type:"danger",onClick:x},{default:(0,l.k6)((()=>a[5]||(a[5]=[(0,l.eW)("ç¡®å®š")]))),_:1})])])),default:(0,l.k6)((()=>[a[6]||(a[6]=(0,l.Lk)("span",null,"ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ",-1))])),_:1},8,["modelValue"])])}}},R=a(1241);const S=(0,R.A)(C,[["__scopeId","data-v-c7c831cc"]]);var $=S,x=a(5011);const A={class:"posts-container"},E={class:"content-card"},K={class:"thought-input-placeholder"},I={class:"filter-tabs"},D={class:"timeline-wrapper"},P={class:"post-type-selector"},X={key:0,class:"diary-header"},V={class:"diary-date"},W={class:"diary-day"},T={class:"diary-month-year"},j={key:0,class:"diary-weather-mood"},O={key:0,class:"diary-weather"},Q={key:1,class:"diary-mood"},z={key:1,class:"diary-toolbar"},U={class:"toolbar-group"},N={class:"toolbar-group"},B={key:0,class:"diary-image-count"},H={class:"post-options"},M={class:"weather-options"},Y=["onClick"],q={class:"weather-icon"},G={class:"mood-selector"},J=["onClick"],Z={class:"mood-emoji"},ee={class:"mood-text"},te={key:0,class:"upload-title"},ae=["src"],le={class:"dialog-footer"};var oe={__name:"Posts",setup(e){const t=(0,i.D)(),a=(0,o.KR)(!1),c=(0,o.KR)(!1),d=(0,o.KR)(!1),v=(0,o.KR)(!1),p=(0,o.KR)("thought"),y=(0,o.KR)("all"),m=(0,o.KR)(!1),k=(0,o.KR)(null),g=(0,o.KR)([]),h=(0,o.KR)(""),f=(0,o.KR)(!1),w=(0,o.KR)(!1),L=(0,o.KR)({title:"",content:"",images:[],uploadFiles:[],location:"",mood:"",weather:"",type:"thought"}),b=[{emoji:"ğŸ˜Š",text:"å¼€å¿ƒ",value:"happy"},{emoji:"ğŸ˜¢",text:"ä¼¤å¿ƒ",value:"sad"},{emoji:"ğŸ˜¡",text:"ç”Ÿæ°”",value:"angry"},{emoji:"ğŸ˜´",text:"ç–²æƒ«",value:"tired"},{emoji:"ğŸ¥°",text:"çˆ±æ„",value:"love"},{emoji:"ğŸ¤”",text:"æ€è€ƒ",value:"thinking"}],_=e=>{const t=b.find((t=>t.value===e));return t?`${t.emoji} ${t.text}`:""},F=()=>{v.value=!v.value},C=e=>{L.value.mood=e,v.value=!1},R=(0,l.EW)((()=>"diary"===p.value?L.value.title.trim()&&L.value.content.trim():L.value.content.trim())),S=(0,l.EW)((()=>{if(!Array.isArray(t.posts))return console.warn("posts ä¸æ˜¯æ•°ç»„:",t.posts),[];let e=[...t.posts];return console.log("åŸå§‹å¸–å­æ•°æ®:",e),"all"!==y.value&&(e=e.filter((e=>e.type===y.value))),e.sort(((e,t)=>{const a=e.updatedAt?new Date(e.updatedAt).getTime():0,l=t.updatedAt?new Date(t.updatedAt).getTime():0;return a-l})),e.map((e=>{console.log("åç«¯è¿”å›çš„å¸–å­ï¼š",e),console.log("å¤„ç†å¸–å­æ—¥æœŸ:",{id:e._id,createdAt:e.createdAt});let t=e.title||"";if(!t)if(e.location)t=`ğŸ“ ${e.location}`;else if(e.mood){const a=b.find((t=>t.value===e.mood));t=a?`${a.emoji} ${a.text}`:""}else t="diary"===e.type?"æ— æ ‡é¢˜æ—¥è®°":"";let a=e.content;if(e.weather&&"diary"===e.type){const t={sunny:"â˜€ï¸ æ™´å¤©",rainy:"ğŸŒ§ï¸ ä¸‹é›¨",cloudy:"â˜ï¸ å¤šäº‘",snowy:"â„ï¸ ä¸‹é›ª"};a=`${t[e.weather]||""}\n${a}`}return{time:e.updatedAt,title:t,description:a,imageSrc:e.images&&e.images.length>0?e.images[0]:null,galleryImages:e.images||[],id:e._id,postType:e.type,location:e.location,mood:e.mood,weather:e.weather}}))})),oe=async()=>{await t.fetchPosts("all"===y.value?"":y.value)};(0,l.wB)(y,(async()=>{await oe()}));const se=()=>{L.value={title:"",content:"",images:[],uploadFiles:[],location:"",mood:"neutral",weather:"sunny",type:p.value},g.value=[],c.value=!1,d.value=!1,v.value=!1,m.value=!1,k.value=null},ie=async e=>{const a=await t.removePost(e);a&&oe()};(0,l.sV)((()=>{oe()}));const ne=e=>{h.value=e.url||URL.createObjectURL(e.raw),f.value=!0},ue=e=>{L.value.uploadFiles||(L.value.uploadFiles=[]),L.value.uploadFiles.push(e.raw);const t=URL.createObjectURL(e.raw);e.url=t},re=e=>{if(L.value.uploadFiles){const t=L.value.uploadFiles.findIndex((t=>t===e.raw));-1!==t&&L.value.uploadFiles.splice(t,1)}if(e.url&&e.url.startsWith("http")){const t=L.value.images.indexOf(e.url);-1!==t&&L.value.images.splice(t,1)}},ce=async()=>{if(!L.value.uploadFiles||0===L.value.uploadFiles.length)return[];w.value=!0;try{console.log("å‡†å¤‡ä¸Šä¼ å›¾ç‰‡ï¼Œæ•°é‡:",L.value.uploadFiles.length);const e=await x.A.uploadMultipleFiles(L.value.uploadFiles);return console.log("å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ŒURLåˆ—è¡¨:",e),L.value.uploadFiles=[],e||[]}catch(e){return console.error("ä¸Šä¼ å›¾ç‰‡å¤±è´¥:",e),u.nk.error(`ä¸Šä¼ å›¾ç‰‡å¤±è´¥: ${e.message||"æœªçŸ¥é”™è¯¯"}`),[]}finally{w.value=!1}},de=()=>{document.getElementById("upload-section")?.scrollIntoView({behavior:"smooth"})};(0,l.wB)(p,(e=>{L.value.type=e,console.log("åˆ‡æ¢ç±»å‹ä¸º:",e)}));const ve=(e="thought")=>{m.value=!1,k.value=null,p.value=e,L.value={title:"",content:"",images:[],uploadFiles:[],location:"",mood:"neutral",weather:"sunny",type:e},g.value=[],a.value=!0},pe=e=>{m.value=!0,k.value=e.id,p.value=e.postType,L.value={title:e.title,content:e.description,images:e.galleryImages||[],uploadFiles:[],location:e.location||"",mood:e.mood||"",weather:e.weather||"",type:e.postType,createdAt:e.time},g.value=(e.galleryImages||[]).map(((e,t)=>({name:`å·²æœ‰å›¾ç‰‡${t+1}`,url:e,status:"success"}))),L.value.location&&(c.value=!0),L.value.weather&&(d.value=!0),a.value=!0},ye=async()=>{if(R.value)try{const e=r.Ks.service({lock:!0,text:"æ­£åœ¨å¤„ç†å›¾ç‰‡å’Œæäº¤å†…å®¹ï¼Œè¯·ç¨å€™...",background:"rgba(0, 0, 0, 0.7)"});let l=[];L.value.uploadFiles&&L.value.uploadFiles.length>0&&(l=await ce());let o=[...L.value.images||[]];o=[...o,...l];const s={...L.value,images:o,createdAt:m.value?L.value.createdAt:(new Date).toISOString()};let i;delete s.uploadFiles,console.log("å‡†å¤‡æäº¤çš„å¸–å­æ•°æ®:",s),i=m.value?await t.updatePost(k.value,s):await t.addCustomPost(s),e.close(),i&&(se(),a.value=!1,await oe(),u.nk.success(m.value?"æ›´æ–°æˆåŠŸ":"å‘å¸ƒæˆåŠŸ"))}catch(e){console.error("æ“ä½œå¤±è´¥:",e),u.nk.error("æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•")}};return(e,t)=>{const i=(0,l.g2)("el-icon"),u=(0,l.g2)("el-input"),r=(0,l.g2)("el-form-item"),k=(0,l.g2)("el-button"),w=(0,l.g2)("el-upload"),x=(0,l.g2)("el-dialog"),oe=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",A,[t[21]||(t[21]=(0,l.Lk)("div",{class:"page-header"},[(0,l.Lk)("h1",{class:"page-title"},"å¿ƒæƒ…ç©ºé—´"),(0,l.Lk)("p",{class:"page-subtitle"},"è®°å½•ç”Ÿæ´»çš„ç‚¹æ»´ï¼Œåˆ†äº«å¿ƒæƒ…çš„ç¬é—´")],-1)),(0,l.Lk)("div",E,[(0,l.Lk)("div",{class:"thought-input-area",onClick:t[0]||(t[0]=e=>ve("thought"))},[(0,l.Lk)("div",K,[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Edit))])),_:1}),t[15]||(t[15]=(0,l.Lk)("span",null,"å†™ä¸‹å¿ƒä¸­ç¢ç¢å¿µ...",-1))])]),(0,l.Lk)("div",I,[(0,l.Lk)("div",{class:(0,s.C4)(["filter-tab",{active:"all"===y.value}]),onClick:t[1]||(t[1]=e=>y.value="all")}," å…¨éƒ¨ ",2),(0,l.Lk)("div",{class:(0,s.C4)(["filter-tab",{active:"diary"===y.value}]),onClick:t[2]||(t[2]=e=>y.value="diary")}," æ—¥è®° ",2),(0,l.Lk)("div",{class:(0,s.C4)(["filter-tab",{active:"thought"===y.value}]),onClick:t[3]||(t[3]=e=>y.value="thought")}," è¯´è¯´ ",2)])]),(0,l.Lk)("div",D,[(0,l.bF)($,{stories:S.value,onDeletePost:ie,onEditPost:pe},null,8,["stories"])]),(0,l.bF)(x,{modelValue:a.value,"onUpdate:modelValue":t[14]||(t[14]=e=>a.value=e),title:m.value?"diary"===p.value?"ç¼–è¾‘æ—¥è®°":"ç¼–è¾‘è¯´è¯´":"diary"===p.value?"å†™æ—¥è®°":"å‘è¯´è¯´",width:"65%","custom-class":"post-dialog","destroy-on-close":"",fullscreen:!1},{footer:(0,l.k6)((()=>[(0,l.Lk)("div",le,[(0,l.bF)(k,{onClick:t[13]||(t[13]=e=>a.value=!1)},{default:(0,l.k6)((()=>t[20]||(t[20]=[(0,l.eW)("å–æ¶ˆ")]))),_:1}),(0,l.bF)(k,{type:"primary",onClick:ye,disabled:!R.value,size:"diary"===p.value?"large":"default"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(m.value?"ä¿å­˜ä¿®æ”¹":"diary"===p.value?"ä¿å­˜æ—¥è®°":"å‘å¸ƒè¯´è¯´"),1)])),_:1},8,["disabled","size"])])])),default:(0,l.k6)((()=>[(0,l.Lk)("div",P,[(0,l.Lk)("div",{class:(0,s.C4)(["post-type-option",{active:"thought"===p.value}]),onClick:t[4]||(t[4]=e=>p.value="thought")},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.ChatDotRound))])),_:1}),t[16]||(t[16]=(0,l.Lk)("span",null,"è¯´è¯´",-1))],2),(0,l.Lk)("div",{class:(0,s.C4)(["post-type-option",{active:"diary"===p.value}]),onClick:t[5]||(t[5]=e=>p.value="diary")},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Notebook))])),_:1}),t[17]||(t[17]=(0,l.Lk)("span",null,"æ—¥è®°",-1))],2)]),"diary"===p.value?((0,l.uX)(),(0,l.CE)("div",X,[(0,l.Lk)("div",V,[(0,l.Lk)("div",W,(0,s.v_)((new Date).getDate()),1),(0,l.Lk)("div",T,(0,s.v_)((new Date).toLocaleDateString("zh-CN",{month:"long",year:"numeric"})),1)]),L.value.weather||L.value.mood?((0,l.uX)(),(0,l.CE)("div",j,[L.value.weather?((0,l.uX)(),(0,l.CE)("span",O,(0,s.v_)({sunny:"â˜€ï¸ æ™´å¤©",rainy:"ğŸŒ§ï¸ ä¸‹é›¨",cloudy:"â˜ï¸ å¤šäº‘",snowy:"â„ï¸ ä¸‹é›ª"}[L.value.weather]||""),1)):(0,l.Q3)("",!0),L.value.mood?((0,l.uX)(),(0,l.CE)("span",Q,(0,s.v_)(_(L.value.mood)),1)):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.bF)(oe,{class:"diary-form"},{default:(0,l.k6)((()=>["diary"===p.value?((0,l.uX)(),(0,l.Wv)(r,{key:0,class:"diary-title-item"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:L.value.title,"onUpdate:modelValue":t[6]||(t[6]=e=>L.value.title=e),placeholder:"ç»™ä»Šå¤©å†™ä¸ªæ ‡é¢˜...","prefix-icon":(0,o.R1)(n.Document),class:"diary-title-input",size:"diary"===p.value?"large":"default"},null,8,["modelValue","prefix-icon","size"])])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(r,{class:"diary-content-item"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:L.value.content,"onUpdate:modelValue":t[7]||(t[7]=e=>L.value.content=e),type:"textarea",rows:"diary"===p.value?10:6,placeholder:"diary"===p.value?"ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆ...\n\nå†™ä¸‹æ­¤åˆ»çš„å¿ƒæƒ…ï¼Œè®°å½•ç”Ÿæ´»çš„ç‚¹æ»´...":"æ­¤åˆ»çš„æƒ³æ³•...",class:"diary-content",resize:"none"},null,8,["modelValue","rows","placeholder"])])),_:1}),"diary"===p.value?((0,l.uX)(),(0,l.CE)("div",z,[(0,l.Lk)("div",U,[(0,l.Lk)("div",{class:"option-item",onClick:F},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.StarFilled))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(L.value.mood?`å¿ƒæƒ…ï¼š${_(L.value.mood)}`:"æ·»åŠ å¿ƒæƒ…"),1)]),(0,l.Lk)("div",{class:"option-item",onClick:t[8]||(t[8]=e=>c.value=!c.value)},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Location))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(c.value?"éšè—ä½ç½®":"æ·»åŠ ä½ç½®"),1)]),(0,l.Lk)("div",{class:"option-item",onClick:t[9]||(t[9]=e=>d.value=!d.value)},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Sunny))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(d.value?"éšè—å¤©æ°”":"æ·»åŠ å¤©æ°”"),1)])]),(0,l.Lk)("div",N,[L.value.images.length>0?((0,l.uX)(),(0,l.CE)("div",B," å·²æ·»åŠ  "+(0,s.v_)(L.value.images.length)+" å¼ å›¾ç‰‡ ",1)):(0,l.Q3)("",!0),(0,l.bF)(k,{size:"small",onClick:de},{default:(0,l.k6)((()=>t[18]||(t[18]=[(0,l.eW)("æ·»åŠ å›¾ç‰‡")]))),_:1})])])):(0,l.Q3)("",!0),"diary"!==p.value?((0,l.uX)(),(0,l.Wv)(r,{key:2,class:"thought-options"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",H,[(0,l.Lk)("div",{class:"option-item",onClick:F},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.StarFilled))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(L.value.mood?`å¿ƒæƒ…ï¼š${_(L.value.mood)}`:"æ·»åŠ å¿ƒæƒ…"),1)]),(0,l.Lk)("div",{class:"option-item",onClick:t[10]||(t[10]=e=>c.value=!c.value)},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Location))])),_:1}),(0,l.Lk)("span",null,(0,s.v_)(c.value?"éšè—ä½ç½®":"æ·»åŠ ä½ç½®"),1)])])])),_:1})):(0,l.Q3)("",!0),c.value?((0,l.uX)(),(0,l.Wv)(r,{key:3},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:L.value.location,"onUpdate:modelValue":t[11]||(t[11]=e=>L.value.location=e),placeholder:"æˆ‘åœ¨å“ªé‡Œ...","prefix-icon":(0,o.R1)(n.Location),class:"location-input"},null,8,["modelValue","prefix-icon"])])),_:1})):(0,l.Q3)("",!0),d.value&&"diary"===p.value?((0,l.uX)(),(0,l.Wv)(r,{key:4,class:"weather-selector"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",M,[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)({sunny:"â˜€ï¸ æ™´å¤©",rainy:"ğŸŒ§ï¸ ä¸‹é›¨",cloudy:"â˜ï¸ å¤šäº‘",snowy:"â„ï¸ ä¸‹é›ª"},((e,t)=>(0,l.Lk)("div",{key:t,class:(0,s.C4)(["weather-option",{active:L.value.weather===t}]),onClick:e=>L.value.weather=t},[(0,l.Lk)("span",q,(0,s.v_)(e.split(" ")[0]),1),(0,l.Lk)("span",null,(0,s.v_)(e.split(" ")[1]),1)],10,Y))),64))])])),_:1})):(0,l.Q3)("",!0),v.value?((0,l.uX)(),(0,l.Wv)(r,{key:5,class:"mood-item"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",G,[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(b,(e=>(0,l.Lk)("div",{key:e.value,class:(0,s.C4)(["mood-item",{active:L.value.mood===e.value}]),onClick:t=>C(e.value)},[(0,l.Lk)("span",Z,(0,s.v_)(e.emoji),1),(0,l.Lk)("span",ee,(0,s.v_)(e.text),1)],10,J))),64))])])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(r,{id:"upload-section"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",{class:(0,s.C4)(["upload-area",{"diary-upload":"diary"===p.value}])},["diary"===p.value?((0,l.uX)(),(0,l.CE)("div",te,"æ·»åŠ å›¾ç‰‡è®°å½•ç¾å¥½ç¬é—´")):(0,l.Q3)("",!0),(0,l.bF)(w,{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":ue,"on-remove":re,"file-list":g.value,"on-preview":ne},{default:(0,l.k6)((()=>[(0,l.bF)(i,{class:"upload-icon"},{default:(0,l.k6)((()=>[(0,l.bF)((0,o.R1)(n.Plus))])),_:1}),t[19]||(t[19]=(0,l.Lk)("span",{class:"upload-text"},"æ·»åŠ å›¾ç‰‡",-1))])),_:1},8,["file-list"]),(0,l.bF)(x,{modelValue:f.value,"onUpdate:modelValue":t[12]||(t[12]=e=>f.value=e)},{default:(0,l.k6)((()=>[(0,l.Lk)("img",{"w-full":"",src:h.value,alt:"é¢„è§ˆå›¾ç‰‡"},null,8,ae)])),_:1},8,["modelValue"])],2)])),_:1})])),_:1})])),_:1},8,["modelValue","title"])])}}};const se=(0,R.A)(oe,[["__scopeId","data-v-0dc2d5a7"]]);var ie=se},5011:function(e,t,a){a(8111),a(1701);var l=a(4300),o=a(788),s=a.n(o);const i={getOSSConfig(){return l.Ay.get("/oss/config")},getOSSPolicy(e="posts/"){return l.Ay.get("/oss/policy",{params:{dir:e}})},async uploadFile(e,t="posts/"){try{const a=await this.getOSSPolicy(t),l=a.policy;if(!l)throw new Error("è·å–ä¸Šä¼ ç­–ç•¥å¤±è´¥");let o=l.host;"object"===typeof o&&(console.error("Host æ˜¯ä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯å­—ç¬¦ä¸²:",o),o=`https://${l.bucket}.${l.region}.aliyuncs.com`),o.startsWith("http")||(o=`https://${o}`);const i=new FormData,n=`${l.key}${e.name.substring(e.name.lastIndexOf("."))}`;i.append("key",n),i.append("OSSAccessKeyId",l.accessKeyId),i.append("policy",l.policyBase64),i.append("signature",l.signature),i.append("success_action_status","200"),i.append("file",e),console.log("æ­£åœ¨ä¸Šä¼ æ–‡ä»¶åˆ°:",o),await s().post(o,i,{headers:{"Content-Type":"multipart/form-data"}});let u=l.cdnHost||o;"object"===typeof u&&(u=o);const r=`${u}/${n}`;return console.log("æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼ŒURL:",r),r}catch(a){throw console.error("ä¸Šä¼ æ–‡ä»¶åˆ°OSSå¤±è´¥:",a),a}},async uploadMultipleFiles(e,t="posts/"){if(!e||0===e.length)return[];try{const a=await this.getOSSPolicy(t),l=a.policy;if(!l)throw new Error("è·å–ä¸Šä¼ ç­–ç•¥å¤±è´¥");let o=l.host;"object"===typeof o&&(console.error("Host æ˜¯ä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯å­—ç¬¦ä¸²:",o),o=`https://${l.bucket}.${l.region}.aliyuncs.com`),o.startsWith("http")||(o=`https://${o}`),console.log("å‡†å¤‡æ‰¹é‡ä¸Šä¼ æ–‡ä»¶åˆ°:",o);const i=e.map((async(t,a)=>{try{const i=new FormData,n=`${l.key}-${a}${t.name.substring(t.name.lastIndexOf("."))}`;i.append("key",n),i.append("OSSAccessKeyId",l.accessKeyId),i.append("policy",l.policyBase64),i.append("signature",l.signature),i.append("success_action_status","200"),i.append("file",t),await s().post(o,i,{headers:{"Content-Type":"multipart/form-data"}});let u=l.cdnHost||o;"object"===typeof u&&(u=o);const r=`${u}/${n}`;return console.log(`æ–‡ä»¶ ${a+1}/${e.length} ä¸Šä¼ æˆåŠŸ:`,r),r}catch(i){throw console.error(`æ–‡ä»¶ ${a+1}/${e.length} ä¸Šä¼ å¤±è´¥:`,i),i}})),n=await Promise.all(i);return console.log("æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼ŒURLåˆ—è¡¨:",n),n}catch(a){throw console.error("æ‰¹é‡ä¸Šä¼ æ–‡ä»¶åˆ°OSSå¤±è´¥:",a),a}}};t.A=i}}]);
//# sourceMappingURL=491.a7cb1222.js.map